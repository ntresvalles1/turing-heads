const ss=Symbol("error"),as=Symbol("message");class rn extends Event{constructor(e,r={}){super(e),this[ss]=r.error===void 0?null:r.error,this[as]=r.message===void 0?"":r.message}get error(){return this[ss]}get message(){return this[as]}}Object.defineProperty(rn.prototype,"error",{enumerable:!0});Object.defineProperty(rn.prototype,"message",{enumerable:!0});const so=typeof globalThis.ErrorEvent=="function"?globalThis.ErrorEvent:rn;function ao(t){return t instanceof Error?"exitCode"in t&&t?.exitCode===0||t?.name==="ExitStatus"&&"status"in t&&t.status===0:!1}class oo extends EventTarget{constructor(){super(...arguments),this.listenersCount=0}addEventListener(e,r){++this.listenersCount,super.addEventListener(e,r)}removeEventListener(e,r){--this.listenersCount,super.removeEventListener(e,r)}hasListeners(){return this.listenersCount>0}}function io(t){t.asm={...t.asm};const e=new oo;for(const r in t.asm)if(typeof t.asm[r]=="function"){const n=t.asm[r];t.asm[r]=function(...s){try{return n(...s)}catch(a){if(!(a instanceof Error))throw a;const o=uo(a,t.lastAsyncifyStackSource?.stack);if(t.lastAsyncifyStackSource&&(a.cause=t.lastAsyncifyStackSource),e.hasListeners()){e.dispatchEvent(new so("error",{error:a,message:o}));return}throw ao(a)||ho(o),a}}}return e}let Kr=[];function co(){return Kr}function uo(t,e){if(t.message==="unreachable"){let r=lo;e||(r+=`

This stack trace is lacking. For a better one initialize 
the PHP runtime with { debug: true }, e.g. PHPNode.load('8.1', { debug: true }).

`),Kr=po(e||t.stack||"");for(const n of Kr)r+=`    * ${n}
`;return r}return t.message}const lo=`
"unreachable" WASM instruction executed.

The typical reason is a PHP function missing from the ASYNCIFY_ONLY
list when building PHP.wasm.

You will need to file a new issue in the WordPress Playground repository
and paste this error message there:

https://github.com/WordPress/wordpress-playground/issues/new

If you're a core developer, the typical fix is to:

* Isolate a minimal reproduction of the error
* Add a reproduction of the error to php-asyncify.spec.ts in the WordPress Playground repository
* Run 'npm run fix-asyncify'
* Commit the changes, push to the repo, release updated NPM packages

Below is a list of all the PHP functions found in the stack trace to
help with the minimal reproduction. If they're all already listed in
the Dockerfile, you'll need to trigger this error again with long stack
traces enabled. In node.js, you can do it using the --stack-trace-limit=100
CLI option: 

`,os="\x1B[41m",fo="\x1B[1m",is="\x1B[0m",cs="\x1B[K";let us=!1;function ho(t){if(!us){us=!0,console.log(`${os}
${cs}
${fo}  WASM ERROR${is}${os}`);for(const e of t.split(`
`))console.log(`${cs}  ${e} `);console.log(`${is}`)}}function po(t){try{const e=t.split(`
`).slice(1).map(r=>{const n=r.trim().substring(3).split(" ");return{fn:n.length>=2?n[0]:"<unknown>",isWasm:r.includes("wasm://")}}).filter(({fn:r,isWasm:n})=>n&&!r.startsWith("dynCall_")&&!r.startsWith("invoke_")).map(({fn:r})=>r);return Array.from(new Set(e))}catch{return[]}}class ut{constructor(e,r,n,s="",a=0){this.httpStatusCode=e,this.headers=r,this.bytes=n,this.exitCode=a,this.errors=s}static fromRawData(e){return new ut(e.httpStatusCode,e.headers,e.bytes,e.errors,e.exitCode)}toRawData(){return{headers:this.headers,bytes:this.bytes,errors:this.errors,exitCode:this.exitCode,httpStatusCode:this.httpStatusCode}}get json(){return JSON.parse(this.text)}get text(){return new TextDecoder().decode(this.bytes)}}const Ws=["8.2","8.1","8.0","7.4","7.3","7.2","7.1","7.0","5.6"],mo=Ws[0],yo=Ws;class go{#e;#t;constructor(e,r={}){this.requestHandler=e,this.#e={},this.#t={handleRedirects:!1,maxRedirects:4,...r}}async request(e,r=0){const n=await this.requestHandler.request({...e,headers:{...e.headers,cookie:this.#r()}});if(n.headers["set-cookie"]&&this.#n(n.headers["set-cookie"]),this.#t.handleRedirects&&n.headers.location&&r<this.#t.maxRedirects){const s=new URL(n.headers.location[0],this.requestHandler.absoluteUrl);return this.request({url:s.toString(),method:"GET",headers:{}},r+1)}return n}pathToInternalUrl(e){return this.requestHandler.pathToInternalUrl(e)}internalUrlToPath(e){return this.requestHandler.internalUrlToPath(e)}get absoluteUrl(){return this.requestHandler.absoluteUrl}get documentRoot(){return this.requestHandler.documentRoot}#n(e){for(const r of e)try{if(!r.includes("="))continue;const n=r.indexOf("="),s=r.substring(0,n),a=r.substring(n+1).split(";")[0];this.#e[s]=a}catch(n){console.error(n)}}#r(){const e=[];for(const r in this.#e)e.push(`${r}=${this.#e[r]}`);return e.join("; ")}}class Ks{constructor({concurrency:e}){this._running=0,this.concurrency=e,this.queue=[]}get running(){return this._running}async acquire(){for(;;)if(this._running>=this.concurrency)await new Promise(e=>this.queue.push(e));else{this._running++;let e=!1;return()=>{e||(e=!0,this._running--,this.queue.length>0&&this.queue.shift()())}}}async run(e){const r=await this.acquire();try{return await e()}finally{r()}}}function nn(...t){let e=t.join("/");const r=e.charAt(0)==="/",n=e.substring(e.length-1)==="/";return e=$o(e.split("/").filter(s=>!!s),!r).join("/"),!e&&!r&&(e="."),e&&n&&(e+="/"),(r?"/":"")+e}function $o(t,e){let r=0;for(let n=t.length-1;n>=0;n--){const s=t[n];s==="."?t.splice(n,1):s===".."?(t.splice(n,1),r++):r&&(t.splice(n,1),r--)}if(e)for(;r;r--)t.unshift("..");return t}const vo="http://example.com";function ls(t){return t.toString().substring(t.origin.length)}function ds(t,e){return!e||!t.startsWith(e)?t:t.substring(e.length)}function _o(t,e){return!e||t.startsWith(e)?t:e+t}class wo{#e;#t;#n;#r;#s;#a;#o;#i;#c;constructor(e,r={}){this.#i=new Ks({concurrency:1});const{documentRoot:n="/www/",absoluteUrl:s=typeof location=="object"?location?.href:"",isStaticFilePath:a=()=>!1}=r;this.php=e,this.#e=n,this.#c=a;const o=new URL(s);this.#n=o.hostname,this.#r=o.port?Number(o.port):o.protocol==="https:"?443:80,this.#t=(o.protocol||"").replace(":","");const u=this.#r!==443&&this.#r!==80;this.#s=[this.#n,u?`:${this.#r}`:""].join(""),this.#a=o.pathname.replace(/\/+$/,""),this.#o=[`${this.#t}://`,this.#s,this.#a].join("")}pathToInternalUrl(e){return`${this.absoluteUrl}${e}`}internalUrlToPath(e){const r=new URL(e);return r.pathname.startsWith(this.#a)&&(r.pathname=r.pathname.slice(this.#a.length)),ls(r)}get isRequestRunning(){return this.#i.running>0}get absoluteUrl(){return this.#o}get documentRoot(){return this.#e}async request(e){const r=e.url.startsWith("http://")||e.url.startsWith("https://"),n=new URL(e.url,r?void 0:vo),s=ds(n.pathname,this.#a);return this.#c(s)?this.#u(s):await this.#l(e,n)}#u(e){const r=`${this.#e}${e}`;if(!this.php.fileExists(r))return new ut(404,{},new TextEncoder().encode("404 File not found"));const n=this.php.readFileAsBuffer(r);return new ut(200,{"content-length":[`${n.byteLength}`],"content-type":[bo(r)],"accept-ranges":["bytes"],"cache-control":["public, max-age=0"]},n)}async#l(e,r){const n=await this.#i.acquire();try{this.php.addServerGlobalEntry("DOCUMENT_ROOT",this.#e),this.php.addServerGlobalEntry("HTTPS",this.#o.startsWith("https://")?"on":"");let s="GET";const a={host:this.#s,...Gs(e.headers||{})},o=[];if(e.files&&Object.keys(e.files).length){s="POST";for(const l in e.files){const f=e.files[l];o.push({key:l,name:f.name,type:f.type,data:new Uint8Array(await f.arrayBuffer())})}a["content-type"]?.startsWith("multipart/form-data")&&(e.formData=Eo(e.body||""),a["content-type"]="application/x-www-form-urlencoded",delete e.body)}let u;e.formData!==void 0?(s="POST",a["content-type"]=a["content-type"]||"application/x-www-form-urlencoded",u=new URLSearchParams(e.formData).toString()):u=e.body;let d;try{d=this.#d(r.pathname)}catch{return new ut(404,{},new TextEncoder().encode("404 File not found"))}return await this.php.run({relativeUri:_o(ls(r),this.#a),protocol:this.#t,method:e.method||s,body:u,fileInfos:o,scriptPath:d,headers:a})}finally{n()}}#d(e){let r=ds(e,this.#a);r.includes(".php")?r=r.split(".php")[0]+".php":(r.endsWith("/")||(r+="/"),r.endsWith("index.php")||(r+="index.php"));const n=`${this.#e}${r}`;if(this.php.fileExists(n))return n;if(!this.php.fileExists(`${this.#e}/index.php`))throw new Error(`File not found: ${n}`);return`${this.#e}/index.php`}}function Eo(t){const e={},r=t.match(/--(.*)\r\n/);if(!r)return e;const n=r[1],s=t.split(`--${n}`);return s.shift(),s.pop(),s.forEach(a=>{const o=a.indexOf(`\r
\r
`),u=a.substring(0,o).trim(),d=a.substring(o+4).trim(),l=u.match(/name="([^"]+)"/);if(l){const f=l[1];e[f]=d}}),e}function bo(t){switch(t.split(".").pop()){case"css":return"text/css";case"js":return"application/javascript";case"png":return"image/png";case"jpg":case"jpeg":return"image/jpeg";case"gif":return"image/gif";case"svg":return"image/svg+xml";case"woff":return"font/woff";case"woff2":return"font/woff2";case"ttf":return"font/ttf";case"otf":return"font/otf";case"eot":return"font/eot";case"ico":return"image/x-icon";case"html":return"text/html";case"json":return"application/json";case"xml":return"application/xml";case"txt":case"md":return"text/plain";default:return"application-octet-stream"}}const fs={0:"No error occurred. System call completed successfully.",1:"Argument list too long.",2:"Permission denied.",3:"Address in use.",4:"Address not available.",5:"Address family not supported.",6:"Resource unavailable, or operation would block.",7:"Connection already in progress.",8:"Bad file descriptor.",9:"Bad message.",10:"Device or resource busy.",11:"Operation canceled.",12:"No child processes.",13:"Connection aborted.",14:"Connection refused.",15:"Connection reset.",16:"Resource deadlock would occur.",17:"Destination address required.",18:"Mathematics argument out of domain of function.",19:"Reserved.",20:"File exists.",21:"Bad address.",22:"File too large.",23:"Host is unreachable.",24:"Identifier removed.",25:"Illegal byte sequence.",26:"Operation in progress.",27:"Interrupted function.",28:"Invalid argument.",29:"I/O error.",30:"Socket is connected.",31:"There is a directory under that path.",32:"Too many levels of symbolic links.",33:"File descriptor value too large.",34:"Too many links.",35:"Message too large.",36:"Reserved.",37:"Filename too long.",38:"Network is down.",39:"Connection aborted by network.",40:"Network unreachable.",41:"Too many files open in system.",42:"No buffer space available.",43:"No such device.",44:"There is no such file or directory OR the parent directory does not exist.",45:"Executable file format error.",46:"No locks available.",47:"Reserved.",48:"Not enough space.",49:"No message of the desired type.",50:"Protocol not available.",51:"No space left on device.",52:"Function not supported.",53:"The socket is not connected.",54:"Not a directory or a symbolic link to a directory.",55:"Directory not empty.",56:"State not recoverable.",57:"Not a socket.",58:"Not supported, or operation not supported on socket.",59:"Inappropriate I/O control operation.",60:"No such device or address.",61:"Value too large to be stored in data type.",62:"Previous owner died.",63:"Operation not permitted.",64:"Broken pipe.",65:"Protocol error.",66:"Protocol not supported.",67:"Protocol wrong type for socket.",68:"Result too large.",69:"Read-only file system.",70:"Invalid seek.",71:"No such process.",72:"Reserved.",73:"Connection timed out.",74:"Text file busy.",75:"Cross-device link.",76:"Extension: Capabilities insufficient."};function Ie(t=""){return function(r,n,s){const a=s.value;s.value=function(...o){try{return a.apply(this,o)}catch(u){const d=typeof u=="object"?u?.errno:null;if(d in fs){const l=fs[d],f=typeof o[0]=="string"?o[0]:null,y=f!==null?t.replaceAll("{path}",f):t;throw new Error(`${y}: ${l}`,{cause:u})}throw u}}}}async function Po(t,e={},r=[]){const[n,s,a]=hs(),[o,u]=hs(),d=t.init(Ro,{onAbort(l){a(l),u(),console.error(l)},ENV:{},locateFile:l=>l,...e,noInitialRun:!0,onRuntimeInitialized(){e.onRuntimeInitialized&&e.onRuntimeInitialized(),s()},monitorRunDependencies(l){l===0&&(delete d.monitorRunDependencies,u())}});return await Promise.all(r.map(({default:l})=>l(d))),r.length||u(),await o,await n,Gr.push(d),Gr.length-1}const Gr=[];function So(t){return Gr[t]}const Ro=function(){return typeof process<"u"&&process.release?.name==="node"?"NODE":typeof window<"u"?"WEB":typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope?"WORKER":"NODE"}(),hs=()=>{const t=[],e=new Promise((r,n)=>{t.push(r,n)});return t.unshift(e),t};var To=Object.defineProperty,Oo=Object.getOwnPropertyDescriptor,Ae=(t,e,r,n)=>{for(var s=n>1?void 0:n?Oo(e,r):e,a=t.length-1,o;a>=0;a--)(o=t[a])&&(s=(n?o(e,r,s):o(s))||s);return n&&s&&To(e,r,s),s};const ye="string",wt="number",Q=Symbol("__private__dont__use");class Te{constructor(e,r){this.#e=[],this.#t=!1,this.#n=null,this.#r={},this.#s=[],e!==void 0&&this.initializeRuntime(e),r&&(this.requestHandler=new go(new wo(this,r)))}#e;#t;#n;#r;#s;async onMessage(e){this.#s.push(e)}get absoluteUrl(){return this.requestHandler.requestHandler.absoluteUrl}get documentRoot(){return this.requestHandler.requestHandler.documentRoot}pathToInternalUrl(e){return this.requestHandler.requestHandler.pathToInternalUrl(e)}internalUrlToPath(e){return this.requestHandler.requestHandler.internalUrlToPath(e)}initializeRuntime(e){if(this[Q])throw new Error("PHP runtime already initialized.");const r=So(e);if(!r)throw new Error("Invalid PHP runtime id.");this[Q]=r,r.onMessage=n=>{for(const s of this.#s)s(n)},this.#n=io(r)}setPhpIniPath(e){if(this.#t)throw new Error("Cannot set PHP ini path after calling run().");this[Q].ccall("wasm_set_phpini_path",null,["string"],[e])}setPhpIniEntry(e,r){if(this.#t)throw new Error("Cannot set PHP ini entries after calling run().");this.#e.push([e,r])}chdir(e){this[Q].FS.chdir(e)}async request(e,r){if(!this.requestHandler)throw new Error("No request handler available.");return this.requestHandler.request(e,r)}async run(e){this.#t||(this.#a(),this.#t=!0),this.#f(e.scriptPath||""),this.#i(e.relativeUri||""),this.#u(e.method||"GET");const{host:r,...n}={host:"example.com:443",...Gs(e.headers||{})};if(this.#c(r,e.protocol||"http"),this.#l(n),e.body&&this.#d(e.body),e.fileInfos)for(const s of e.fileInfos)this.#p(s);return e.code&&this.#m(" ?>"+e.code),this.#h(),await this.#y()}#a(){if(this.#e.length>0){const e=this.#e.map(([r,n])=>`${r}=${n}`).join(`
`)+`

`;this[Q].ccall("wasm_set_phpini_entries",null,[ye],[e])}this[Q].ccall("php_wasm_init",null,[],[])}#o(){const e="/tmp/headers.json";if(!this.fileExists(e))throw new Error("SAPI Error: Could not find response headers file.");const r=JSON.parse(this.readFileAsText(e)),n={};for(const s of r.headers){if(!s.includes(": "))continue;const a=s.indexOf(": "),o=s.substring(0,a).toLowerCase(),u=s.substring(a+2);o in n||(n[o]=[]),n[o].push(u)}return{headers:n,httpStatusCode:r.status}}#i(e){if(this[Q].ccall("wasm_set_request_uri",null,[ye],[e]),e.includes("?")){const r=e.substring(e.indexOf("?")+1);this[Q].ccall("wasm_set_query_string",null,[ye],[r])}}#c(e,r){this[Q].ccall("wasm_set_request_host",null,[ye],[e]);let n;try{n=parseInt(new URL(e).port,10)}catch{}(!n||isNaN(n)||n===80)&&(n=r==="https"?443:80),this[Q].ccall("wasm_set_request_port",null,[wt],[n]),(r==="https"||!r&&n===443)&&this.addServerGlobalEntry("HTTPS","on")}#u(e){this[Q].ccall("wasm_set_request_method",null,[ye],[e])}#l(e){e.cookie&&this[Q].ccall("wasm_set_cookies",null,[ye],[e.cookie]),e["content-type"]&&this[Q].ccall("wasm_set_content_type",null,[ye],[e["content-type"]]),e["content-length"]&&this[Q].ccall("wasm_set_content_length",null,[wt],[parseInt(e["content-length"],10)]);for(const r in e){let n="HTTP_";["content-type","content-length"].includes(r.toLowerCase())&&(n=""),this.addServerGlobalEntry(`${n}${r.toUpperCase().replace(/-/g,"_")}`,e[r])}}#d(e){this[Q].ccall("wasm_set_request_body",null,[ye],[e]),this[Q].ccall("wasm_set_content_length",null,[wt],[new TextEncoder().encode(e).length])}#f(e){this[Q].ccall("wasm_set_path_translated",null,[ye],[e])}addServerGlobalEntry(e,r){this.#r[e]=r}#h(){for(const e in this.#r)this[Q].ccall("wasm_add_SERVER_entry",null,[ye,ye],[e,this.#r[e]])}#p(e){const{key:r,name:n,type:s,data:a}=e,o=`/tmp/${Math.random().toFixed(20)}`;this.writeFile(o,a);const u=0;this[Q].ccall("wasm_add_uploaded_file",null,[ye,ye,ye,ye,wt,wt],[r,n,s,o,u,a.byteLength])}#m(e){this[Q].ccall("wasm_set_php_code",null,[ye],[e])}async#y(){let e,r;try{e=await new Promise((a,o)=>{r=d=>{const l=new Error("Rethrown");l.cause=d.error,l.betterMessage=d.message,o(l)},this.#n?.addEventListener("error",r);const u=this[Q].ccall("wasm_sapi_handle_request",wt,[],[]);return u instanceof Promise?u.then(a,o):a(u)})}catch(a){for(const l in this)typeof this[l]=="function"&&(this[l]=()=>{throw new Error("PHP runtime has crashed – see the earlier error for details.")});this.functionsMaybeMissingFromAsyncify=co();const o=a,u="betterMessage"in o?o.betterMessage:o.message,d=new Error(u);throw d.cause=o,d}finally{this.#n?.removeEventListener("error",r),this.#r={}}const{headers:n,httpStatusCode:s}=this.#o();return new ut(s,n,this.readFileAsBuffer("/tmp/stdout"),this.readFileAsText("/tmp/stderr"),e)}mkdir(e){this[Q].FS.mkdirTree(e)}mkdirTree(e){this.mkdir(e)}readFileAsText(e){return new TextDecoder().decode(this.readFileAsBuffer(e))}readFileAsBuffer(e){return this[Q].FS.readFile(e)}writeFile(e,r){this[Q].FS.writeFile(e,r)}unlink(e){this[Q].FS.unlink(e)}mv(e,r){this[Q].FS.rename(e,r)}rmdir(e,r={recursive:!0}){r?.recursive&&this.listFiles(e).forEach(n=>{const s=`${e}/${n}`;this.isDir(s)?this.rmdir(s,r):this.unlink(s)}),this[Q].FS.rmdir(e)}listFiles(e,r={prependPath:!1}){if(!this.fileExists(e))return[];try{const n=this[Q].FS.readdir(e).filter(s=>s!=="."&&s!=="..");if(r.prependPath){const s=e.replace(/\/$/,"");return n.map(a=>`${s}/${a}`)}return n}catch(n){return console.error(n,{path:e}),[]}}isDir(e){return this.fileExists(e)?this[Q].FS.isDir(this[Q].FS.lookupPath(e).node.mode):!1}fileExists(e){try{return this[Q].FS.lookupPath(e),!0}catch{return!1}}}Ae([Ie('Could not create directory "{path}"')],Te.prototype,"mkdir",1);Ae([Ie('Could not create directory "{path}"')],Te.prototype,"mkdirTree",1);Ae([Ie('Could not read "{path}"')],Te.prototype,"readFileAsText",1);Ae([Ie('Could not read "{path}"')],Te.prototype,"readFileAsBuffer",1);Ae([Ie('Could not write to "{path}"')],Te.prototype,"writeFile",1);Ae([Ie('Could not unlink "{path}"')],Te.prototype,"unlink",1);Ae([Ie('Could not move "{path}"')],Te.prototype,"mv",1);Ae([Ie('Could not remove directory "{path}"')],Te.prototype,"rmdir",1);Ae([Ie('Could not list files in "{path}"')],Te.prototype,"listFiles",1);Ae([Ie('Could not stat "{path}"')],Te.prototype,"isDir",1);Ae([Ie('Could not stat "{path}"')],Te.prototype,"fileExists",1);function Gs(t){const e={};for(const r in t)e[r.toLowerCase()]=t[r];return e}/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Bs=Symbol("Comlink.proxy"),No=Symbol("Comlink.endpoint"),Co=Symbol("Comlink.releaseProxy"),qr=Symbol("Comlink.finalizer"),mr=Symbol("Comlink.thrown"),Js=t=>typeof t=="object"&&t!==null||typeof t=="function",ko={canHandle:t=>Js(t)&&t[Bs],serialize(t){const{port1:e,port2:r}=new MessageChannel;return Ir(t,e),[r,[r]]},deserialize(t){return t.start(),Ys(t)}},Io={canHandle:t=>Js(t)&&mr in t,serialize({value:t}){let e;return t instanceof Error?e={isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:e={isError:!1,value:t},[e,[]]},deserialize(t){throw t.isError?Object.assign(new Error(t.value.message),t.value):t.value}},Gt=new Map([["proxy",ko],["throw",Io]]);function Ao(t,e){for(const r of t)if(e===r||r==="*"||r instanceof RegExp&&r.test(e))return!0;return!1}function Ir(t,e=globalThis,r=["*"]){e.addEventListener("message",function n(s){if(!s||!s.data)return;if(!Ao(r,s.origin)){console.warn(`Invalid origin '${s.origin}' for comlink proxy`);return}const{id:a,type:o,path:u}=Object.assign({path:[]},s.data),d=(s.data.argumentList||[]).map(at);let l;try{const f=u.slice(0,-1).reduce((S,N)=>S[N],t),y=u.reduce((S,N)=>S[N],t);switch(o){case"GET":l=y;break;case"SET":f[u.slice(-1)[0]]=at(s.data.value),l=!0;break;case"APPLY":l=y.apply(f,d);break;case"CONSTRUCT":{const S=new y(...d);l=Zs(S)}break;case"ENDPOINT":{const{port1:S,port2:N}=new MessageChannel;Ir(t,N),l=qo(S,[S])}break;case"RELEASE":l=void 0;break;default:return}}catch(f){l={value:f,[mr]:0}}Promise.resolve(l).catch(f=>({value:f,[mr]:0})).then(f=>{const[y,S]=Er(f);e.postMessage(Object.assign(Object.assign({},y),{id:a}),S),o==="RELEASE"&&(e.removeEventListener("message",n),xs(e),qr in t&&typeof t[qr]=="function"&&t[qr]())}).catch(f=>{const[y,S]=Er({value:new TypeError("Unserializable return value"),[mr]:0});e.postMessage(Object.assign(Object.assign({},y),{id:a}),S)})}),e.start&&e.start()}function Do(t){return t.constructor.name==="MessagePort"}function xs(t){Do(t)&&t.close()}function Ys(t,e){return Br(t,[],e)}function ur(t){if(t)throw new Error("Proxy has been released and is not useable")}function Qs(t){return Pt(t,{type:"RELEASE"}).then(()=>{xs(t)})}const _r=new WeakMap,wr="FinalizationRegistry"in globalThis&&new FinalizationRegistry(t=>{const e=(_r.get(t)||0)-1;_r.set(t,e),e===0&&Qs(t)});function jo(t,e){const r=(_r.get(e)||0)+1;_r.set(e,r),wr&&wr.register(t,e,t)}function Mo(t){wr&&wr.unregister(t)}function Br(t,e=[],r=function(){}){let n=!1;const s=new Proxy(r,{get(a,o){if(ur(n),o===Co)return()=>{Mo(s),Qs(t),n=!0};if(o==="then"){if(e.length===0)return{then:()=>s};const u=Pt(t,{type:"GET",path:e.map(d=>d.toString())}).then(at);return u.then.bind(u)}return Br(t,[...e,o])},set(a,o,u){ur(n);const[d,l]=Er(u);return Pt(t,{type:"SET",path:[...e,o].map(f=>f.toString()),value:d},l).then(at)},apply(a,o,u){ur(n);const d=e[e.length-1];if(d===No)return Pt(t,{type:"ENDPOINT"}).then(at);if(d==="bind")return Br(t,e.slice(0,-1));const[l,f]=ps(u);return Pt(t,{type:"APPLY",path:e.map(y=>y.toString()),argumentList:l},f).then(at)},construct(a,o){ur(n);const[u,d]=ps(o);return Pt(t,{type:"CONSTRUCT",path:e.map(l=>l.toString()),argumentList:u},d).then(at)}});return jo(s,t),s}function Fo(t){return Array.prototype.concat.apply([],t)}function ps(t){const e=t.map(Er);return[e.map(r=>r[0]),Fo(e.map(r=>r[1]))]}const Xs=new WeakMap;function qo(t,e){return Xs.set(t,e),t}function Zs(t){return Object.assign(t,{[Bs]:!0})}function Uo(t,e=globalThis,r="*"){return{postMessage:(n,s)=>t.postMessage(n,r,s),addEventListener:e.addEventListener.bind(e),removeEventListener:e.removeEventListener.bind(e)}}function Er(t){for(const[e,r]of Gt)if(r.canHandle(t)){const[n,s]=r.serialize(t);return[{type:"HANDLER",name:e,value:n},s]}return[{type:"RAW",value:t},Xs.get(t)||[]]}function at(t){switch(t.type){case"HANDLER":return Gt.get(t.name).deserialize(t.value);case"RAW":return t.value}}function Pt(t,e,r){return new Promise(n=>{const s=Vo();t.addEventListener("message",function a(o){!o.data||!o.data.id||o.data.id!==s||(t.removeEventListener("message",a),n(o.data))}),t.start&&t.start(),t.postMessage(Object.assign({id:s},e),r)})}function Vo(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}function Ho(t,e){Lo();const r=Promise.resolve();let n,s;const a=new Promise((d,l)=>{n=d,s=l}),o=ea(t),u=new Proxy(o,{get:(d,l)=>l==="isConnected"?()=>r:l==="isReady"?()=>a:l in d?d[l]:e?.[l]});return Ir(u,typeof window<"u"?Uo(self.parent):void 0),[n,s,u]}let ms=!1;function Lo(){ms||(ms=!0,Gt.set("EVENT",{canHandle:t=>t instanceof CustomEvent,serialize:t=>[{detail:t.detail},[]],deserialize:t=>t}),Gt.set("FUNCTION",{canHandle:t=>typeof t=="function",serialize(t){console.debug("[Comlink][Performance] Proxying a function");const{port1:e,port2:r}=new MessageChannel;return Ir(t,e),[r,[r]]},deserialize(t){return t.start(),Ys(t)}}),Gt.set("PHPResponse",{canHandle:t=>typeof t=="object"&&t!==null&&"headers"in t&&"bytes"in t&&"errors"in t&&"exitCode"in t&&"httpStatusCode"in t,serialize(t){return[t.toRawData(),[]]},deserialize(t){return ut.fromRawData(t)}}))}function ea(t){return new Proxy(t,{get(e,r){switch(typeof e[r]){case"function":return(...n)=>e[r](...n);case"object":return e[r]===null?e[r]:ea(e[r]);case"undefined":case"number":case"string":return e[r];default:return Zs(e[r])}}})}async function zo(t=mo){switch(t){case"8.2":return await import("./assets/php_8_2-72c6a013.js");case"8.1":return await import("./assets/php_8_1-80afd991.js");case"8.0":return await import("./assets/php_8_0-6d25f83b.js");case"7.4":return await import("./assets/php_7_4-32a42da1.js");case"7.3":return await import("./assets/php_7_3-b1c98ae8.js");case"7.2":return await import("./assets/php_7_2-9327fa04.js");case"7.1":return await import("./assets/php_7_1-4c60b68d.js");case"7.0":return await import("./assets/php_7_0-d459c285.js");case"5.6":return await import("./assets/php_5_6-a8369f46.js")}throw new Error(`Unsupported PHP version ${t}`)}const Wo=()=>({websocket:{decorator:t=>class extends t{constructor(){try{super()}catch{}}send(){return null}}}});class br extends Te{static async load(e,r={}){return await br.loadSync(e,r).phpReady}static loadSync(e,r={}){const n=new br(void 0,r.requestHandler),a=(async()=>{const o=await Promise.all([zo(e),...r.dataModules||[]]),[u,...d]=o;r.downloadMonitor?.setModules(o);const l=await Po(u,{...r.emscriptenOptions||{},...r.downloadMonitor?.getEmscriptenOptions()||{},...Wo()},d);n.initializeRuntime(l)})();return{php:n,phpReady:a.then(()=>n)}}}const le=new WeakMap;class Ko{constructor(e,r){le.set(this,{php:e,monitor:r}),this.absoluteUrl=e.absoluteUrl,this.documentRoot=e.documentRoot}pathToInternalUrl(e){return le.get(this).php.pathToInternalUrl(e)}internalUrlToPath(e){return le.get(this).php.internalUrlToPath(e)}async onDownloadProgress(e){return le.get(this).monitor?.addEventListener("progress",e)}mv(e,r){return le.get(this).php.mv(e,r)}rmdir(e,r){return le.get(this).php.rmdir(e,r)}request(e,r){return le.get(this).php.request(e,r)}async run(e){return le.get(this).php.run(e)}chdir(e){return le.get(this).php.chdir(e)}setPhpIniPath(e){return le.get(this).php.setPhpIniPath(e)}setPhpIniEntry(e,r){return le.get(this).php.setPhpIniEntry(e,r)}mkdir(e){return le.get(this).php.mkdir(e)}mkdirTree(e){return le.get(this).php.mkdirTree(e)}readFileAsText(e){return le.get(this).php.readFileAsText(e)}readFileAsBuffer(e){return le.get(this).php.readFileAsBuffer(e)}writeFile(e,r){return le.get(this).php.writeFile(e,r)}unlink(e){return le.get(this).php.unlink(e)}listFiles(e,r){return le.get(this).php.listFiles(e,r)}isDir(e){return le.get(this).php.isDir(e)}fileExists(e){return le.get(this).php.fileExists(e)}onMessage(e){le.get(this).php.onMessage(e)}}function ta(t){return t.pathname.startsWith("/scope:")}function Go(t,e){let r=new URL(t);if(ta(r))if(e){const n=r.pathname.split("/");n[1]=`scope:${e}`,r.pathname=n.join("/")}else r=Bo(r);else if(e){const n=r.pathname==="/"?"":r.pathname;r.pathname=`/scope:${e}${n}`}return r}function Bo(t){if(!ta(t))return t;const e=new URL(t),r=e.pathname.split("/");return e.pathname="/"+r.slice(2).join("/"),e}function Jo(){const t={};return typeof self?.location?.href<"u"&&new URL(self.location.href).searchParams.forEach((r,n)=>{t[n]=r}),t}const xo=5*1024*1024;class Yo extends EventTarget{#e={};#t={};constructor(e=[]){super(),this.setModules(e),this.#n()}getEmscriptenOptions(){return{dataFileDownloads:this.#r()}}setModules(e){this.#e=e.reduce((r,n)=>{if(n.dependenciesTotalSize>0){const s="http://example.com/",o=new URL(n.dependencyFilename,s).pathname.split("/").pop();r[o]=Math.max(o in r?r[o]:0,n.dependenciesTotalSize)}return r},{}),this.#t=Object.fromEntries(Object.entries(this.#e).map(([r])=>[r,0]))}#n(){const e=WebAssembly.instantiateStreaming;WebAssembly.instantiateStreaming=async(r,...n)=>{const s=await r,a=s.url.substring(new URL(s.url).origin.length+1),o=Qo(s,({detail:{loaded:u,total:d}})=>this.#s(a,u,d));return e(o,...n)}}#r(){const e=this,r={};return new Proxy(r,{set(n,s,a){return e.#s(s,a.loaded,a.total),n[s]=new Proxy(JSON.parse(JSON.stringify(a)),{set(o,u,d){return o[u]=d,e.#s(s,o.loaded,o.total),!0}}),!0}})}#s(e,r,n){const s=new URL(e,"http://example.com").pathname.split("/").pop();n||(n=this.#e[s]),s in this.#t||console.warn(`Registered a download #progress of an unregistered file "${s}". This may cause a sudden **decrease** in the #progress percentage as the total number of bytes increases during the download.`),this.#t[s]=r,this.dispatchEvent(new CustomEvent("progress",{detail:{loaded:ys(this.#t),total:ys(this.#e)}}))}}function ys(t){return Object.values(t).reduce((e,r)=>e+r,0)}function Qo(t,e){const r=t.headers.get("content-length")||"",n=parseInt(r,10)||xo;function s(a,o){e(new CustomEvent("progress",{detail:{loaded:a,total:o}}))}return new Response(new ReadableStream({async start(a){if(!t.body){a.close();return}const o=t.body.getReader();let u=0;for(;;)try{const{done:d,value:l}=await o.read();if(l&&(u+=l.byteLength),d){s(u,u),a.close();break}else s(u,n),a.enqueue(l)}catch(d){console.error({e:d}),a.error(d);break}}}),{status:t.status,statusText:t.statusText,headers:t.headers})}const Xo=new URL("/",(import.meta||{}).url).origin,Pr="/wordpress",Zo=t=>t.startsWith("/wp-content/uploads/")||t.startsWith("/wp-content/plugins/")||t.startsWith("/wp-content/mu-plugins/")||t.startsWith("/wp-content/themes/"),ra=["6.2","6.1","6.0","5.9","nightly"],ei=ra[0],ti=ra;function ri(t){switch(t){case"5.9":return import("./assets/wp-5.9-2132058d.js");case"6.0":return import("./assets/wp-6.0-a58acc9c.js");case"6.1":return import("./assets/wp-6.1-4e48ef84.js");case"6.2":return import("./assets/wp-6.2-f52f91df.js");case"nightly":return import("./assets/wp-nightly-d258b17b.js")}throw new Error(`Unsupported WordPress module: ${t}`)}var ni=`<?php

/**
 * This transport delegates PHP HTTP requests to JavaScript synchronous XHR.
 *
 * This file isn't actually used. It's just here for reference and development. The actual
 * PHP code used in WordPress is hardcoded copy residing in wordpress.mjs in the _patchWordPressCode
 * function.
 *
 * @TODO Make the build pipeline use this exact file instead of creating it
 *       from within the JavaScript runtime.
 */

class Requests_Transport_Fetch implements Requests_Transport
{
	public $headers = '';

	public function __construct()
	{
	}

	public function __destruct()
	{
	}

	/**
	 * Delegates PHP HTTP requests to JavaScript synchronous XHR.
	 *
	 * @TODO Implement handling for more $options such as cookies, filename, auth, etc.
	 *
	 * @param $url
	 * @param $headers
	 * @param $data
	 * @param $options
	 *
	 * @return false|string
	 */
	public function request($url, $headers = array(), $data = array(), $options = array())
	{
		// Disable wp-cron requests that are extremely slow in node.js runtime environment.
		// @TODO: Make wp-cron requests faster.
		if (str_contains($url, '/wp-cron.php')) {
			return false;
		}

		$headers = Requests::flatten($headers);
		if (!empty($data)) {
			$data_format = $options['data_format'];
			if ($data_format === 'query') {
				$url  = self::format_get($url, $data);
				$data = '';
			} elseif (!is_string($data)) {
				$data = http_build_query($data, null, '&');
			}
		}

		$request = json_encode(json_encode(array(
			'headers' => $headers,
			'data'    => $data,
			'url'     => $url,
			'method'  => $options['type'],
		)));

		$js = <<<JAVASCRIPT
const request = JSON.parse({$request});
console.log("Requesting " + request.url);
const xhr = new XMLHttpRequest();
xhr.open(
	request.method,
	request.url,
	false // false makes the xhr synchronous
);
for ( var name in request.headers ) {
	xhr.setRequestHeader(name, request.headers[name]);
}
xhr.send(request.data);

[
	"HTTP/1.1 " + xhr.status + " " + xhr.statusText,
	xhr.getAllResponseHeaders(),
	"",
	xhr.responseText
].join("\\\\r\\\\n");
JAVASCRIPT;

		$this->headers = vrzno_eval($js);

		return $this->headers;
	}

	public function request_multiple($requests, $options)
	{
		$responses = array();
		$class     = get_class($this);
		foreach ($requests as $id => $request) {
			try {
				$handler          = new $class();
				$responses[$id] = $handler->request($request['url'], $request['headers'], $request['data'], $request['options']);
				$request['options']['hooks']->dispatch('transport.internal.parse_response', array(&$responses[$id], $request));
			} catch (Requests_Exception $e) {
				$responses[$id] = $e;
			}
			if (!is_string($responses[$id])) {
				$request['options']['hooks']->dispatch('multiple.request.complete', array(&$responses[$id], $id));
			}
		}

		return $responses;
	}

	protected static function format_get($url, $data)
	{
		if (!empty($data)) {
			$query     = '';
			$url_parts = parse_url($url);
			if (empty($url_parts['query'])) {
				$url_parts['query'] = '';
			} else {
				$query = $url_parts['query'];
			}
			$query .= '&' . http_build_query($data, null, '&');
			$query = trim($query, '&');
			if (empty($url_parts['query'])) {
				$url .= '?' . $query;
			} else {
				$url = str_replace($url_parts['query'], $query, $url);
			}
		}

		return $url;
	}

	public static function test($capabilities = array())
	{
		if (!function_exists('vrzno_eval')) {
			return false;
		}

		if (vrzno_eval("typeof XMLHttpRequest;") !== 'function') {
			return false;
		}

		return true;
	}
}
`,si=`<?php

/**
 * This transport does not perform any HTTP requests and only exists
 * to prevent the Requests class from complaining about not having any
 * transports.
 */
class Requests_Transport_Dummy implements Requests_Transport
{
	public $headers = '';

	public function __construct()
	{
	}

	public function __destruct()
	{
	}

	public function request($url, $headers = array(), $data = array(), $options = array())
	{
		return false;
	}

	public function request_multiple($requests, $options)
	{
		$responses = array();
		foreach ($requests as $id => $request) {
			$responses[] = false;
		}
		return $responses;
	}

	protected static function format_get($url, $data)
	{
		return $url;
	}

	public static function test($capabilities = array())
	{
		return true;
	}
}
`,ai=`<?php
/**
 * The default WordPress requests transports have been disabled
 * at this point. However, the Requests class requires at least
 * one working transport or else it throws warnings and acts up.
 * 
 * This mu-plugin provides that transport. It's one of the two:
 * 
 * * Requests_Transport_Fetch – Sends requests using browser's fetch() function.
 *                              Only enabled when PHP was compiled with the VRZNO
 * 								extension.
 * * Requests_Transport_Dummy – Does not send any requests and only exists to keep
 * 								the Requests class happy.
 */
if (defined('USE_FETCH_FOR_REQUESTS') && USE_FETCH_FOR_REQUESTS) {
    require(__DIR__ . '/includes/requests_transport_fetch.php');
	Requests::add_transport('Requests_Transport_Fetch');
	add_filter('http_request_host_is_external', function ($arg) {
		return true;
	});
} else {
    require(__DIR__ . '/includes/requests_transport_dummy.php');
    Requests::add_transport('Requests_Transport_Dummy');
}
`,oi=`<?php
/**
 * Add a notice to wp-login.php offering the username and password.
 */

add_action(
	'login_message',
	function() {
		return <<<EOT
<div class="message info">
	<strong>username:</strong> <code>admin</code><br /><strong>password</strong>: <code>password</code>
</div>
EOT;
	}
);
`,ii=`<?php
/**
 * Because the in-browser Playground doesn't have access to the internet, 
 * network-dependent features like directories don't work. Normally, you'll 
 * see a confusing message like "An unexpected error occurred." This mu-plugin
 * makes it more clear that the feature is not yet supported.
 * 
 * https://github.com/WordPress/wordpress-playground/issues/498
 */

add_filter( 'plugins_api_result', function( $res ) {
    if($res instanceof WP_Error) {
        $res = new WP_Error(
            'plugins_api_failed',
            'Playground <a href="https://github.com/WordPress/wordpress-playground/issues/85">does not yet support</a> connecting to the plugin directory yet. You can still upload plugins or install them using the <a href="https://wordpress.github.io/wordpress-playground/query-api">Query API</a> (e.g. ?plugin=coblocks).'
        );
    }
    return $res;
} );

add_filter( 'gettext', function( $translation ) {
    // There is no better hook for swapping the error message
    // on the themes page, unfortunately.
    global $pagenow;

    // Only change the message on /wp-admin/theme-install.php
    if( 'theme-install.php' !== $pagenow ) {
        return $translation;
    }

    if($translation === 'An unexpected error occurred. Something may be wrong with WordPress.org or this server&#8217;s configuration. If you continue to have problems, please try the <a href="%s">support forums</a>.') {
        return 'Playground <a href="https://github.com/WordPress/wordpress-playground/issues/85">does not yet support</a> connecting to the themes directory yet. You can still upload a theme or install it using the <a href="https://wordpress.github.io/wordpress-playground/query-api">Query API</a> (e.g. ?theme=pendant).';
    }
    return $translation;
} );
`;function ci(t){const e=new ui(t,Pr);e.replaceRequestsTransports(),e.addMissingSvgs()}let ui=class{constructor(e,r){this.php=e,this.wordpressPath=r}async replaceRequestsTransports(){await gs(this.php,`${this.wordpressPath}/wp-config.php`,r=>`${r} define('USE_FETCH_FOR_REQUESTS', false);`);const e=[`${this.wordpressPath}/wp-includes/Requests/Transport/fsockopen.php`,`${this.wordpressPath}/wp-includes/Requests/Transport/cURL.php`];for(const r of e)await this.php.fileExists(r)&&await gs(this.php,r,n=>n.replace("public static function test","public static function test( $capabilities = array() ) { return false; } public static function test2"));await this.php.mkdirTree(`${this.wordpressPath}/wp-content/mu-plugins/includes`),await this.php.writeFile(`${this.wordpressPath}/wp-content/mu-plugins/includes/requests_transport_fetch.php`,ni),await this.php.writeFile(`${this.wordpressPath}/wp-content/mu-plugins/includes/requests_transport_dummy.php`,si),await this.php.writeFile(`${this.wordpressPath}/wp-content/mu-plugins/add_requests_transport.php`,ai),await this.php.writeFile(`${this.wordpressPath}/wp-content/mu-plugins/1-show-admin-credentials-on-wp-login.php`,oi),await this.php.writeFile(`${this.wordpressPath}/wp-content/mu-plugins/2-nice-error-messages-for-plugins-and-themes-directories.php`,ii)}async addMissingSvgs(){this.php.mkdirTree(`${this.wordpressPath}/wp-admin/images`);const e=[`${this.wordpressPath}/wp-admin/images/about-header-about.svg`,`${this.wordpressPath}/wp-admin/images/dashboard-background.svg`];for(const r of e)await this.php.fileExists(r)||await this.php.writeFile(r,"")}};async function gs(t,e,r){await t.writeFile(e,r(await t.readFileAsText(e)))}function li(t,e,r){const n=sn.createFor(t,e,r);return()=>{n.unbind()}}class sn{constructor(e,r,n){this.php=e,this.opfs=r,this.workingSet=new Set,this.entries=[],this.unbind=()=>{},this.memfsRoot=$s(n),this.FS=this.php[Q].FS,this.reset()}static createFor(e,r,n){const s=e[Q].FS;if(s.hasJournal)throw new Error("Journal already bound");s.hasJournal=!0;const a=new sn(e,r,n);return a.bind(),a}bind(){const e=this.FS,r=e.filesystems.MEMFS,n=this,s=e.write;e.write=function(y){return n.addEntry({type:"UPDATE",path:y.path,nodeType:"file"}),s(...arguments)};const a=r.ops_table.dir.node.rename;r.ops_table.dir.node.rename=function(y,S,N){const b=e.getPath(y),R=nn(e.getPath(S),N);return n.addEntry({type:"RENAME",nodeType:e.isDir(y.mode)?"directory":"file",path:b,toPath:R}),a(...arguments)};const o=e.truncate;e.truncate=function(y){let S;return typeof y=="string"?S=e.lookupPath(y,{follow:!0}).node:S=y,n.addEntry({type:"UPDATE",path:e.getPath(S),nodeType:"file"}),o(...arguments)};const u=e.unlink;e.unlink=function(y){return n.addEntry({type:"DELETE",path:y,nodeType:"file"}),u(...arguments)};const d=e.mkdir;e.mkdir=function(y){return n.addEntry({type:"UPDATE",path:y,nodeType:"directory"}),d(...arguments)};const l=e.rmdir;e.rmdir=function(y){return n.addEntry({type:"DELETE",path:y,nodeType:"directory"}),l(...arguments)};const f=this.php.run;return this.php.run=async function(...y){const S=await f.apply(this,y);return await n.flush(),S},n.unbind=()=>{this.php.run=f,e.write=s,r.ops_table.dir.node.rename=a,e.truncate=o,e.unlink=u,e.mkdir=d,e.rmdir=l,e.hasJournal=!1},n}addEntry(e){const r=this.entries[this.entries.length-1],n=r[r.length-1];if(e.type===n.type&&e.type!=="RENAME"){if(this.workingSet.has(e.path))return;this.workingSet.add(e.path),r.push(e)}else this.entries.push([e]),this.workingSet.clear()}async flush(){const e=this.entries.slice(1);this.reset();for(const r of e)await di(r,async n=>{await this.processEntry(n)})}toOpfsPath(e){return $s(e.substring(this.memfsRoot.length))}async processEntry(e){if(!e.path.startsWith(this.memfsRoot)||e.path===this.memfsRoot)return;const r=this.toOpfsPath(e.path),n=await _s(this.opfs,r),s=vs(r);if(s)try{if(e.type==="DELETE")try{await n.removeEntry(s,{recursive:!0})}catch{}else if(e.type==="UPDATE")e.nodeType==="directory"?await n.getDirectoryHandle(s,{create:!0}):await aa(n,s,this.FS,e.path);else if(e.type==="RENAME"&&e.toPath.startsWith(this.memfsRoot)){const a=this.toOpfsPath(e.toPath),o=await _s(this.opfs,a),u=vs(a);if(e.nodeType==="directory"){const d=await o.getDirectoryHandle(s,{create:!0});await sa(this.php,d,e.toPath),await n.removeEntry(s,{recursive:!0})}else(await n.getFileHandle(s)).move(o,u)}}catch(a){throw console.log({entry:e,name:s}),console.error(a),a}}reset(){this.entries=[[{type:"NOOP",path:""}]]}}function $s(t){return t.replace(/\/$/,"").replace(/\/\/+/g,"/")}function vs(t){return t.substring(t.lastIndexOf("/")+1)}async function _s(t,e){const r=e.replace(/^\/+|\/+$/g,"").replace(/\/+/,"/");if(!r)return t;const n=r.split("/");let s=t;for(let a=0;a<n.length-1;a++){const o=n[a];s=await s.getDirectoryHandle(o,{create:!0})}return s}async function di(t,e){const r=[];for(const n of t)r.push(e(n));return await Promise.all(r)}let Ur;async function na({php:t,opfs:e,wordPressAvailableInOPFS:r,onProgress:n}){Ur&&await Ur();const s=t.documentRoot;if(r===void 0&&(r=await oa(e)),r){try{await t.isDir(s)&&(await t.rmdir(s,{recursive:!0}),await t.mkdirTree(s))}catch{}await fi(t,e,s)}else await sa(t,e,s,n);Ur=li(t,e,s)}async function fi(t,e,r){const s=t[Q].FS;s.mkdirTree(r);const a=new Ks({concurrency:40}),o=[],u=[[e,r]];for(;u.length>0;){const[d,l]=u.pop();for await(const f of d.values()){const y=a.run(async()=>{const S=nn(l,f.name);if(f.kind==="directory"){try{s.mkdir(S)}catch(N){if(N?.errno!==20)throw console.error(N),N}u.push([f,S])}else if(f.kind==="file"){const N=await f.getFile(),b=new Uint8Array(await N.arrayBuffer());s.createDataFile(S,null,b,!0,!0,!0)}o.splice(o.indexOf(y),1)});o.push(y)}for(;u.length===0&&o.length>0;)await Promise.any(o)}}async function sa(t,e,r,n){const a=t[Q].FS;a.mkdirTree(r);const o=[];async function u(f,y){await Promise.all(a.readdir(f).filter(S=>S!=="."&&S!=="..").map(async S=>{const N=nn(f,S);if(!hi(a,N)){o.push([y,N,S]);return}const b=await y.getDirectoryHandle(S,{create:!0});return await u(N,b)}))}await u(r,e);let d=0;const l=o.map(([f,y,S])=>aa(f,S,a,y).then(()=>{n?.({files:++d,total:o.length})}));await Promise.all(l)}function hi(t,e){return t.isDir(t.lookupPath(e,{follow:!0}).node.mode)}async function aa(t,e,r,n){let s;try{s=r.readFile(n,{encoding:"binary"})}catch{return}const a=await t.getFileHandle(e,{create:!0}),o=a.createWritable!==void 0?await a.createWritable():await a.createSyncAccessHandle();try{await o.truncate(0),await o.write(s)}finally{await o.close()}}async function oa(t){try{await t.getFileHandle("wp-config.php",{create:!1}),await(await(await t.getDirectoryHandle("wp-content",{create:!1})).getDirectoryHandle("database",{create:!1})).getFileHandle(".ht.sqlite",{create:!1})}catch{return!1}return!0}async function Bt(t,e,r){let n="";await t.fileExists(e)&&(n=await t.readFileAsText(e)),await t.writeFile(e,r(n))}const ws="/vfs-blueprints",pi=async(t,{consts:e,virtualize:r=!1})=>{const n=await t.documentRoot,s=r?ws:n,a=`${s}/playground-consts.json`,o=`${s}/wp-config.php`;return r&&(t.mkdir(ws),t.setPhpIniEntry("auto_prepend_file",o)),await Bt(t,a,u=>JSON.stringify({...JSON.parse(u||"{}"),...e})),await Bt(t,o,u=>u.includes("playground-consts.json")?u:`<?php
	$consts = json_decode(file_get_contents('${a}'), true);
	foreach ($consts as $const => $value) {
		if (!defined($const)) {
			define($const, $value);
		}
	}
?>${u}`),o},Es=async(t,e)=>{const r=new mi(t,e.wordpressPath||"/wordpress",e.siteUrl);e.addPhpInfo===!0&&await r.addPhpInfo(),e.siteUrl&&await r.patchSiteUrl(),e.patchSecrets===!0&&await r.patchSecrets(),e.disableSiteHealth===!0&&await r.disableSiteHealth(),e.disableWpNewBlogNotification===!0&&await r.disableWpNewBlogNotification()};class mi{constructor(e,r,n){this.php=e,this.scopedSiteUrl=n,this.wordpressPath=r}async addPhpInfo(){await this.php.writeFile(`${this.wordpressPath}/phpinfo.php`,"<?php phpinfo(); ")}async patchSiteUrl(){await pi(this.php,{consts:{WP_HOME:this.scopedSiteUrl,WP_SITEURL:this.scopedSiteUrl},virtualize:!0})}async patchSecrets(){await Bt(this.php,`${this.wordpressPath}/wp-config.php`,e=>`<?php
					define('AUTH_KEY',         '${Be(40)}');
					define('SECURE_AUTH_KEY',  '${Be(40)}');
					define('LOGGED_IN_KEY',    '${Be(40)}');
					define('NONCE_KEY',        '${Be(40)}');
					define('AUTH_SALT',        '${Be(40)}');
					define('SECURE_AUTH_SALT', '${Be(40)}');
					define('LOGGED_IN_SALT',   '${Be(40)}');
					define('NONCE_SALT',       '${Be(40)}');
				?>${e.replaceAll("', 'put your unique phrase here'","__', ''")}`)}async disableSiteHealth(){await Bt(this.php,`${this.wordpressPath}/wp-includes/default-filters.php`,e=>e.replace(/add_filter[^;]+wp_maybe_grant_site_health_caps[^;]+;/i,""))}async disableWpNewBlogNotification(){await Bt(this.php,`${this.wordpressPath}/wp-config.php`,e=>`${e} function wp_new_blog_notification(...$args){} `)}}function Be(t){const e="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ!@#$%^&*()_+=-[]/.,<>?";let r="";for(let n=t;n>0;--n)r+=e[Math.floor(Math.random()*e.length)];return r}var yi=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function gi(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Jr={exports:{}},ia={},ke={},Nt={},er={},G={},Zt={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.regexpCode=t.getEsmExportName=t.getProperty=t.safeStringify=t.stringify=t.strConcat=t.addCodeArg=t.str=t._=t.nil=t._Code=t.Name=t.IDENTIFIER=t._CodeOrName=void 0;class e{}t._CodeOrName=e,t.IDENTIFIER=/^[a-z$_][a-z$_0-9]*$/i;class r extends e{constructor(T){if(super(),!t.IDENTIFIER.test(T))throw new Error("CodeGen: name must be a valid identifier");this.str=T}toString(){return this.str}emptyStr(){return!1}get names(){return{[this.str]:1}}}t.Name=r;class n extends e{constructor(T){super(),this._items=typeof T=="string"?[T]:T}toString(){return this.str}emptyStr(){if(this._items.length>1)return!1;const T=this._items[0];return T===""||T==='""'}get str(){var T;return(T=this._str)!==null&&T!==void 0?T:this._str=this._items.reduce((O,I)=>`${O}${I}`,"")}get names(){var T;return(T=this._names)!==null&&T!==void 0?T:this._names=this._items.reduce((O,I)=>(I instanceof r&&(O[I.str]=(O[I.str]||0)+1),O),{})}}t._Code=n,t.nil=new n("");function s(g,...T){const O=[g[0]];let I=0;for(;I<T.length;)u(O,T[I]),O.push(g[++I]);return new n(O)}t._=s;const a=new n("+");function o(g,...T){const O=[N(g[0])];let I=0;for(;I<T.length;)O.push(a),u(O,T[I]),O.push(a,N(g[++I]));return d(O),new n(O)}t.str=o;function u(g,T){T instanceof n?g.push(...T._items):T instanceof r?g.push(T):g.push(y(T))}t.addCodeArg=u;function d(g){let T=1;for(;T<g.length-1;){if(g[T]===a){const O=l(g[T-1],g[T+1]);if(O!==void 0){g.splice(T-1,3,O);continue}g[T++]="+"}T++}}function l(g,T){if(T==='""')return g;if(g==='""')return T;if(typeof g=="string")return T instanceof r||g[g.length-1]!=='"'?void 0:typeof T!="string"?`${g.slice(0,-1)}${T}"`:T[0]==='"'?g.slice(0,-1)+T.slice(1):void 0;if(typeof T=="string"&&T[0]==='"'&&!(g instanceof r))return`"${g}${T.slice(1)}`}function f(g,T){return T.emptyStr()?g:g.emptyStr()?T:o`${g}${T}`}t.strConcat=f;function y(g){return typeof g=="number"||typeof g=="boolean"||g===null?g:N(Array.isArray(g)?g.join(","):g)}function S(g){return new n(N(g))}t.stringify=S;function N(g){return JSON.stringify(g).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")}t.safeStringify=N;function b(g){return typeof g=="string"&&t.IDENTIFIER.test(g)?new n(`.${g}`):s`[${g}]`}t.getProperty=b;function R(g){if(typeof g=="string"&&t.IDENTIFIER.test(g))return new n(`${g}`);throw new Error(`CodeGen: invalid export name: ${g}, use explicit $id name mapping`)}t.getEsmExportName=R;function v(g){return new n(g.toString())}t.regexpCode=v})(Zt);var xr={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ValueScope=t.ValueScopeName=t.Scope=t.varKinds=t.UsedValueState=void 0;const e=Zt;class r extends Error{constructor(l){super(`CodeGen: "code" for ${l} not defined`),this.value=l.value}}var n;(function(d){d[d.Started=0]="Started",d[d.Completed=1]="Completed"})(n=t.UsedValueState||(t.UsedValueState={})),t.varKinds={const:new e.Name("const"),let:new e.Name("let"),var:new e.Name("var")};class s{constructor({prefixes:l,parent:f}={}){this._names={},this._prefixes=l,this._parent=f}toName(l){return l instanceof e.Name?l:this.name(l)}name(l){return new e.Name(this._newName(l))}_newName(l){const f=this._names[l]||this._nameGroup(l);return`${l}${f.index++}`}_nameGroup(l){var f,y;if(!((y=(f=this._parent)===null||f===void 0?void 0:f._prefixes)===null||y===void 0)&&y.has(l)||this._prefixes&&!this._prefixes.has(l))throw new Error(`CodeGen: prefix "${l}" is not allowed in this scope`);return this._names[l]={prefix:l,index:0}}}t.Scope=s;class a extends e.Name{constructor(l,f){super(f),this.prefix=l}setValue(l,{property:f,itemIndex:y}){this.value=l,this.scopePath=(0,e._)`.${new e.Name(f)}[${y}]`}}t.ValueScopeName=a;const o=(0,e._)`\n`;class u extends s{constructor(l){super(l),this._values={},this._scope=l.scope,this.opts={...l,_n:l.lines?o:e.nil}}get(){return this._scope}name(l){return new a(l,this._newName(l))}value(l,f){var y;if(f.ref===void 0)throw new Error("CodeGen: ref must be passed in value");const S=this.toName(l),{prefix:N}=S,b=(y=f.key)!==null&&y!==void 0?y:f.ref;let R=this._values[N];if(R){const T=R.get(b);if(T)return T}else R=this._values[N]=new Map;R.set(b,S);const v=this._scope[N]||(this._scope[N]=[]),g=v.length;return v[g]=f.ref,S.setValue(f,{property:N,itemIndex:g}),S}getValue(l,f){const y=this._values[l];if(y)return y.get(f)}scopeRefs(l,f=this._values){return this._reduceValues(f,y=>{if(y.scopePath===void 0)throw new Error(`CodeGen: name "${y}" has no value`);return(0,e._)`${l}${y.scopePath}`})}scopeCode(l=this._values,f,y){return this._reduceValues(l,S=>{if(S.value===void 0)throw new Error(`CodeGen: name "${S}" has no value`);return S.value.code},f,y)}_reduceValues(l,f,y={},S){let N=e.nil;for(const b in l){const R=l[b];if(!R)continue;const v=y[b]=y[b]||new Map;R.forEach(g=>{if(v.has(g))return;v.set(g,n.Started);let T=f(g);if(T){const O=this.opts.es5?t.varKinds.var:t.varKinds.const;N=(0,e._)`${N}${O} ${g} = ${T};${this.opts._n}`}else if(T=S?.(g))N=(0,e._)`${N}${T}${this.opts._n}`;else throw new r(g);v.set(g,n.Completed)})}return N}}t.ValueScope=u})(xr);(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.or=t.and=t.not=t.CodeGen=t.operators=t.varKinds=t.ValueScopeName=t.ValueScope=t.Scope=t.Name=t.regexpCode=t.stringify=t.getProperty=t.nil=t.strConcat=t.str=t._=void 0;const e=Zt,r=xr;var n=Zt;Object.defineProperty(t,"_",{enumerable:!0,get:function(){return n._}}),Object.defineProperty(t,"str",{enumerable:!0,get:function(){return n.str}}),Object.defineProperty(t,"strConcat",{enumerable:!0,get:function(){return n.strConcat}}),Object.defineProperty(t,"nil",{enumerable:!0,get:function(){return n.nil}}),Object.defineProperty(t,"getProperty",{enumerable:!0,get:function(){return n.getProperty}}),Object.defineProperty(t,"stringify",{enumerable:!0,get:function(){return n.stringify}}),Object.defineProperty(t,"regexpCode",{enumerable:!0,get:function(){return n.regexpCode}}),Object.defineProperty(t,"Name",{enumerable:!0,get:function(){return n.Name}});var s=xr;Object.defineProperty(t,"Scope",{enumerable:!0,get:function(){return s.Scope}}),Object.defineProperty(t,"ValueScope",{enumerable:!0,get:function(){return s.ValueScope}}),Object.defineProperty(t,"ValueScopeName",{enumerable:!0,get:function(){return s.ValueScopeName}}),Object.defineProperty(t,"varKinds",{enumerable:!0,get:function(){return s.varKinds}}),t.operators={GT:new e._Code(">"),GTE:new e._Code(">="),LT:new e._Code("<"),LTE:new e._Code("<="),EQ:new e._Code("==="),NEQ:new e._Code("!=="),NOT:new e._Code("!"),OR:new e._Code("||"),AND:new e._Code("&&"),ADD:new e._Code("+")};class a{optimizeNodes(){return this}optimizeNames(i,p){return this}}class o extends a{constructor(i,p,k){super(),this.varKind=i,this.name=p,this.rhs=k}render({es5:i,_n:p}){const k=i?r.varKinds.var:this.varKind,F=this.rhs===void 0?"":` = ${this.rhs}`;return`${k} ${this.name}${F};`+p}optimizeNames(i,p){if(i[this.name.str])return this.rhs&&(this.rhs=fe(this.rhs,i,p)),this}get names(){return this.rhs instanceof e._CodeOrName?this.rhs.names:{}}}class u extends a{constructor(i,p,k){super(),this.lhs=i,this.rhs=p,this.sideEffects=k}render({_n:i}){return`${this.lhs} = ${this.rhs};`+i}optimizeNames(i,p){if(!(this.lhs instanceof e.Name&&!i[this.lhs.str]&&!this.sideEffects))return this.rhs=fe(this.rhs,i,p),this}get names(){const i=this.lhs instanceof e.Name?{}:{...this.lhs.names};return be(i,this.rhs)}}class d extends u{constructor(i,p,k,F){super(i,k,F),this.op=p}render({_n:i}){return`${this.lhs} ${this.op}= ${this.rhs};`+i}}class l extends a{constructor(i){super(),this.label=i,this.names={}}render({_n:i}){return`${this.label}:`+i}}class f extends a{constructor(i){super(),this.label=i,this.names={}}render({_n:i}){return`break${this.label?` ${this.label}`:""};`+i}}class y extends a{constructor(i){super(),this.error=i}render({_n:i}){return`throw ${this.error};`+i}get names(){return this.error.names}}class S extends a{constructor(i){super(),this.code=i}render({_n:i}){return`${this.code};`+i}optimizeNodes(){return`${this.code}`?this:void 0}optimizeNames(i,p){return this.code=fe(this.code,i,p),this}get names(){return this.code instanceof e._CodeOrName?this.code.names:{}}}class N extends a{constructor(i=[]){super(),this.nodes=i}render(i){return this.nodes.reduce((p,k)=>p+k.render(i),"")}optimizeNodes(){const{nodes:i}=this;let p=i.length;for(;p--;){const k=i[p].optimizeNodes();Array.isArray(k)?i.splice(p,1,...k):k?i[p]=k:i.splice(p,1)}return i.length>0?this:void 0}optimizeNames(i,p){const{nodes:k}=this;let F=k.length;for(;F--;){const q=k[F];q.optimizeNames(i,p)||(Xe(i,q.names),k.splice(F,1))}return k.length>0?this:void 0}get names(){return this.nodes.reduce((i,p)=>X(i,p.names),{})}}class b extends N{render(i){return"{"+i._n+super.render(i)+"}"+i._n}}class R extends N{}class v extends b{}v.kind="else";class g extends b{constructor(i,p){super(p),this.condition=i}render(i){let p=`if(${this.condition})`+super.render(i);return this.else&&(p+="else "+this.else.render(i)),p}optimizeNodes(){super.optimizeNodes();const i=this.condition;if(i===!0)return this.nodes;let p=this.else;if(p){const k=p.optimizeNodes();p=this.else=Array.isArray(k)?new v(k):k}if(p)return i===!1?p instanceof g?p:p.nodes:this.nodes.length?this:new g(Ze(i),p instanceof g?[p]:p.nodes);if(!(i===!1||!this.nodes.length))return this}optimizeNames(i,p){var k;if(this.else=(k=this.else)===null||k===void 0?void 0:k.optimizeNames(i,p),!!(super.optimizeNames(i,p)||this.else))return this.condition=fe(this.condition,i,p),this}get names(){const i=super.names;return be(i,this.condition),this.else&&X(i,this.else.names),i}}g.kind="if";class T extends b{}T.kind="for";class O extends T{constructor(i){super(),this.iteration=i}render(i){return`for(${this.iteration})`+super.render(i)}optimizeNames(i,p){if(super.optimizeNames(i,p))return this.iteration=fe(this.iteration,i,p),this}get names(){return X(super.names,this.iteration.names)}}class I extends T{constructor(i,p,k,F){super(),this.varKind=i,this.name=p,this.from=k,this.to=F}render(i){const p=i.es5?r.varKinds.var:this.varKind,{name:k,from:F,to:q}=this;return`for(${p} ${k}=${F}; ${k}<${q}; ${k}++)`+super.render(i)}get names(){const i=be(super.names,this.from);return be(i,this.to)}}class j extends T{constructor(i,p,k,F){super(),this.loop=i,this.varKind=p,this.name=k,this.iterable=F}render(i){return`for(${this.varKind} ${this.name} ${this.loop} ${this.iterable})`+super.render(i)}optimizeNames(i,p){if(super.optimizeNames(i,p))return this.iterable=fe(this.iterable,i,p),this}get names(){return X(super.names,this.iterable.names)}}class _ extends b{constructor(i,p,k){super(),this.name=i,this.args=p,this.async=k}render(i){return`${this.async?"async ":""}function ${this.name}(${this.args})`+super.render(i)}}_.kind="func";class C extends N{render(i){return"return "+super.render(i)}}C.kind="return";class D extends b{render(i){let p="try"+super.render(i);return this.catch&&(p+=this.catch.render(i)),this.finally&&(p+=this.finally.render(i)),p}optimizeNodes(){var i,p;return super.optimizeNodes(),(i=this.catch)===null||i===void 0||i.optimizeNodes(),(p=this.finally)===null||p===void 0||p.optimizeNodes(),this}optimizeNames(i,p){var k,F;return super.optimizeNames(i,p),(k=this.catch)===null||k===void 0||k.optimizeNames(i,p),(F=this.finally)===null||F===void 0||F.optimizeNames(i,p),this}get names(){const i=super.names;return this.catch&&X(i,this.catch.names),this.finally&&X(i,this.finally.names),i}}class z extends b{constructor(i){super(),this.error=i}render(i){return`catch(${this.error})`+super.render(i)}}z.kind="catch";class B extends b{render(i){return"finally"+super.render(i)}}B.kind="finally";class oe{constructor(i,p={}){this._values={},this._blockStarts=[],this._constants={},this.opts={...p,_n:p.lines?`
`:""},this._extScope=i,this._scope=new r.Scope({parent:i}),this._nodes=[new R]}toString(){return this._root.render(this.opts)}name(i){return this._scope.name(i)}scopeName(i){return this._extScope.name(i)}scopeValue(i,p){const k=this._extScope.value(i,p);return(this._values[k.prefix]||(this._values[k.prefix]=new Set)).add(k),k}getScopeValue(i,p){return this._extScope.getValue(i,p)}scopeRefs(i){return this._extScope.scopeRefs(i,this._values)}scopeCode(){return this._extScope.scopeCode(this._values)}_def(i,p,k,F){const q=this._scope.toName(p);return k!==void 0&&F&&(this._constants[q.str]=k),this._leafNode(new o(i,q,k)),q}const(i,p,k){return this._def(r.varKinds.const,i,p,k)}let(i,p,k){return this._def(r.varKinds.let,i,p,k)}var(i,p,k){return this._def(r.varKinds.var,i,p,k)}assign(i,p,k){return this._leafNode(new u(i,p,k))}add(i,p){return this._leafNode(new d(i,t.operators.ADD,p))}code(i){return typeof i=="function"?i():i!==e.nil&&this._leafNode(new S(i)),this}object(...i){const p=["{"];for(const[k,F]of i)p.length>1&&p.push(","),p.push(k),(k!==F||this.opts.es5)&&(p.push(":"),(0,e.addCodeArg)(p,F));return p.push("}"),new e._Code(p)}if(i,p,k){if(this._blockNode(new g(i)),p&&k)this.code(p).else().code(k).endIf();else if(p)this.code(p).endIf();else if(k)throw new Error('CodeGen: "else" body without "then" body');return this}elseIf(i){return this._elseNode(new g(i))}else(){return this._elseNode(new v)}endIf(){return this._endBlockNode(g,v)}_for(i,p){return this._blockNode(i),p&&this.code(p).endFor(),this}for(i,p){return this._for(new O(i),p)}forRange(i,p,k,F,q=this.opts.es5?r.varKinds.var:r.varKinds.let){const J=this._scope.toName(i);return this._for(new I(q,J,p,k),()=>F(J))}forOf(i,p,k,F=r.varKinds.const){const q=this._scope.toName(i);if(this.opts.es5){const J=p instanceof e.Name?p:this.var("_arr",p);return this.forRange("_i",0,(0,e._)`${J}.length`,Y=>{this.var(q,(0,e._)`${J}[${Y}]`),k(q)})}return this._for(new j("of",F,q,p),()=>k(q))}forIn(i,p,k,F=this.opts.es5?r.varKinds.var:r.varKinds.const){if(this.opts.ownProperties)return this.forOf(i,(0,e._)`Object.keys(${p})`,k);const q=this._scope.toName(i);return this._for(new j("in",F,q,p),()=>k(q))}endFor(){return this._endBlockNode(T)}label(i){return this._leafNode(new l(i))}break(i){return this._leafNode(new f(i))}return(i){const p=new C;if(this._blockNode(p),this.code(i),p.nodes.length!==1)throw new Error('CodeGen: "return" should have one node');return this._endBlockNode(C)}try(i,p,k){if(!p&&!k)throw new Error('CodeGen: "try" without "catch" and "finally"');const F=new D;if(this._blockNode(F),this.code(i),p){const q=this.name("e");this._currNode=F.catch=new z(q),p(q)}return k&&(this._currNode=F.finally=new B,this.code(k)),this._endBlockNode(z,B)}throw(i){return this._leafNode(new y(i))}block(i,p){return this._blockStarts.push(this._nodes.length),i&&this.code(i).endBlock(p),this}endBlock(i){const p=this._blockStarts.pop();if(p===void 0)throw new Error("CodeGen: not in self-balancing block");const k=this._nodes.length-p;if(k<0||i!==void 0&&k!==i)throw new Error(`CodeGen: wrong number of nodes: ${k} vs ${i} expected`);return this._nodes.length=p,this}func(i,p=e.nil,k,F){return this._blockNode(new _(i,p,k)),F&&this.code(F).endFunc(),this}endFunc(){return this._endBlockNode(_)}optimize(i=1){for(;i-- >0;)this._root.optimizeNodes(),this._root.optimizeNames(this._root.names,this._constants)}_leafNode(i){return this._currNode.nodes.push(i),this}_blockNode(i){this._currNode.nodes.push(i),this._nodes.push(i)}_endBlockNode(i,p){const k=this._currNode;if(k instanceof i||p&&k instanceof p)return this._nodes.pop(),this;throw new Error(`CodeGen: not in block "${p?`${i.kind}/${p.kind}`:i.kind}"`)}_elseNode(i){const p=this._currNode;if(!(p instanceof g))throw new Error('CodeGen: "else" without "if"');return this._currNode=p.else=i,this}get _root(){return this._nodes[0]}get _currNode(){const i=this._nodes;return i[i.length-1]}set _currNode(i){const p=this._nodes;p[p.length-1]=i}}t.CodeGen=oe;function X(w,i){for(const p in i)w[p]=(w[p]||0)+(i[p]||0);return w}function be(w,i){return i instanceof e._CodeOrName?X(w,i.names):w}function fe(w,i,p){if(w instanceof e.Name)return k(w);if(!F(w))return w;return new e._Code(w._items.reduce((q,J)=>(J instanceof e.Name&&(J=k(J)),J instanceof e._Code?q.push(...J._items):q.push(J),q),[]));function k(q){const J=p[q.str];return J===void 0||i[q.str]!==1?q:(delete i[q.str],J)}function F(q){return q instanceof e._Code&&q._items.some(J=>J instanceof e.Name&&i[J.str]===1&&p[J.str]!==void 0)}}function Xe(w,i){for(const p in i)w[p]=(w[p]||0)-(i[p]||0)}function Ze(w){return typeof w=="boolean"||typeof w=="number"||w===null?!w:(0,e._)`!${A(w)}`}t.not=Ze;const ft=$(t.operators.AND);function At(...w){return w.reduce(ft)}t.and=At;const ht=$(t.operators.OR);function M(...w){return w.reduce(ht)}t.or=M;function $(w){return(i,p)=>i===e.nil?p:p===e.nil?i:(0,e._)`${A(i)} ${w} ${A(p)}`}function A(w){return w instanceof e.Name?w:(0,e._)`(${w})`}})(G);var ee={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.checkStrictMode=t.getErrorPath=t.Type=t.useFunc=t.setEvaluated=t.evaluatedPropsToName=t.mergeEvaluated=t.eachItem=t.unescapeJsonPointer=t.escapeJsonPointer=t.escapeFragment=t.unescapeFragment=t.schemaRefOrVal=t.schemaHasRulesButRef=t.schemaHasRules=t.checkUnknownRules=t.alwaysValidSchema=t.toHash=void 0;const e=G,r=Zt;function n(_){const C={};for(const D of _)C[D]=!0;return C}t.toHash=n;function s(_,C){return typeof C=="boolean"?C:Object.keys(C).length===0?!0:(a(_,C),!o(C,_.self.RULES.all))}t.alwaysValidSchema=s;function a(_,C=_.schema){const{opts:D,self:z}=_;if(!D.strictSchema||typeof C=="boolean")return;const B=z.RULES.keywords;for(const oe in C)B[oe]||j(_,`unknown keyword: "${oe}"`)}t.checkUnknownRules=a;function o(_,C){if(typeof _=="boolean")return!_;for(const D in _)if(C[D])return!0;return!1}t.schemaHasRules=o;function u(_,C){if(typeof _=="boolean")return!_;for(const D in _)if(D!=="$ref"&&C.all[D])return!0;return!1}t.schemaHasRulesButRef=u;function d({topSchemaRef:_,schemaPath:C},D,z,B){if(!B){if(typeof D=="number"||typeof D=="boolean")return D;if(typeof D=="string")return(0,e._)`${D}`}return(0,e._)`${_}${C}${(0,e.getProperty)(z)}`}t.schemaRefOrVal=d;function l(_){return S(decodeURIComponent(_))}t.unescapeFragment=l;function f(_){return encodeURIComponent(y(_))}t.escapeFragment=f;function y(_){return typeof _=="number"?`${_}`:_.replace(/~/g,"~0").replace(/\//g,"~1")}t.escapeJsonPointer=y;function S(_){return _.replace(/~1/g,"/").replace(/~0/g,"~")}t.unescapeJsonPointer=S;function N(_,C){if(Array.isArray(_))for(const D of _)C(D);else C(_)}t.eachItem=N;function b({mergeNames:_,mergeToName:C,mergeValues:D,resultToName:z}){return(B,oe,X,be)=>{const fe=X===void 0?oe:X instanceof e.Name?(oe instanceof e.Name?_(B,oe,X):C(B,oe,X),X):oe instanceof e.Name?(C(B,X,oe),oe):D(oe,X);return be===e.Name&&!(fe instanceof e.Name)?z(B,fe):fe}}t.mergeEvaluated={props:b({mergeNames:(_,C,D)=>_.if((0,e._)`${D} !== true && ${C} !== undefined`,()=>{_.if((0,e._)`${C} === true`,()=>_.assign(D,!0),()=>_.assign(D,(0,e._)`${D} || {}`).code((0,e._)`Object.assign(${D}, ${C})`))}),mergeToName:(_,C,D)=>_.if((0,e._)`${D} !== true`,()=>{C===!0?_.assign(D,!0):(_.assign(D,(0,e._)`${D} || {}`),v(_,D,C))}),mergeValues:(_,C)=>_===!0?!0:{..._,...C},resultToName:R}),items:b({mergeNames:(_,C,D)=>_.if((0,e._)`${D} !== true && ${C} !== undefined`,()=>_.assign(D,(0,e._)`${C} === true ? true : ${D} > ${C} ? ${D} : ${C}`)),mergeToName:(_,C,D)=>_.if((0,e._)`${D} !== true`,()=>_.assign(D,C===!0?!0:(0,e._)`${D} > ${C} ? ${D} : ${C}`)),mergeValues:(_,C)=>_===!0?!0:Math.max(_,C),resultToName:(_,C)=>_.var("items",C)})};function R(_,C){if(C===!0)return _.var("props",!0);const D=_.var("props",(0,e._)`{}`);return C!==void 0&&v(_,D,C),D}t.evaluatedPropsToName=R;function v(_,C,D){Object.keys(D).forEach(z=>_.assign((0,e._)`${C}${(0,e.getProperty)(z)}`,!0))}t.setEvaluated=v;const g={};function T(_,C){return _.scopeValue("func",{ref:C,code:g[C.code]||(g[C.code]=new r._Code(C.code))})}t.useFunc=T;var O;(function(_){_[_.Num=0]="Num",_[_.Str=1]="Str"})(O=t.Type||(t.Type={}));function I(_,C,D){if(_ instanceof e.Name){const z=C===O.Num;return D?z?(0,e._)`"[" + ${_} + "]"`:(0,e._)`"['" + ${_} + "']"`:z?(0,e._)`"/" + ${_}`:(0,e._)`"/" + ${_}.replace(/~/g, "~0").replace(/\\//g, "~1")`}return D?(0,e.getProperty)(_).toString():"/"+y(_)}t.getErrorPath=I;function j(_,C,D=_.opts.strictSchema){if(D){if(C=`strict mode: ${C}`,D===!0)throw new Error(C);_.self.logger.warn(C)}}t.checkStrictMode=j})(ee);var Le={};Object.defineProperty(Le,"__esModule",{value:!0});const ge=G,$i={data:new ge.Name("data"),valCxt:new ge.Name("valCxt"),instancePath:new ge.Name("instancePath"),parentData:new ge.Name("parentData"),parentDataProperty:new ge.Name("parentDataProperty"),rootData:new ge.Name("rootData"),dynamicAnchors:new ge.Name("dynamicAnchors"),vErrors:new ge.Name("vErrors"),errors:new ge.Name("errors"),this:new ge.Name("this"),self:new ge.Name("self"),scope:new ge.Name("scope"),json:new ge.Name("json"),jsonPos:new ge.Name("jsonPos"),jsonLen:new ge.Name("jsonLen"),jsonPart:new ge.Name("jsonPart")};Le.default=$i;(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.extendErrors=t.resetErrorsCount=t.reportExtraError=t.reportError=t.keyword$DataError=t.keywordError=void 0;const e=G,r=ee,n=Le;t.keywordError={message:({keyword:v})=>(0,e.str)`must pass "${v}" keyword validation`},t.keyword$DataError={message:({keyword:v,schemaType:g})=>g?(0,e.str)`"${v}" keyword must be ${g} ($data)`:(0,e.str)`"${v}" keyword is invalid ($data)`};function s(v,g=t.keywordError,T,O){const{it:I}=v,{gen:j,compositeRule:_,allErrors:C}=I,D=y(v,g,T);O??(_||C)?d(j,D):l(I,(0,e._)`[${D}]`)}t.reportError=s;function a(v,g=t.keywordError,T){const{it:O}=v,{gen:I,compositeRule:j,allErrors:_}=O,C=y(v,g,T);d(I,C),j||_||l(O,n.default.vErrors)}t.reportExtraError=a;function o(v,g){v.assign(n.default.errors,g),v.if((0,e._)`${n.default.vErrors} !== null`,()=>v.if(g,()=>v.assign((0,e._)`${n.default.vErrors}.length`,g),()=>v.assign(n.default.vErrors,null)))}t.resetErrorsCount=o;function u({gen:v,keyword:g,schemaValue:T,data:O,errsCount:I,it:j}){if(I===void 0)throw new Error("ajv implementation error");const _=v.name("err");v.forRange("i",I,n.default.errors,C=>{v.const(_,(0,e._)`${n.default.vErrors}[${C}]`),v.if((0,e._)`${_}.instancePath === undefined`,()=>v.assign((0,e._)`${_}.instancePath`,(0,e.strConcat)(n.default.instancePath,j.errorPath))),v.assign((0,e._)`${_}.schemaPath`,(0,e.str)`${j.errSchemaPath}/${g}`),j.opts.verbose&&(v.assign((0,e._)`${_}.schema`,T),v.assign((0,e._)`${_}.data`,O))})}t.extendErrors=u;function d(v,g){const T=v.const("err",g);v.if((0,e._)`${n.default.vErrors} === null`,()=>v.assign(n.default.vErrors,(0,e._)`[${T}]`),(0,e._)`${n.default.vErrors}.push(${T})`),v.code((0,e._)`${n.default.errors}++`)}function l(v,g){const{gen:T,validateName:O,schemaEnv:I}=v;I.$async?T.throw((0,e._)`new ${v.ValidationError}(${g})`):(T.assign((0,e._)`${O}.errors`,g),T.return(!1))}const f={keyword:new e.Name("keyword"),schemaPath:new e.Name("schemaPath"),params:new e.Name("params"),propertyName:new e.Name("propertyName"),message:new e.Name("message"),schema:new e.Name("schema"),parentSchema:new e.Name("parentSchema")};function y(v,g,T){const{createErrors:O}=v.it;return O===!1?(0,e._)`{}`:S(v,g,T)}function S(v,g,T={}){const{gen:O,it:I}=v,j=[N(I,T),b(v,T)];return R(v,g,j),O.object(...j)}function N({errorPath:v},{instancePath:g}){const T=g?(0,e.str)`${v}${(0,r.getErrorPath)(g,r.Type.Str)}`:v;return[n.default.instancePath,(0,e.strConcat)(n.default.instancePath,T)]}function b({keyword:v,it:{errSchemaPath:g}},{schemaPath:T,parentSchema:O}){let I=O?g:(0,e.str)`${g}/${v}`;return T&&(I=(0,e.str)`${I}${(0,r.getErrorPath)(T,r.Type.Str)}`),[f.schemaPath,I]}function R(v,{params:g,message:T},O){const{keyword:I,data:j,schemaValue:_,it:C}=v,{opts:D,propertyName:z,topSchemaRef:B,schemaPath:oe}=C;O.push([f.keyword,I],[f.params,typeof g=="function"?g(v):g||(0,e._)`{}`]),D.messages&&O.push([f.message,typeof T=="function"?T(v):T]),D.verbose&&O.push([f.schema,_],[f.parentSchema,(0,e._)`${B}${oe}`],[n.default.data,j]),z&&O.push([f.propertyName,z])}})(er);Object.defineProperty(Nt,"__esModule",{value:!0});Nt.boolOrEmptySchema=Nt.topBoolOrEmptySchema=void 0;const vi=er,_i=G,wi=Le,Ei={message:"boolean schema is false"};function bi(t){const{gen:e,schema:r,validateName:n}=t;r===!1?ca(t,!1):typeof r=="object"&&r.$async===!0?e.return(wi.default.data):(e.assign((0,_i._)`${n}.errors`,null),e.return(!0))}Nt.topBoolOrEmptySchema=bi;function Pi(t,e){const{gen:r,schema:n}=t;n===!1?(r.var(e,!1),ca(t)):r.var(e,!0)}Nt.boolOrEmptySchema=Pi;function ca(t,e){const{gen:r,data:n}=t,s={gen:r,keyword:"false schema",data:n,schema:!1,schemaCode:!1,schemaValue:!1,params:{},it:t};(0,vi.reportError)(s,Ei,void 0,e)}var tr={},lt={};Object.defineProperty(lt,"__esModule",{value:!0});lt.getRules=lt.isJSONType=void 0;const Si=["string","number","integer","boolean","null","object","array"],Ri=new Set(Si);function Ti(t){return typeof t=="string"&&Ri.has(t)}lt.isJSONType=Ti;function Oi(){const t={number:{type:"number",rules:[]},string:{type:"string",rules:[]},array:{type:"array",rules:[]},object:{type:"object",rules:[]}};return{types:{...t,integer:!0,boolean:!0,null:!0},rules:[{rules:[]},t.number,t.string,t.array,t.object],post:{rules:[]},all:{},keywords:{}}}lt.getRules=Oi;var We={};Object.defineProperty(We,"__esModule",{value:!0});We.shouldUseRule=We.shouldUseGroup=We.schemaHasRulesForType=void 0;function Ni({schema:t,self:e},r){const n=e.RULES.types[r];return n&&n!==!0&&ua(t,n)}We.schemaHasRulesForType=Ni;function ua(t,e){return e.rules.some(r=>la(t,r))}We.shouldUseGroup=ua;function la(t,e){var r;return t[e.keyword]!==void 0||((r=e.definition.implements)===null||r===void 0?void 0:r.some(n=>t[n]!==void 0))}We.shouldUseRule=la;(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.reportTypeError=t.checkDataTypes=t.checkDataType=t.coerceAndCheckDataType=t.getJSONTypes=t.getSchemaTypes=t.DataType=void 0;const e=lt,r=We,n=er,s=G,a=ee;var o;(function(O){O[O.Correct=0]="Correct",O[O.Wrong=1]="Wrong"})(o=t.DataType||(t.DataType={}));function u(O){const I=d(O.type);if(I.includes("null")){if(O.nullable===!1)throw new Error("type: null contradicts nullable: false")}else{if(!I.length&&O.nullable!==void 0)throw new Error('"nullable" cannot be used without "type"');O.nullable===!0&&I.push("null")}return I}t.getSchemaTypes=u;function d(O){const I=Array.isArray(O)?O:O?[O]:[];if(I.every(e.isJSONType))return I;throw new Error("type must be JSONType or JSONType[]: "+I.join(","))}t.getJSONTypes=d;function l(O,I){const{gen:j,data:_,opts:C}=O,D=y(I,C.coerceTypes),z=I.length>0&&!(D.length===0&&I.length===1&&(0,r.schemaHasRulesForType)(O,I[0]));if(z){const B=R(I,_,C.strictNumbers,o.Wrong);j.if(B,()=>{D.length?S(O,I,D):g(O)})}return z}t.coerceAndCheckDataType=l;const f=new Set(["string","number","integer","boolean","null"]);function y(O,I){return I?O.filter(j=>f.has(j)||I==="array"&&j==="array"):[]}function S(O,I,j){const{gen:_,data:C,opts:D}=O,z=_.let("dataType",(0,s._)`typeof ${C}`),B=_.let("coerced",(0,s._)`undefined`);D.coerceTypes==="array"&&_.if((0,s._)`${z} == 'object' && Array.isArray(${C}) && ${C}.length == 1`,()=>_.assign(C,(0,s._)`${C}[0]`).assign(z,(0,s._)`typeof ${C}`).if(R(I,C,D.strictNumbers),()=>_.assign(B,C))),_.if((0,s._)`${B} !== undefined`);for(const X of j)(f.has(X)||X==="array"&&D.coerceTypes==="array")&&oe(X);_.else(),g(O),_.endIf(),_.if((0,s._)`${B} !== undefined`,()=>{_.assign(C,B),N(O,B)});function oe(X){switch(X){case"string":_.elseIf((0,s._)`${z} == "number" || ${z} == "boolean"`).assign(B,(0,s._)`"" + ${C}`).elseIf((0,s._)`${C} === null`).assign(B,(0,s._)`""`);return;case"number":_.elseIf((0,s._)`${z} == "boolean" || ${C} === null
              || (${z} == "string" && ${C} && ${C} == +${C})`).assign(B,(0,s._)`+${C}`);return;case"integer":_.elseIf((0,s._)`${z} === "boolean" || ${C} === null
              || (${z} === "string" && ${C} && ${C} == +${C} && !(${C} % 1))`).assign(B,(0,s._)`+${C}`);return;case"boolean":_.elseIf((0,s._)`${C} === "false" || ${C} === 0 || ${C} === null`).assign(B,!1).elseIf((0,s._)`${C} === "true" || ${C} === 1`).assign(B,!0);return;case"null":_.elseIf((0,s._)`${C} === "" || ${C} === 0 || ${C} === false`),_.assign(B,null);return;case"array":_.elseIf((0,s._)`${z} === "string" || ${z} === "number"
              || ${z} === "boolean" || ${C} === null`).assign(B,(0,s._)`[${C}]`)}}}function N({gen:O,parentData:I,parentDataProperty:j},_){O.if((0,s._)`${I} !== undefined`,()=>O.assign((0,s._)`${I}[${j}]`,_))}function b(O,I,j,_=o.Correct){const C=_===o.Correct?s.operators.EQ:s.operators.NEQ;let D;switch(O){case"null":return(0,s._)`${I} ${C} null`;case"array":D=(0,s._)`Array.isArray(${I})`;break;case"object":D=(0,s._)`${I} && typeof ${I} == "object" && !Array.isArray(${I})`;break;case"integer":D=z((0,s._)`!(${I} % 1) && !isNaN(${I})`);break;case"number":D=z();break;default:return(0,s._)`typeof ${I} ${C} ${O}`}return _===o.Correct?D:(0,s.not)(D);function z(B=s.nil){return(0,s.and)((0,s._)`typeof ${I} == "number"`,B,j?(0,s._)`isFinite(${I})`:s.nil)}}t.checkDataType=b;function R(O,I,j,_){if(O.length===1)return b(O[0],I,j,_);let C;const D=(0,a.toHash)(O);if(D.array&&D.object){const z=(0,s._)`typeof ${I} != "object"`;C=D.null?z:(0,s._)`!${I} || ${z}`,delete D.null,delete D.array,delete D.object}else C=s.nil;D.number&&delete D.integer;for(const z in D)C=(0,s.and)(C,b(z,I,j,_));return C}t.checkDataTypes=R;const v={message:({schema:O})=>`must be ${O}`,params:({schema:O,schemaValue:I})=>typeof O=="string"?(0,s._)`{type: ${O}}`:(0,s._)`{type: ${I}}`};function g(O){const I=T(O);(0,n.reportError)(I,v)}t.reportTypeError=g;function T(O){const{gen:I,data:j,schema:_}=O,C=(0,a.schemaRefOrVal)(O,_,"type");return{gen:I,keyword:"type",data:j,schema:_.type,schemaCode:C,schemaValue:C,parentSchema:_,params:{},it:O}}})(tr);var Ar={};Object.defineProperty(Ar,"__esModule",{value:!0});Ar.assignDefaults=void 0;const Et=G,Ci=ee;function ki(t,e){const{properties:r,items:n}=t.schema;if(e==="object"&&r)for(const s in r)bs(t,s,r[s].default);else e==="array"&&Array.isArray(n)&&n.forEach((s,a)=>bs(t,a,s.default))}Ar.assignDefaults=ki;function bs(t,e,r){const{gen:n,compositeRule:s,data:a,opts:o}=t;if(r===void 0)return;const u=(0,Et._)`${a}${(0,Et.getProperty)(e)}`;if(s){(0,Ci.checkStrictMode)(t,`default is ignored for: ${u}`);return}let d=(0,Et._)`${u} === undefined`;o.useDefaults==="empty"&&(d=(0,Et._)`${d} || ${u} === null || ${u} === ""`),n.if(d,(0,Et._)`${u} = ${(0,Et.stringify)(r)}`)}var He={},K={};Object.defineProperty(K,"__esModule",{value:!0});K.validateUnion=K.validateArray=K.usePattern=K.callValidateCode=K.schemaProperties=K.allSchemaProperties=K.noPropertyInData=K.propertyInData=K.isOwnProperty=K.hasPropFunc=K.reportMissingProp=K.checkMissingProp=K.checkReportMissingProp=void 0;const ne=G,an=ee,Je=Le,Ii=ee;function Ai(t,e){const{gen:r,data:n,it:s}=t;r.if(cn(r,n,e,s.opts.ownProperties),()=>{t.setParams({missingProperty:(0,ne._)`${e}`},!0),t.error()})}K.checkReportMissingProp=Ai;function Di({gen:t,data:e,it:{opts:r}},n,s){return(0,ne.or)(...n.map(a=>(0,ne.and)(cn(t,e,a,r.ownProperties),(0,ne._)`${s} = ${a}`)))}K.checkMissingProp=Di;function ji(t,e){t.setParams({missingProperty:e},!0),t.error()}K.reportMissingProp=ji;function da(t){return t.scopeValue("func",{ref:Object.prototype.hasOwnProperty,code:(0,ne._)`Object.prototype.hasOwnProperty`})}K.hasPropFunc=da;function on(t,e,r){return(0,ne._)`${da(t)}.call(${e}, ${r})`}K.isOwnProperty=on;function Mi(t,e,r,n){const s=(0,ne._)`${e}${(0,ne.getProperty)(r)} !== undefined`;return n?(0,ne._)`${s} && ${on(t,e,r)}`:s}K.propertyInData=Mi;function cn(t,e,r,n){const s=(0,ne._)`${e}${(0,ne.getProperty)(r)} === undefined`;return n?(0,ne.or)(s,(0,ne.not)(on(t,e,r))):s}K.noPropertyInData=cn;function fa(t){return t?Object.keys(t).filter(e=>e!=="__proto__"):[]}K.allSchemaProperties=fa;function Fi(t,e){return fa(e).filter(r=>!(0,an.alwaysValidSchema)(t,e[r]))}K.schemaProperties=Fi;function qi({schemaCode:t,data:e,it:{gen:r,topSchemaRef:n,schemaPath:s,errorPath:a},it:o},u,d,l){const f=l?(0,ne._)`${t}, ${e}, ${n}${s}`:e,y=[[Je.default.instancePath,(0,ne.strConcat)(Je.default.instancePath,a)],[Je.default.parentData,o.parentData],[Je.default.parentDataProperty,o.parentDataProperty],[Je.default.rootData,Je.default.rootData]];o.opts.dynamicRef&&y.push([Je.default.dynamicAnchors,Je.default.dynamicAnchors]);const S=(0,ne._)`${f}, ${r.object(...y)}`;return d!==ne.nil?(0,ne._)`${u}.call(${d}, ${S})`:(0,ne._)`${u}(${S})`}K.callValidateCode=qi;const Ui=(0,ne._)`new RegExp`;function Vi({gen:t,it:{opts:e}},r){const n=e.unicodeRegExp?"u":"",{regExp:s}=e.code,a=s(r,n);return t.scopeValue("pattern",{key:a.toString(),ref:a,code:(0,ne._)`${s.code==="new RegExp"?Ui:(0,Ii.useFunc)(t,s)}(${r}, ${n})`})}K.usePattern=Vi;function Hi(t){const{gen:e,data:r,keyword:n,it:s}=t,a=e.name("valid");if(s.allErrors){const u=e.let("valid",!0);return o(()=>e.assign(u,!1)),u}return e.var(a,!0),o(()=>e.break()),a;function o(u){const d=e.const("len",(0,ne._)`${r}.length`);e.forRange("i",0,d,l=>{t.subschema({keyword:n,dataProp:l,dataPropType:an.Type.Num},a),e.if((0,ne.not)(a),u)})}}K.validateArray=Hi;function Li(t){const{gen:e,schema:r,keyword:n,it:s}=t;if(!Array.isArray(r))throw new Error("ajv implementation error");if(r.some(d=>(0,an.alwaysValidSchema)(s,d))&&!s.opts.unevaluated)return;const o=e.let("valid",!1),u=e.name("_valid");e.block(()=>r.forEach((d,l)=>{const f=t.subschema({keyword:n,schemaProp:l,compositeRule:!0},u);e.assign(o,(0,ne._)`${o} || ${u}`),t.mergeValidEvaluated(f,u)||e.if((0,ne.not)(o))})),t.result(o,()=>t.reset(),()=>t.error(!0))}K.validateUnion=Li;Object.defineProperty(He,"__esModule",{value:!0});He.validateKeywordUsage=He.validSchemaType=He.funcKeywordCode=He.macroKeywordCode=void 0;const $e=G,ot=Le,zi=K,Wi=er;function Ki(t,e){const{gen:r,keyword:n,schema:s,parentSchema:a,it:o}=t,u=e.macro.call(o.self,s,a,o),d=ha(r,n,u);o.opts.validateSchema!==!1&&o.self.validateSchema(u,!0);const l=r.name("valid");t.subschema({schema:u,schemaPath:$e.nil,errSchemaPath:`${o.errSchemaPath}/${n}`,topSchemaRef:d,compositeRule:!0},l),t.pass(l,()=>t.error(!0))}He.macroKeywordCode=Ki;function Gi(t,e){var r;const{gen:n,keyword:s,schema:a,parentSchema:o,$data:u,it:d}=t;Ji(d,e);const l=!u&&e.compile?e.compile.call(d.self,a,o,d):e.validate,f=ha(n,s,l),y=n.let("valid");t.block$data(y,S),t.ok((r=e.valid)!==null&&r!==void 0?r:y);function S(){if(e.errors===!1)R(),e.modifying&&Ps(t),v(()=>t.error());else{const g=e.async?N():b();e.modifying&&Ps(t),v(()=>Bi(t,g))}}function N(){const g=n.let("ruleErrs",null);return n.try(()=>R((0,$e._)`await `),T=>n.assign(y,!1).if((0,$e._)`${T} instanceof ${d.ValidationError}`,()=>n.assign(g,(0,$e._)`${T}.errors`),()=>n.throw(T))),g}function b(){const g=(0,$e._)`${f}.errors`;return n.assign(g,null),R($e.nil),g}function R(g=e.async?(0,$e._)`await `:$e.nil){const T=d.opts.passContext?ot.default.this:ot.default.self,O=!("compile"in e&&!u||e.schema===!1);n.assign(y,(0,$e._)`${g}${(0,zi.callValidateCode)(t,f,T,O)}`,e.modifying)}function v(g){var T;n.if((0,$e.not)((T=e.valid)!==null&&T!==void 0?T:y),g)}}He.funcKeywordCode=Gi;function Ps(t){const{gen:e,data:r,it:n}=t;e.if(n.parentData,()=>e.assign(r,(0,$e._)`${n.parentData}[${n.parentDataProperty}]`))}function Bi(t,e){const{gen:r}=t;r.if((0,$e._)`Array.isArray(${e})`,()=>{r.assign(ot.default.vErrors,(0,$e._)`${ot.default.vErrors} === null ? ${e} : ${ot.default.vErrors}.concat(${e})`).assign(ot.default.errors,(0,$e._)`${ot.default.vErrors}.length`),(0,Wi.extendErrors)(t)},()=>t.error())}function Ji({schemaEnv:t},e){if(e.async&&!t.$async)throw new Error("async keyword in sync schema")}function ha(t,e,r){if(r===void 0)throw new Error(`keyword "${e}" failed to compile`);return t.scopeValue("keyword",typeof r=="function"?{ref:r}:{ref:r,code:(0,$e.stringify)(r)})}function xi(t,e,r=!1){return!e.length||e.some(n=>n==="array"?Array.isArray(t):n==="object"?t&&typeof t=="object"&&!Array.isArray(t):typeof t==n||r&&typeof t>"u")}He.validSchemaType=xi;function Yi({schema:t,opts:e,self:r,errSchemaPath:n},s,a){if(Array.isArray(s.keyword)?!s.keyword.includes(a):s.keyword!==a)throw new Error("ajv implementation error");const o=s.dependencies;if(o?.some(u=>!Object.prototype.hasOwnProperty.call(t,u)))throw new Error(`parent schema must have dependencies of ${a}: ${o.join(",")}`);if(s.validateSchema&&!s.validateSchema(t[a])){const d=`keyword "${a}" value is invalid at path "${n}": `+r.errorsText(s.validateSchema.errors);if(e.validateSchema==="log")r.logger.error(d);else throw new Error(d)}}He.validateKeywordUsage=Yi;var Qe={};Object.defineProperty(Qe,"__esModule",{value:!0});Qe.extendSubschemaMode=Qe.extendSubschemaData=Qe.getSubschema=void 0;const Ve=G,pa=ee;function Qi(t,{keyword:e,schemaProp:r,schema:n,schemaPath:s,errSchemaPath:a,topSchemaRef:o}){if(e!==void 0&&n!==void 0)throw new Error('both "keyword" and "schema" passed, only one allowed');if(e!==void 0){const u=t.schema[e];return r===void 0?{schema:u,schemaPath:(0,Ve._)`${t.schemaPath}${(0,Ve.getProperty)(e)}`,errSchemaPath:`${t.errSchemaPath}/${e}`}:{schema:u[r],schemaPath:(0,Ve._)`${t.schemaPath}${(0,Ve.getProperty)(e)}${(0,Ve.getProperty)(r)}`,errSchemaPath:`${t.errSchemaPath}/${e}/${(0,pa.escapeFragment)(r)}`}}if(n!==void 0){if(s===void 0||a===void 0||o===void 0)throw new Error('"schemaPath", "errSchemaPath" and "topSchemaRef" are required with "schema"');return{schema:n,schemaPath:s,topSchemaRef:o,errSchemaPath:a}}throw new Error('either "keyword" or "schema" must be passed')}Qe.getSubschema=Qi;function Xi(t,e,{dataProp:r,dataPropType:n,data:s,dataTypes:a,propertyName:o}){if(s!==void 0&&r!==void 0)throw new Error('both "data" and "dataProp" passed, only one allowed');const{gen:u}=e;if(r!==void 0){const{errorPath:l,dataPathArr:f,opts:y}=e,S=u.let("data",(0,Ve._)`${e.data}${(0,Ve.getProperty)(r)}`,!0);d(S),t.errorPath=(0,Ve.str)`${l}${(0,pa.getErrorPath)(r,n,y.jsPropertySyntax)}`,t.parentDataProperty=(0,Ve._)`${r}`,t.dataPathArr=[...f,t.parentDataProperty]}if(s!==void 0){const l=s instanceof Ve.Name?s:u.let("data",s,!0);d(l),o!==void 0&&(t.propertyName=o)}a&&(t.dataTypes=a);function d(l){t.data=l,t.dataLevel=e.dataLevel+1,t.dataTypes=[],e.definedProperties=new Set,t.parentData=e.data,t.dataNames=[...e.dataNames,l]}}Qe.extendSubschemaData=Xi;function Zi(t,{jtdDiscriminator:e,jtdMetadata:r,compositeRule:n,createErrors:s,allErrors:a}){n!==void 0&&(t.compositeRule=n),s!==void 0&&(t.createErrors=s),a!==void 0&&(t.allErrors=a),t.jtdDiscriminator=e,t.jtdMetadata=r}Qe.extendSubschemaMode=Zi;var me={},ma=function t(e,r){if(e===r)return!0;if(e&&r&&typeof e=="object"&&typeof r=="object"){if(e.constructor!==r.constructor)return!1;var n,s,a;if(Array.isArray(e)){if(n=e.length,n!=r.length)return!1;for(s=n;s--!==0;)if(!t(e[s],r[s]))return!1;return!0}if(e.constructor===RegExp)return e.source===r.source&&e.flags===r.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===r.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===r.toString();if(a=Object.keys(e),n=a.length,n!==Object.keys(r).length)return!1;for(s=n;s--!==0;)if(!Object.prototype.hasOwnProperty.call(r,a[s]))return!1;for(s=n;s--!==0;){var o=a[s];if(!t(e[o],r[o]))return!1}return!0}return e!==e&&r!==r},ya={exports:{}},Ye=ya.exports=function(t,e,r){typeof e=="function"&&(r=e,e={}),r=e.cb||r;var n=typeof r=="function"?r:r.pre||function(){},s=r.post||function(){};yr(e,n,s,t,"",t)};Ye.keywords={additionalItems:!0,items:!0,contains:!0,additionalProperties:!0,propertyNames:!0,not:!0,if:!0,then:!0,else:!0};Ye.arrayKeywords={items:!0,allOf:!0,anyOf:!0,oneOf:!0};Ye.propsKeywords={$defs:!0,definitions:!0,properties:!0,patternProperties:!0,dependencies:!0};Ye.skipKeywords={default:!0,enum:!0,const:!0,required:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0};function yr(t,e,r,n,s,a,o,u,d,l){if(n&&typeof n=="object"&&!Array.isArray(n)){e(n,s,a,o,u,d,l);for(var f in n){var y=n[f];if(Array.isArray(y)){if(f in Ye.arrayKeywords)for(var S=0;S<y.length;S++)yr(t,e,r,y[S],s+"/"+f+"/"+S,a,s,f,n,S)}else if(f in Ye.propsKeywords){if(y&&typeof y=="object")for(var N in y)yr(t,e,r,y[N],s+"/"+f+"/"+ec(N),a,s,f,n,N)}else(f in Ye.keywords||t.allKeys&&!(f in Ye.skipKeywords))&&yr(t,e,r,y,s+"/"+f,a,s,f,n)}r(n,s,a,o,u,d,l)}}function ec(t){return t.replace(/~/g,"~0").replace(/\//g,"~1")}var tc=ya.exports;Object.defineProperty(me,"__esModule",{value:!0});me.getSchemaRefs=me.resolveUrl=me.normalizeId=me._getFullPath=me.getFullPath=me.inlineRef=void 0;const rc=ee,nc=ma,sc=tc,ac=new Set(["type","format","pattern","maxLength","minLength","maxProperties","minProperties","maxItems","minItems","maximum","minimum","uniqueItems","multipleOf","required","enum","const"]);function oc(t,e=!0){return typeof t=="boolean"?!0:e===!0?!Yr(t):e?ga(t)<=e:!1}me.inlineRef=oc;const ic=new Set(["$ref","$recursiveRef","$recursiveAnchor","$dynamicRef","$dynamicAnchor"]);function Yr(t){for(const e in t){if(ic.has(e))return!0;const r=t[e];if(Array.isArray(r)&&r.some(Yr)||typeof r=="object"&&Yr(r))return!0}return!1}function ga(t){let e=0;for(const r in t){if(r==="$ref")return 1/0;if(e++,!ac.has(r)&&(typeof t[r]=="object"&&(0,rc.eachItem)(t[r],n=>e+=ga(n)),e===1/0))return 1/0}return e}function $a(t,e="",r){r!==!1&&(e=Tt(e));const n=t.parse(e);return va(t,n)}me.getFullPath=$a;function va(t,e){return t.serialize(e).split("#")[0]+"#"}me._getFullPath=va;const cc=/#\/?$/;function Tt(t){return t?t.replace(cc,""):""}me.normalizeId=Tt;function uc(t,e,r){return r=Tt(r),t.resolve(e,r)}me.resolveUrl=uc;const lc=/^[a-z_][-a-z0-9._]*$/i;function dc(t,e){if(typeof t=="boolean")return{};const{schemaId:r,uriResolver:n}=this.opts,s=Tt(t[r]||e),a={"":s},o=$a(n,s,!1),u={},d=new Set;return sc(t,{allKeys:!0},(y,S,N,b)=>{if(b===void 0)return;const R=o+S;let v=a[b];typeof y[r]=="string"&&(v=g.call(this,y[r])),T.call(this,y.$anchor),T.call(this,y.$dynamicAnchor),a[S]=v;function g(O){const I=this.opts.uriResolver.resolve;if(O=Tt(v?I(v,O):O),d.has(O))throw f(O);d.add(O);let j=this.refs[O];return typeof j=="string"&&(j=this.refs[j]),typeof j=="object"?l(y,j.schema,O):O!==Tt(R)&&(O[0]==="#"?(l(y,u[O],O),u[O]=y):this.refs[O]=R),O}function T(O){if(typeof O=="string"){if(!lc.test(O))throw new Error(`invalid anchor "${O}"`);g.call(this,`#${O}`)}}}),u;function l(y,S,N){if(S!==void 0&&!nc(y,S))throw f(N)}function f(y){return new Error(`reference "${y}" resolves to more than one schema`)}}me.getSchemaRefs=dc;Object.defineProperty(ke,"__esModule",{value:!0});ke.getData=ke.KeywordCxt=ke.validateFunctionCode=void 0;const _a=Nt,Ss=tr,un=We,Sr=tr,fc=Ar,Jt=He,Vr=Qe,U=G,L=Le,hc=me,Ke=ee,zt=er;function pc(t){if(ba(t)&&(Pa(t),Ea(t))){gc(t);return}wa(t,()=>(0,_a.topBoolOrEmptySchema)(t))}ke.validateFunctionCode=pc;function wa({gen:t,validateName:e,schema:r,schemaEnv:n,opts:s},a){s.code.es5?t.func(e,(0,U._)`${L.default.data}, ${L.default.valCxt}`,n.$async,()=>{t.code((0,U._)`"use strict"; ${Rs(r,s)}`),yc(t,s),t.code(a)}):t.func(e,(0,U._)`${L.default.data}, ${mc(s)}`,n.$async,()=>t.code(Rs(r,s)).code(a))}function mc(t){return(0,U._)`{${L.default.instancePath}="", ${L.default.parentData}, ${L.default.parentDataProperty}, ${L.default.rootData}=${L.default.data}${t.dynamicRef?(0,U._)`, ${L.default.dynamicAnchors}={}`:U.nil}}={}`}function yc(t,e){t.if(L.default.valCxt,()=>{t.var(L.default.instancePath,(0,U._)`${L.default.valCxt}.${L.default.instancePath}`),t.var(L.default.parentData,(0,U._)`${L.default.valCxt}.${L.default.parentData}`),t.var(L.default.parentDataProperty,(0,U._)`${L.default.valCxt}.${L.default.parentDataProperty}`),t.var(L.default.rootData,(0,U._)`${L.default.valCxt}.${L.default.rootData}`),e.dynamicRef&&t.var(L.default.dynamicAnchors,(0,U._)`${L.default.valCxt}.${L.default.dynamicAnchors}`)},()=>{t.var(L.default.instancePath,(0,U._)`""`),t.var(L.default.parentData,(0,U._)`undefined`),t.var(L.default.parentDataProperty,(0,U._)`undefined`),t.var(L.default.rootData,L.default.data),e.dynamicRef&&t.var(L.default.dynamicAnchors,(0,U._)`{}`)})}function gc(t){const{schema:e,opts:r,gen:n}=t;wa(t,()=>{r.$comment&&e.$comment&&Ra(t),Ec(t),n.let(L.default.vErrors,null),n.let(L.default.errors,0),r.unevaluated&&$c(t),Sa(t),Sc(t)})}function $c(t){const{gen:e,validateName:r}=t;t.evaluated=e.const("evaluated",(0,U._)`${r}.evaluated`),e.if((0,U._)`${t.evaluated}.dynamicProps`,()=>e.assign((0,U._)`${t.evaluated}.props`,(0,U._)`undefined`)),e.if((0,U._)`${t.evaluated}.dynamicItems`,()=>e.assign((0,U._)`${t.evaluated}.items`,(0,U._)`undefined`))}function Rs(t,e){const r=typeof t=="object"&&t[e.schemaId];return r&&(e.code.source||e.code.process)?(0,U._)`/*# sourceURL=${r} */`:U.nil}function vc(t,e){if(ba(t)&&(Pa(t),Ea(t))){_c(t,e);return}(0,_a.boolOrEmptySchema)(t,e)}function Ea({schema:t,self:e}){if(typeof t=="boolean")return!t;for(const r in t)if(e.RULES.all[r])return!0;return!1}function ba(t){return typeof t.schema!="boolean"}function _c(t,e){const{schema:r,gen:n,opts:s}=t;s.$comment&&r.$comment&&Ra(t),bc(t),Pc(t);const a=n.const("_errs",L.default.errors);Sa(t,a),n.var(e,(0,U._)`${a} === ${L.default.errors}`)}function Pa(t){(0,Ke.checkUnknownRules)(t),wc(t)}function Sa(t,e){if(t.opts.jtd)return Ts(t,[],!1,e);const r=(0,Ss.getSchemaTypes)(t.schema),n=(0,Ss.coerceAndCheckDataType)(t,r);Ts(t,r,!n,e)}function wc(t){const{schema:e,errSchemaPath:r,opts:n,self:s}=t;e.$ref&&n.ignoreKeywordsWithRef&&(0,Ke.schemaHasRulesButRef)(e,s.RULES)&&s.logger.warn(`$ref: keywords ignored in schema at path "${r}"`)}function Ec(t){const{schema:e,opts:r}=t;e.default!==void 0&&r.useDefaults&&r.strictSchema&&(0,Ke.checkStrictMode)(t,"default is ignored in the schema root")}function bc(t){const e=t.schema[t.opts.schemaId];e&&(t.baseId=(0,hc.resolveUrl)(t.opts.uriResolver,t.baseId,e))}function Pc(t){if(t.schema.$async&&!t.schemaEnv.$async)throw new Error("async schema in sync schema")}function Ra({gen:t,schemaEnv:e,schema:r,errSchemaPath:n,opts:s}){const a=r.$comment;if(s.$comment===!0)t.code((0,U._)`${L.default.self}.logger.log(${a})`);else if(typeof s.$comment=="function"){const o=(0,U.str)`${n}/$comment`,u=t.scopeValue("root",{ref:e.root});t.code((0,U._)`${L.default.self}.opts.$comment(${a}, ${o}, ${u}.schema)`)}}function Sc(t){const{gen:e,schemaEnv:r,validateName:n,ValidationError:s,opts:a}=t;r.$async?e.if((0,U._)`${L.default.errors} === 0`,()=>e.return(L.default.data),()=>e.throw((0,U._)`new ${s}(${L.default.vErrors})`)):(e.assign((0,U._)`${n}.errors`,L.default.vErrors),a.unevaluated&&Rc(t),e.return((0,U._)`${L.default.errors} === 0`))}function Rc({gen:t,evaluated:e,props:r,items:n}){r instanceof U.Name&&t.assign((0,U._)`${e}.props`,r),n instanceof U.Name&&t.assign((0,U._)`${e}.items`,n)}function Ts(t,e,r,n){const{gen:s,schema:a,data:o,allErrors:u,opts:d,self:l}=t,{RULES:f}=l;if(a.$ref&&(d.ignoreKeywordsWithRef||!(0,Ke.schemaHasRulesButRef)(a,f))){s.block(()=>Na(t,"$ref",f.all.$ref.definition));return}d.jtd||Tc(t,e),s.block(()=>{for(const S of f.rules)y(S);y(f.post)});function y(S){(0,un.shouldUseGroup)(a,S)&&(S.type?(s.if((0,Sr.checkDataType)(S.type,o,d.strictNumbers)),Os(t,S),e.length===1&&e[0]===S.type&&r&&(s.else(),(0,Sr.reportTypeError)(t)),s.endIf()):Os(t,S),u||s.if((0,U._)`${L.default.errors} === ${n||0}`))}}function Os(t,e){const{gen:r,schema:n,opts:{useDefaults:s}}=t;s&&(0,fc.assignDefaults)(t,e.type),r.block(()=>{for(const a of e.rules)(0,un.shouldUseRule)(n,a)&&Na(t,a.keyword,a.definition,e.type)})}function Tc(t,e){t.schemaEnv.meta||!t.opts.strictTypes||(Oc(t,e),t.opts.allowUnionTypes||Nc(t,e),Cc(t,t.dataTypes))}function Oc(t,e){if(e.length){if(!t.dataTypes.length){t.dataTypes=e;return}e.forEach(r=>{Ta(t.dataTypes,r)||ln(t,`type "${r}" not allowed by context "${t.dataTypes.join(",")}"`)}),Ic(t,e)}}function Nc(t,e){e.length>1&&!(e.length===2&&e.includes("null"))&&ln(t,"use allowUnionTypes to allow union type keyword")}function Cc(t,e){const r=t.self.RULES.all;for(const n in r){const s=r[n];if(typeof s=="object"&&(0,un.shouldUseRule)(t.schema,s)){const{type:a}=s.definition;a.length&&!a.some(o=>kc(e,o))&&ln(t,`missing type "${a.join(",")}" for keyword "${n}"`)}}}function kc(t,e){return t.includes(e)||e==="number"&&t.includes("integer")}function Ta(t,e){return t.includes(e)||e==="integer"&&t.includes("number")}function Ic(t,e){const r=[];for(const n of t.dataTypes)Ta(e,n)?r.push(n):e.includes("integer")&&n==="number"&&r.push("integer");t.dataTypes=r}function ln(t,e){const r=t.schemaEnv.baseId+t.errSchemaPath;e+=` at "${r}" (strictTypes)`,(0,Ke.checkStrictMode)(t,e,t.opts.strictTypes)}class Oa{constructor(e,r,n){if((0,Jt.validateKeywordUsage)(e,r,n),this.gen=e.gen,this.allErrors=e.allErrors,this.keyword=n,this.data=e.data,this.schema=e.schema[n],this.$data=r.$data&&e.opts.$data&&this.schema&&this.schema.$data,this.schemaValue=(0,Ke.schemaRefOrVal)(e,this.schema,n,this.$data),this.schemaType=r.schemaType,this.parentSchema=e.schema,this.params={},this.it=e,this.def=r,this.$data)this.schemaCode=e.gen.const("vSchema",Ca(this.$data,e));else if(this.schemaCode=this.schemaValue,!(0,Jt.validSchemaType)(this.schema,r.schemaType,r.allowUndefined))throw new Error(`${n} value must be ${JSON.stringify(r.schemaType)}`);("code"in r?r.trackErrors:r.errors!==!1)&&(this.errsCount=e.gen.const("_errs",L.default.errors))}result(e,r,n){this.failResult((0,U.not)(e),r,n)}failResult(e,r,n){this.gen.if(e),n?n():this.error(),r?(this.gen.else(),r(),this.allErrors&&this.gen.endIf()):this.allErrors?this.gen.endIf():this.gen.else()}pass(e,r){this.failResult((0,U.not)(e),void 0,r)}fail(e){if(e===void 0){this.error(),this.allErrors||this.gen.if(!1);return}this.gen.if(e),this.error(),this.allErrors?this.gen.endIf():this.gen.else()}fail$data(e){if(!this.$data)return this.fail(e);const{schemaCode:r}=this;this.fail((0,U._)`${r} !== undefined && (${(0,U.or)(this.invalid$data(),e)})`)}error(e,r,n){if(r){this.setParams(r),this._error(e,n),this.setParams({});return}this._error(e,n)}_error(e,r){(e?zt.reportExtraError:zt.reportError)(this,this.def.error,r)}$dataError(){(0,zt.reportError)(this,this.def.$dataError||zt.keyword$DataError)}reset(){if(this.errsCount===void 0)throw new Error('add "trackErrors" to keyword definition');(0,zt.resetErrorsCount)(this.gen,this.errsCount)}ok(e){this.allErrors||this.gen.if(e)}setParams(e,r){r?Object.assign(this.params,e):this.params=e}block$data(e,r,n=U.nil){this.gen.block(()=>{this.check$data(e,n),r()})}check$data(e=U.nil,r=U.nil){if(!this.$data)return;const{gen:n,schemaCode:s,schemaType:a,def:o}=this;n.if((0,U.or)((0,U._)`${s} === undefined`,r)),e!==U.nil&&n.assign(e,!0),(a.length||o.validateSchema)&&(n.elseIf(this.invalid$data()),this.$dataError(),e!==U.nil&&n.assign(e,!1)),n.else()}invalid$data(){const{gen:e,schemaCode:r,schemaType:n,def:s,it:a}=this;return(0,U.or)(o(),u());function o(){if(n.length){if(!(r instanceof U.Name))throw new Error("ajv implementation error");const d=Array.isArray(n)?n:[n];return(0,U._)`${(0,Sr.checkDataTypes)(d,r,a.opts.strictNumbers,Sr.DataType.Wrong)}`}return U.nil}function u(){if(s.validateSchema){const d=e.scopeValue("validate$data",{ref:s.validateSchema});return(0,U._)`!${d}(${r})`}return U.nil}}subschema(e,r){const n=(0,Vr.getSubschema)(this.it,e);(0,Vr.extendSubschemaData)(n,this.it,e),(0,Vr.extendSubschemaMode)(n,e);const s={...this.it,...n,items:void 0,props:void 0};return vc(s,r),s}mergeEvaluated(e,r){const{it:n,gen:s}=this;n.opts.unevaluated&&(n.props!==!0&&e.props!==void 0&&(n.props=Ke.mergeEvaluated.props(s,e.props,n.props,r)),n.items!==!0&&e.items!==void 0&&(n.items=Ke.mergeEvaluated.items(s,e.items,n.items,r)))}mergeValidEvaluated(e,r){const{it:n,gen:s}=this;if(n.opts.unevaluated&&(n.props!==!0||n.items!==!0))return s.if(r,()=>this.mergeEvaluated(e,U.Name)),!0}}ke.KeywordCxt=Oa;function Na(t,e,r,n){const s=new Oa(t,r,e);"code"in r?r.code(s,n):s.$data&&r.validate?(0,Jt.funcKeywordCode)(s,r):"macro"in r?(0,Jt.macroKeywordCode)(s,r):(r.compile||r.validate)&&(0,Jt.funcKeywordCode)(s,r)}const Ac=/^\/(?:[^~]|~0|~1)*$/,Dc=/^([0-9]+)(#|\/(?:[^~]|~0|~1)*)?$/;function Ca(t,{dataLevel:e,dataNames:r,dataPathArr:n}){let s,a;if(t==="")return L.default.rootData;if(t[0]==="/"){if(!Ac.test(t))throw new Error(`Invalid JSON-pointer: ${t}`);s=t,a=L.default.rootData}else{const l=Dc.exec(t);if(!l)throw new Error(`Invalid JSON-pointer: ${t}`);const f=+l[1];if(s=l[2],s==="#"){if(f>=e)throw new Error(d("property/index",f));return n[e-f]}if(f>e)throw new Error(d("data",f));if(a=r[e-f],!s)return a}let o=a;const u=s.split("/");for(const l of u)l&&(a=(0,U._)`${a}${(0,U.getProperty)((0,Ke.unescapeJsonPointer)(l))}`,o=(0,U._)`${o} && ${a}`);return o;function d(l,f){return`Cannot access ${l} ${f} levels up, current level is ${e}`}}ke.getData=Ca;var rr={};Object.defineProperty(rr,"__esModule",{value:!0});class jc extends Error{constructor(e){super("validation failed"),this.errors=e,this.ajv=this.validation=!0}}rr.default=jc;var nr={};Object.defineProperty(nr,"__esModule",{value:!0});const Hr=me;class Mc extends Error{constructor(e,r,n,s){super(s||`can't resolve reference ${n} from id ${r}`),this.missingRef=(0,Hr.resolveUrl)(e,r,n),this.missingSchema=(0,Hr.normalizeId)((0,Hr.getFullPath)(e,this.missingRef))}}nr.default=Mc;var we={};Object.defineProperty(we,"__esModule",{value:!0});we.resolveSchema=we.getCompilingSchema=we.resolveRef=we.compileSchema=we.SchemaEnv=void 0;const Oe=G,Fc=rr,st=Le,Ce=me,Ns=ee,qc=ke;class Dr{constructor(e){var r;this.refs={},this.dynamicAnchors={};let n;typeof e.schema=="object"&&(n=e.schema),this.schema=e.schema,this.schemaId=e.schemaId,this.root=e.root||this,this.baseId=(r=e.baseId)!==null&&r!==void 0?r:(0,Ce.normalizeId)(n?.[e.schemaId||"$id"]),this.schemaPath=e.schemaPath,this.localRefs=e.localRefs,this.meta=e.meta,this.$async=n?.$async,this.refs={}}}we.SchemaEnv=Dr;function dn(t){const e=ka.call(this,t);if(e)return e;const r=(0,Ce.getFullPath)(this.opts.uriResolver,t.root.baseId),{es5:n,lines:s}=this.opts.code,{ownProperties:a}=this.opts,o=new Oe.CodeGen(this.scope,{es5:n,lines:s,ownProperties:a});let u;t.$async&&(u=o.scopeValue("Error",{ref:Fc.default,code:(0,Oe._)`require("ajv/dist/runtime/validation_error").default`}));const d=o.scopeName("validate");t.validateName=d;const l={gen:o,allErrors:this.opts.allErrors,data:st.default.data,parentData:st.default.parentData,parentDataProperty:st.default.parentDataProperty,dataNames:[st.default.data],dataPathArr:[Oe.nil],dataLevel:0,dataTypes:[],definedProperties:new Set,topSchemaRef:o.scopeValue("schema",this.opts.code.source===!0?{ref:t.schema,code:(0,Oe.stringify)(t.schema)}:{ref:t.schema}),validateName:d,ValidationError:u,schema:t.schema,schemaEnv:t,rootId:r,baseId:t.baseId||r,schemaPath:Oe.nil,errSchemaPath:t.schemaPath||(this.opts.jtd?"":"#"),errorPath:(0,Oe._)`""`,opts:this.opts,self:this};let f;try{this._compilations.add(t),(0,qc.validateFunctionCode)(l),o.optimize(this.opts.code.optimize);const y=o.toString();f=`${o.scopeRefs(st.default.scope)}return ${y}`,this.opts.code.process&&(f=this.opts.code.process(f,t));const N=new Function(`${st.default.self}`,`${st.default.scope}`,f)(this,this.scope.get());if(this.scope.value(d,{ref:N}),N.errors=null,N.schema=t.schema,N.schemaEnv=t,t.$async&&(N.$async=!0),this.opts.code.source===!0&&(N.source={validateName:d,validateCode:y,scopeValues:o._values}),this.opts.unevaluated){const{props:b,items:R}=l;N.evaluated={props:b instanceof Oe.Name?void 0:b,items:R instanceof Oe.Name?void 0:R,dynamicProps:b instanceof Oe.Name,dynamicItems:R instanceof Oe.Name},N.source&&(N.source.evaluated=(0,Oe.stringify)(N.evaluated))}return t.validate=N,t}catch(y){throw delete t.validate,delete t.validateName,f&&this.logger.error("Error compiling schema, function code:",f),y}finally{this._compilations.delete(t)}}we.compileSchema=dn;function Uc(t,e,r){var n;r=(0,Ce.resolveUrl)(this.opts.uriResolver,e,r);const s=t.refs[r];if(s)return s;let a=Lc.call(this,t,r);if(a===void 0){const o=(n=t.localRefs)===null||n===void 0?void 0:n[r],{schemaId:u}=this.opts;o&&(a=new Dr({schema:o,schemaId:u,root:t,baseId:e}))}if(a!==void 0)return t.refs[r]=Vc.call(this,a)}we.resolveRef=Uc;function Vc(t){return(0,Ce.inlineRef)(t.schema,this.opts.inlineRefs)?t.schema:t.validate?t:dn.call(this,t)}function ka(t){for(const e of this._compilations)if(Hc(e,t))return e}we.getCompilingSchema=ka;function Hc(t,e){return t.schema===e.schema&&t.root===e.root&&t.baseId===e.baseId}function Lc(t,e){let r;for(;typeof(r=this.refs[e])=="string";)e=r;return r||this.schemas[e]||jr.call(this,t,e)}function jr(t,e){const r=this.opts.uriResolver.parse(e),n=(0,Ce._getFullPath)(this.opts.uriResolver,r);let s=(0,Ce.getFullPath)(this.opts.uriResolver,t.baseId,void 0);if(Object.keys(t.schema).length>0&&n===s)return Lr.call(this,r,t);const a=(0,Ce.normalizeId)(n),o=this.refs[a]||this.schemas[a];if(typeof o=="string"){const u=jr.call(this,t,o);return typeof u?.schema!="object"?void 0:Lr.call(this,r,u)}if(typeof o?.schema=="object"){if(o.validate||dn.call(this,o),a===(0,Ce.normalizeId)(e)){const{schema:u}=o,{schemaId:d}=this.opts,l=u[d];return l&&(s=(0,Ce.resolveUrl)(this.opts.uriResolver,s,l)),new Dr({schema:u,schemaId:d,root:t,baseId:s})}return Lr.call(this,r,o)}}we.resolveSchema=jr;const zc=new Set(["properties","patternProperties","enum","dependencies","definitions"]);function Lr(t,{baseId:e,schema:r,root:n}){var s;if(((s=t.fragment)===null||s===void 0?void 0:s[0])!=="/")return;for(const u of t.fragment.slice(1).split("/")){if(typeof r=="boolean")return;const d=r[(0,Ns.unescapeFragment)(u)];if(d===void 0)return;r=d;const l=typeof r=="object"&&r[this.opts.schemaId];!zc.has(u)&&l&&(e=(0,Ce.resolveUrl)(this.opts.uriResolver,e,l))}let a;if(typeof r!="boolean"&&r.$ref&&!(0,Ns.schemaHasRulesButRef)(r,this.RULES)){const u=(0,Ce.resolveUrl)(this.opts.uriResolver,e,r.$ref);a=jr.call(this,n,u)}const{schemaId:o}=this.opts;if(a=a||new Dr({schema:r,schemaId:o,root:n,baseId:e}),a.schema!==a.root.schema)return a}const Wc="https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#",Kc="Meta-schema for $data reference (JSON AnySchema extension proposal)",Gc="object",Bc=["$data"],Jc={$data:{type:"string",anyOf:[{format:"relative-json-pointer"},{format:"json-pointer"}]}},xc=!1;var Yc={$id:Wc,description:Kc,type:Gc,required:Bc,properties:Jc,additionalProperties:xc},fn={},Qr={exports:{}};/** @license URI.js v4.4.1 (c) 2011 Gary Court. License: http://github.com/garycourt/uri-js */(function(t,e){(function(r,n){n(e)})(yi,function(r){function n(){for(var h=arguments.length,c=Array(h),m=0;m<h;m++)c[m]=arguments[m];if(c.length>1){c[0]=c[0].slice(0,-1);for(var P=c.length-1,E=1;E<P;++E)c[E]=c[E].slice(1,-1);return c[P]=c[P].slice(1),c.join("")}else return c[0]}function s(h){return"(?:"+h+")"}function a(h){return h===void 0?"undefined":h===null?"null":Object.prototype.toString.call(h).split(" ").pop().split("]").shift().toLowerCase()}function o(h){return h.toUpperCase()}function u(h){return h!=null?h instanceof Array?h:typeof h.length!="number"||h.split||h.setInterval||h.call?[h]:Array.prototype.slice.call(h):[]}function d(h,c){var m=h;if(c)for(var P in c)m[P]=c[P];return m}function l(h){var c="[A-Za-z]",m="[0-9]",P=n(m,"[A-Fa-f]"),E=s(s("%[EFef]"+P+"%"+P+P+"%"+P+P)+"|"+s("%[89A-Fa-f]"+P+"%"+P+P)+"|"+s("%"+P+P)),V="[\\:\\/\\?\\#\\[\\]\\@]",H="[\\!\\$\\&\\'\\(\\)\\*\\+\\,\\;\\=]",Z=n(V,H),re=h?"[\\xA0-\\u200D\\u2010-\\u2029\\u202F-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]":"[]",ce=h?"[\\uE000-\\uF8FF]":"[]",x=n(c,m,"[\\-\\.\\_\\~]",re);s(c+n(c,m,"[\\+\\-\\.]")+"*"),s(s(E+"|"+n(x,H,"[\\:]"))+"*");var te=s(s("25[0-5]")+"|"+s("2[0-4]"+m)+"|"+s("1"+m+m)+"|"+s("0?[1-9]"+m)+"|0?0?"+m),ue=s(te+"\\."+te+"\\."+te+"\\."+te),W=s(P+"{1,4}"),se=s(s(W+"\\:"+W)+"|"+ue),he=s(s(W+"\\:")+"{6}"+se),ae=s("\\:\\:"+s(W+"\\:")+"{5}"+se),Ge=s(s(W)+"?\\:\\:"+s(W+"\\:")+"{4}"+se),Fe=s(s(s(W+"\\:")+"{0,1}"+W)+"?\\:\\:"+s(W+"\\:")+"{3}"+se),qe=s(s(s(W+"\\:")+"{0,2}"+W)+"?\\:\\:"+s(W+"\\:")+"{2}"+se),_t=s(s(s(W+"\\:")+"{0,3}"+W)+"?\\:\\:"+W+"\\:"+se),rt=s(s(s(W+"\\:")+"{0,4}"+W)+"?\\:\\:"+se),Se=s(s(s(W+"\\:")+"{0,5}"+W)+"?\\:\\:"+W),Ue=s(s(s(W+"\\:")+"{0,6}"+W)+"?\\:\\:"),nt=s([he,ae,Ge,Fe,qe,_t,rt,Se,Ue].join("|")),ze=s(s(x+"|"+E)+"+");s("[vV]"+P+"+\\."+n(x,H,"[\\:]")+"+"),s(s(E+"|"+n(x,H))+"*");var Ht=s(E+"|"+n(x,H,"[\\:\\@]"));return s(s(E+"|"+n(x,H,"[\\@]"))+"+"),s(s(Ht+"|"+n("[\\/\\?]",ce))+"*"),{NOT_SCHEME:new RegExp(n("[^]",c,m,"[\\+\\-\\.]"),"g"),NOT_USERINFO:new RegExp(n("[^\\%\\:]",x,H),"g"),NOT_HOST:new RegExp(n("[^\\%\\[\\]\\:]",x,H),"g"),NOT_PATH:new RegExp(n("[^\\%\\/\\:\\@]",x,H),"g"),NOT_PATH_NOSCHEME:new RegExp(n("[^\\%\\/\\@]",x,H),"g"),NOT_QUERY:new RegExp(n("[^\\%]",x,H,"[\\:\\@\\/\\?]",ce),"g"),NOT_FRAGMENT:new RegExp(n("[^\\%]",x,H,"[\\:\\@\\/\\?]"),"g"),ESCAPE:new RegExp(n("[^]",x,H),"g"),UNRESERVED:new RegExp(x,"g"),OTHER_CHARS:new RegExp(n("[^\\%]",x,Z),"g"),PCT_ENCODED:new RegExp(E,"g"),IPV4ADDRESS:new RegExp("^("+ue+")$"),IPV6ADDRESS:new RegExp("^\\[?("+nt+")"+s(s("\\%25|\\%(?!"+P+"{2})")+"("+ze+")")+"?\\]?$")}}var f=l(!1),y=l(!0),S=function(){function h(c,m){var P=[],E=!0,V=!1,H=void 0;try{for(var Z=c[Symbol.iterator](),re;!(E=(re=Z.next()).done)&&(P.push(re.value),!(m&&P.length===m));E=!0);}catch(ce){V=!0,H=ce}finally{try{!E&&Z.return&&Z.return()}finally{if(V)throw H}}return P}return function(c,m){if(Array.isArray(c))return c;if(Symbol.iterator in Object(c))return h(c,m);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),N=function(h){if(Array.isArray(h)){for(var c=0,m=Array(h.length);c<h.length;c++)m[c]=h[c];return m}else return Array.from(h)},b=2147483647,R=36,v=1,g=26,T=38,O=700,I=72,j=128,_="-",C=/^xn--/,D=/[^\0-\x7E]/,z=/[\x2E\u3002\uFF0E\uFF61]/g,B={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},oe=R-v,X=Math.floor,be=String.fromCharCode;function fe(h){throw new RangeError(B[h])}function Xe(h,c){for(var m=[],P=h.length;P--;)m[P]=c(h[P]);return m}function Ze(h,c){var m=h.split("@"),P="";m.length>1&&(P=m[0]+"@",h=m[1]),h=h.replace(z,".");var E=h.split("."),V=Xe(E,c).join(".");return P+V}function ft(h){for(var c=[],m=0,P=h.length;m<P;){var E=h.charCodeAt(m++);if(E>=55296&&E<=56319&&m<P){var V=h.charCodeAt(m++);(V&64512)==56320?c.push(((E&1023)<<10)+(V&1023)+65536):(c.push(E),m--)}else c.push(E)}return c}var At=function(c){return String.fromCodePoint.apply(String,N(c))},ht=function(c){return c-48<10?c-22:c-65<26?c-65:c-97<26?c-97:R},M=function(c,m){return c+22+75*(c<26)-((m!=0)<<5)},$=function(c,m,P){var E=0;for(c=P?X(c/O):c>>1,c+=X(c/m);c>oe*g>>1;E+=R)c=X(c/oe);return X(E+(oe+1)*c/(c+T))},A=function(c){var m=[],P=c.length,E=0,V=j,H=I,Z=c.lastIndexOf(_);Z<0&&(Z=0);for(var re=0;re<Z;++re)c.charCodeAt(re)>=128&&fe("not-basic"),m.push(c.charCodeAt(re));for(var ce=Z>0?Z+1:0;ce<P;){for(var x=E,te=1,ue=R;;ue+=R){ce>=P&&fe("invalid-input");var W=ht(c.charCodeAt(ce++));(W>=R||W>X((b-E)/te))&&fe("overflow"),E+=W*te;var se=ue<=H?v:ue>=H+g?g:ue-H;if(W<se)break;var he=R-se;te>X(b/he)&&fe("overflow"),te*=he}var ae=m.length+1;H=$(E-x,ae,x==0),X(E/ae)>b-V&&fe("overflow"),V+=X(E/ae),E%=ae,m.splice(E++,0,V)}return String.fromCodePoint.apply(String,m)},w=function(c){var m=[];c=ft(c);var P=c.length,E=j,V=0,H=I,Z=!0,re=!1,ce=void 0;try{for(var x=c[Symbol.iterator](),te;!(Z=(te=x.next()).done);Z=!0){var ue=te.value;ue<128&&m.push(be(ue))}}catch(Lt){re=!0,ce=Lt}finally{try{!Z&&x.return&&x.return()}finally{if(re)throw ce}}var W=m.length,se=W;for(W&&m.push(_);se<P;){var he=b,ae=!0,Ge=!1,Fe=void 0;try{for(var qe=c[Symbol.iterator](),_t;!(ae=(_t=qe.next()).done);ae=!0){var rt=_t.value;rt>=E&&rt<he&&(he=rt)}}catch(Lt){Ge=!0,Fe=Lt}finally{try{!ae&&qe.return&&qe.return()}finally{if(Ge)throw Fe}}var Se=se+1;he-E>X((b-V)/Se)&&fe("overflow"),V+=(he-E)*Se,E=he;var Ue=!0,nt=!1,ze=void 0;try{for(var Ht=c[Symbol.iterator](),es;!(Ue=(es=Ht.next()).done);Ue=!0){var ts=es.value;if(ts<E&&++V>b&&fe("overflow"),ts==E){for(var or=V,ir=R;;ir+=R){var cr=ir<=H?v:ir>=H+g?g:ir-H;if(or<cr)break;var rs=or-cr,ns=R-cr;m.push(be(M(cr+rs%ns,0))),or=X(rs/ns)}m.push(be(M(or,0))),H=$(V,Se,se==W),V=0,++se}}}catch(Lt){nt=!0,ze=Lt}finally{try{!Ue&&Ht.return&&Ht.return()}finally{if(nt)throw ze}}++V,++E}return m.join("")},i=function(c){return Ze(c,function(m){return C.test(m)?A(m.slice(4).toLowerCase()):m})},p=function(c){return Ze(c,function(m){return D.test(m)?"xn--"+w(m):m})},k={version:"2.1.0",ucs2:{decode:ft,encode:At},decode:A,encode:w,toASCII:p,toUnicode:i},F={};function q(h){var c=h.charCodeAt(0),m=void 0;return c<16?m="%0"+c.toString(16).toUpperCase():c<128?m="%"+c.toString(16).toUpperCase():c<2048?m="%"+(c>>6|192).toString(16).toUpperCase()+"%"+(c&63|128).toString(16).toUpperCase():m="%"+(c>>12|224).toString(16).toUpperCase()+"%"+(c>>6&63|128).toString(16).toUpperCase()+"%"+(c&63|128).toString(16).toUpperCase(),m}function J(h){for(var c="",m=0,P=h.length;m<P;){var E=parseInt(h.substr(m+1,2),16);if(E<128)c+=String.fromCharCode(E),m+=3;else if(E>=194&&E<224){if(P-m>=6){var V=parseInt(h.substr(m+4,2),16);c+=String.fromCharCode((E&31)<<6|V&63)}else c+=h.substr(m,6);m+=6}else if(E>=224){if(P-m>=9){var H=parseInt(h.substr(m+4,2),16),Z=parseInt(h.substr(m+7,2),16);c+=String.fromCharCode((E&15)<<12|(H&63)<<6|Z&63)}else c+=h.substr(m,9);m+=9}else c+=h.substr(m,3),m+=3}return c}function Y(h,c){function m(P){var E=J(P);return E.match(c.UNRESERVED)?E:P}return h.scheme&&(h.scheme=String(h.scheme).replace(c.PCT_ENCODED,m).toLowerCase().replace(c.NOT_SCHEME,"")),h.userinfo!==void 0&&(h.userinfo=String(h.userinfo).replace(c.PCT_ENCODED,m).replace(c.NOT_USERINFO,q).replace(c.PCT_ENCODED,o)),h.host!==void 0&&(h.host=String(h.host).replace(c.PCT_ENCODED,m).toLowerCase().replace(c.NOT_HOST,q).replace(c.PCT_ENCODED,o)),h.path!==void 0&&(h.path=String(h.path).replace(c.PCT_ENCODED,m).replace(h.scheme?c.NOT_PATH:c.NOT_PATH_NOSCHEME,q).replace(c.PCT_ENCODED,o)),h.query!==void 0&&(h.query=String(h.query).replace(c.PCT_ENCODED,m).replace(c.NOT_QUERY,q).replace(c.PCT_ENCODED,o)),h.fragment!==void 0&&(h.fragment=String(h.fragment).replace(c.PCT_ENCODED,m).replace(c.NOT_FRAGMENT,q).replace(c.PCT_ENCODED,o)),h}function ie(h){return h.replace(/^0*(.*)/,"$1")||"0"}function De(h,c){var m=h.match(c.IPV4ADDRESS)||[],P=S(m,2),E=P[1];return E?E.split(".").map(ie).join("."):h}function pt(h,c){var m=h.match(c.IPV6ADDRESS)||[],P=S(m,3),E=P[1],V=P[2];if(E){for(var H=E.toLowerCase().split("::").reverse(),Z=S(H,2),re=Z[0],ce=Z[1],x=ce?ce.split(":").map(ie):[],te=re.split(":").map(ie),ue=c.IPV4ADDRESS.test(te[te.length-1]),W=ue?7:8,se=te.length-W,he=Array(W),ae=0;ae<W;++ae)he[ae]=x[ae]||te[se+ae]||"";ue&&(he[W-1]=De(he[W-1],c));var Ge=he.reduce(function(Se,Ue,nt){if(!Ue||Ue==="0"){var ze=Se[Se.length-1];ze&&ze.index+ze.length===nt?ze.length++:Se.push({index:nt,length:1})}return Se},[]),Fe=Ge.sort(function(Se,Ue){return Ue.length-Se.length})[0],qe=void 0;if(Fe&&Fe.length>1){var _t=he.slice(0,Fe.index),rt=he.slice(Fe.index+Fe.length);qe=_t.join(":")+"::"+rt.join(":")}else qe=he.join(":");return V&&(qe+="%"+V),qe}else return h}var Dt=/^(?:([^:\/?#]+):)?(?:\/\/((?:([^\/?#@]*)@)?(\[[^\/?#\]]+\]|[^\/?#:]*)(?:\:(\d*))?))?([^?#]*)(?:\?([^#]*))?(?:#((?:.|\n|\r)*))?/i,jt="".match(/(){0}/)[1]===void 0;function Ee(h){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},m={},P=c.iri!==!1?y:f;c.reference==="suffix"&&(h=(c.scheme?c.scheme+":":"")+"//"+h);var E=h.match(Dt);if(E){jt?(m.scheme=E[1],m.userinfo=E[3],m.host=E[4],m.port=parseInt(E[5],10),m.path=E[6]||"",m.query=E[7],m.fragment=E[8],isNaN(m.port)&&(m.port=E[5])):(m.scheme=E[1]||void 0,m.userinfo=h.indexOf("@")!==-1?E[3]:void 0,m.host=h.indexOf("//")!==-1?E[4]:void 0,m.port=parseInt(E[5],10),m.path=E[6]||"",m.query=h.indexOf("?")!==-1?E[7]:void 0,m.fragment=h.indexOf("#")!==-1?E[8]:void 0,isNaN(m.port)&&(m.port=h.match(/\/\/(?:.|\n)*\:(?:\/|\?|\#|$)/)?E[4]:void 0)),m.host&&(m.host=pt(De(m.host,P),P)),m.scheme===void 0&&m.userinfo===void 0&&m.host===void 0&&m.port===void 0&&!m.path&&m.query===void 0?m.reference="same-document":m.scheme===void 0?m.reference="relative":m.fragment===void 0?m.reference="absolute":m.reference="uri",c.reference&&c.reference!=="suffix"&&c.reference!==m.reference&&(m.error=m.error||"URI is not a "+c.reference+" reference.");var V=F[(c.scheme||m.scheme||"").toLowerCase()];if(!c.unicodeSupport&&(!V||!V.unicodeSupport)){if(m.host&&(c.domainHost||V&&V.domainHost))try{m.host=k.toASCII(m.host.replace(P.PCT_ENCODED,J).toLowerCase())}catch(H){m.error=m.error||"Host's domain name can not be converted to ASCII via punycode: "+H}Y(m,f)}else Y(m,P);V&&V.parse&&V.parse(m,c)}else m.error=m.error||"URI can not be parsed.";return m}function Mt(h,c){var m=c.iri!==!1?y:f,P=[];return h.userinfo!==void 0&&(P.push(h.userinfo),P.push("@")),h.host!==void 0&&P.push(pt(De(String(h.host),m),m).replace(m.IPV6ADDRESS,function(E,V,H){return"["+V+(H?"%25"+H:"")+"]"})),(typeof h.port=="number"||typeof h.port=="string")&&(P.push(":"),P.push(String(h.port))),P.length?P.join(""):void 0}var mt=/^\.\.?\//,yt=/^\/\.(\/|$)/,gt=/^\/\.\.(\/|$)/,Ft=/^\/?(?:.|\n)*?(?=\/|$)/;function je(h){for(var c=[];h.length;)if(h.match(mt))h=h.replace(mt,"");else if(h.match(yt))h=h.replace(yt,"/");else if(h.match(gt))h=h.replace(gt,"/"),c.pop();else if(h==="."||h==="..")h="";else{var m=h.match(Ft);if(m){var P=m[0];h=h.slice(P.length),c.push(P)}else throw new Error("Unexpected dot segment condition")}return c.join("")}function ve(h){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},m=c.iri?y:f,P=[],E=F[(c.scheme||h.scheme||"").toLowerCase()];if(E&&E.serialize&&E.serialize(h,c),h.host&&!m.IPV6ADDRESS.test(h.host)){if(c.domainHost||E&&E.domainHost)try{h.host=c.iri?k.toUnicode(h.host):k.toASCII(h.host.replace(m.PCT_ENCODED,J).toLowerCase())}catch(Z){h.error=h.error||"Host's domain name can not be converted to "+(c.iri?"Unicode":"ASCII")+" via punycode: "+Z}}Y(h,m),c.reference!=="suffix"&&h.scheme&&(P.push(h.scheme),P.push(":"));var V=Mt(h,c);if(V!==void 0&&(c.reference!=="suffix"&&P.push("//"),P.push(V),h.path&&h.path.charAt(0)!=="/"&&P.push("/")),h.path!==void 0){var H=h.path;!c.absolutePath&&(!E||!E.absolutePath)&&(H=je(H)),V===void 0&&(H=H.replace(/^\/\//,"/%2F")),P.push(H)}return h.query!==void 0&&(P.push("?"),P.push(h.query)),h.fragment!==void 0&&(P.push("#"),P.push(h.fragment)),P.join("")}function $t(h,c){var m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},P=arguments[3],E={};return P||(h=Ee(ve(h,m),m),c=Ee(ve(c,m),m)),m=m||{},!m.tolerant&&c.scheme?(E.scheme=c.scheme,E.userinfo=c.userinfo,E.host=c.host,E.port=c.port,E.path=je(c.path||""),E.query=c.query):(c.userinfo!==void 0||c.host!==void 0||c.port!==void 0?(E.userinfo=c.userinfo,E.host=c.host,E.port=c.port,E.path=je(c.path||""),E.query=c.query):(c.path?(c.path.charAt(0)==="/"?E.path=je(c.path):((h.userinfo!==void 0||h.host!==void 0||h.port!==void 0)&&!h.path?E.path="/"+c.path:h.path?E.path=h.path.slice(0,h.path.lastIndexOf("/")+1)+c.path:E.path=c.path,E.path=je(E.path)),E.query=c.query):(E.path=h.path,c.query!==void 0?E.query=c.query:E.query=h.query),E.userinfo=h.userinfo,E.host=h.host,E.port=h.port),E.scheme=h.scheme),E.fragment=c.fragment,E}function qt(h,c,m){var P=d({scheme:"null"},m);return ve($t(Ee(h,P),Ee(c,P),P,!0),P)}function et(h,c){return typeof h=="string"?h=ve(Ee(h,c),c):a(h)==="object"&&(h=Ee(ve(h,c),c)),h}function Ut(h,c,m){return typeof h=="string"?h=ve(Ee(h,m),m):a(h)==="object"&&(h=ve(h,m)),typeof c=="string"?c=ve(Ee(c,m),m):a(c)==="object"&&(c=ve(c,m)),h===c}function ar(h,c){return h&&h.toString().replace(!c||!c.iri?f.ESCAPE:y.ESCAPE,q)}function Pe(h,c){return h&&h.toString().replace(!c||!c.iri?f.PCT_ENCODED:y.PCT_ENCODED,J)}var tt={scheme:"http",domainHost:!0,parse:function(c,m){return c.host||(c.error=c.error||"HTTP URIs must have a host."),c},serialize:function(c,m){var P=String(c.scheme).toLowerCase()==="https";return(c.port===(P?443:80)||c.port==="")&&(c.port=void 0),c.path||(c.path="/"),c}},Gn={scheme:"https",domainHost:tt.domainHost,parse:tt.parse,serialize:tt.serialize};function Bn(h){return typeof h.secure=="boolean"?h.secure:String(h.scheme).toLowerCase()==="wss"}var Vt={scheme:"ws",domainHost:!0,parse:function(c,m){var P=c;return P.secure=Bn(P),P.resourceName=(P.path||"/")+(P.query?"?"+P.query:""),P.path=void 0,P.query=void 0,P},serialize:function(c,m){if((c.port===(Bn(c)?443:80)||c.port==="")&&(c.port=void 0),typeof c.secure=="boolean"&&(c.scheme=c.secure?"wss":"ws",c.secure=void 0),c.resourceName){var P=c.resourceName.split("?"),E=S(P,2),V=E[0],H=E[1];c.path=V&&V!=="/"?V:void 0,c.query=H,c.resourceName=void 0}return c.fragment=void 0,c}},Jn={scheme:"wss",domainHost:Vt.domainHost,parse:Vt.parse,serialize:Vt.serialize},Ba={},xn="[A-Za-z0-9\\-\\.\\_\\~\\xA0-\\u200D\\u2010-\\u2029\\u202F-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]",Me="[0-9A-Fa-f]",Ja=s(s("%[EFef]"+Me+"%"+Me+Me+"%"+Me+Me)+"|"+s("%[89A-Fa-f]"+Me+"%"+Me+Me)+"|"+s("%"+Me+Me)),xa="[A-Za-z0-9\\!\\$\\%\\'\\*\\+\\-\\^\\_\\`\\{\\|\\}\\~]",Ya="[\\!\\$\\%\\'\\(\\)\\*\\+\\,\\-\\.0-9\\<\\>A-Z\\x5E-\\x7E]",Qa=n(Ya,'[\\"\\\\]'),Xa="[\\!\\$\\'\\(\\)\\*\\+\\,\\;\\:\\@]",Za=new RegExp(xn,"g"),vt=new RegExp(Ja,"g"),eo=new RegExp(n("[^]",xa,"[\\.]",'[\\"]',Qa),"g"),Yn=new RegExp(n("[^]",xn,Xa),"g"),to=Yn;function Fr(h){var c=J(h);return c.match(Za)?c:h}var Qn={scheme:"mailto",parse:function(c,m){var P=c,E=P.to=P.path?P.path.split(","):[];if(P.path=void 0,P.query){for(var V=!1,H={},Z=P.query.split("&"),re=0,ce=Z.length;re<ce;++re){var x=Z[re].split("=");switch(x[0]){case"to":for(var te=x[1].split(","),ue=0,W=te.length;ue<W;++ue)E.push(te[ue]);break;case"subject":P.subject=Pe(x[1],m);break;case"body":P.body=Pe(x[1],m);break;default:V=!0,H[Pe(x[0],m)]=Pe(x[1],m);break}}V&&(P.headers=H)}P.query=void 0;for(var se=0,he=E.length;se<he;++se){var ae=E[se].split("@");if(ae[0]=Pe(ae[0]),m.unicodeSupport)ae[1]=Pe(ae[1],m).toLowerCase();else try{ae[1]=k.toASCII(Pe(ae[1],m).toLowerCase())}catch(Ge){P.error=P.error||"Email address's domain name can not be converted to ASCII via punycode: "+Ge}E[se]=ae.join("@")}return P},serialize:function(c,m){var P=c,E=u(c.to);if(E){for(var V=0,H=E.length;V<H;++V){var Z=String(E[V]),re=Z.lastIndexOf("@"),ce=Z.slice(0,re).replace(vt,Fr).replace(vt,o).replace(eo,q),x=Z.slice(re+1);try{x=m.iri?k.toUnicode(x):k.toASCII(Pe(x,m).toLowerCase())}catch(se){P.error=P.error||"Email address's domain name can not be converted to "+(m.iri?"Unicode":"ASCII")+" via punycode: "+se}E[V]=ce+"@"+x}P.path=E.join(",")}var te=c.headers=c.headers||{};c.subject&&(te.subject=c.subject),c.body&&(te.body=c.body);var ue=[];for(var W in te)te[W]!==Ba[W]&&ue.push(W.replace(vt,Fr).replace(vt,o).replace(Yn,q)+"="+te[W].replace(vt,Fr).replace(vt,o).replace(to,q));return ue.length&&(P.query=ue.join("&")),P}},ro=/^([^\:]+)\:(.*)/,Xn={scheme:"urn",parse:function(c,m){var P=c.path&&c.path.match(ro),E=c;if(P){var V=m.scheme||E.scheme||"urn",H=P[1].toLowerCase(),Z=P[2],re=V+":"+(m.nid||H),ce=F[re];E.nid=H,E.nss=Z,E.path=void 0,ce&&(E=ce.parse(E,m))}else E.error=E.error||"URN can not be parsed.";return E},serialize:function(c,m){var P=m.scheme||c.scheme||"urn",E=c.nid,V=P+":"+(m.nid||E),H=F[V];H&&(c=H.serialize(c,m));var Z=c,re=c.nss;return Z.path=(E||m.nid)+":"+re,Z}},no=/^[0-9A-Fa-f]{8}(?:\-[0-9A-Fa-f]{4}){3}\-[0-9A-Fa-f]{12}$/,Zn={scheme:"urn:uuid",parse:function(c,m){var P=c;return P.uuid=P.nss,P.nss=void 0,!m.tolerant&&(!P.uuid||!P.uuid.match(no))&&(P.error=P.error||"UUID is not valid."),P},serialize:function(c,m){var P=c;return P.nss=(c.uuid||"").toLowerCase(),P}};F[tt.scheme]=tt,F[Gn.scheme]=Gn,F[Vt.scheme]=Vt,F[Jn.scheme]=Jn,F[Qn.scheme]=Qn,F[Xn.scheme]=Xn,F[Zn.scheme]=Zn,r.SCHEMES=F,r.pctEncChar=q,r.pctDecChars=J,r.parse=Ee,r.removeDotSegments=je,r.serialize=ve,r.resolveComponents=$t,r.resolve=qt,r.normalize=et,r.equal=Ut,r.escapeComponent=ar,r.unescapeComponent=Pe,Object.defineProperty(r,"__esModule",{value:!0})})})(Qr,Qr.exports);var Qc=Qr.exports;Object.defineProperty(fn,"__esModule",{value:!0});const Ia=Qc;Ia.code='require("ajv/dist/runtime/uri").default';fn.default=Ia;(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.CodeGen=t.Name=t.nil=t.stringify=t.str=t._=t.KeywordCxt=void 0;var e=ke;Object.defineProperty(t,"KeywordCxt",{enumerable:!0,get:function(){return e.KeywordCxt}});var r=G;Object.defineProperty(t,"_",{enumerable:!0,get:function(){return r._}}),Object.defineProperty(t,"str",{enumerable:!0,get:function(){return r.str}}),Object.defineProperty(t,"stringify",{enumerable:!0,get:function(){return r.stringify}}),Object.defineProperty(t,"nil",{enumerable:!0,get:function(){return r.nil}}),Object.defineProperty(t,"Name",{enumerable:!0,get:function(){return r.Name}}),Object.defineProperty(t,"CodeGen",{enumerable:!0,get:function(){return r.CodeGen}});const n=rr,s=nr,a=lt,o=we,u=G,d=me,l=tr,f=ee,y=Yc,S=fn,N=(M,$)=>new RegExp(M,$);N.code="new RegExp";const b=["removeAdditional","useDefaults","coerceTypes"],R=new Set(["validate","serialize","parse","wrapper","root","schema","keyword","pattern","formats","validate$data","func","obj","Error"]),v={errorDataPath:"",format:"`validateFormats: false` can be used instead.",nullable:'"nullable" keyword is supported by default.',jsonPointers:"Deprecated jsPropertySyntax can be used instead.",extendRefs:"Deprecated ignoreKeywordsWithRef can be used instead.",missingRefs:"Pass empty schema with $id that should be ignored to ajv.addSchema.",processCode:"Use option `code: {process: (code, schemaEnv: object) => string}`",sourceCode:"Use option `code: {source: true}`",strictDefaults:"It is default now, see option `strict`.",strictKeywords:"It is default now, see option `strict`.",uniqueItems:'"uniqueItems" keyword is always validated.',unknownFormats:"Disable strict mode or pass `true` to `ajv.addFormat` (or `formats` option).",cache:"Map is used as cache, schema object as key.",serialize:"Map is used as cache, schema object as key.",ajvErrors:"It is default now."},g={ignoreKeywordsWithRef:"",jsPropertySyntax:"",unicode:'"minLength"/"maxLength" account for unicode characters by default.'},T=200;function O(M){var $,A,w,i,p,k,F,q,J,Y,ie,De,pt,Dt,jt,Ee,Mt,mt,yt,gt,Ft,je,ve,$t,qt;const et=M.strict,Ut=($=M.code)===null||$===void 0?void 0:$.optimize,ar=Ut===!0||Ut===void 0?1:Ut||0,Pe=(w=(A=M.code)===null||A===void 0?void 0:A.regExp)!==null&&w!==void 0?w:N,tt=(i=M.uriResolver)!==null&&i!==void 0?i:S.default;return{strictSchema:(k=(p=M.strictSchema)!==null&&p!==void 0?p:et)!==null&&k!==void 0?k:!0,strictNumbers:(q=(F=M.strictNumbers)!==null&&F!==void 0?F:et)!==null&&q!==void 0?q:!0,strictTypes:(Y=(J=M.strictTypes)!==null&&J!==void 0?J:et)!==null&&Y!==void 0?Y:"log",strictTuples:(De=(ie=M.strictTuples)!==null&&ie!==void 0?ie:et)!==null&&De!==void 0?De:"log",strictRequired:(Dt=(pt=M.strictRequired)!==null&&pt!==void 0?pt:et)!==null&&Dt!==void 0?Dt:!1,code:M.code?{...M.code,optimize:ar,regExp:Pe}:{optimize:ar,regExp:Pe},loopRequired:(jt=M.loopRequired)!==null&&jt!==void 0?jt:T,loopEnum:(Ee=M.loopEnum)!==null&&Ee!==void 0?Ee:T,meta:(Mt=M.meta)!==null&&Mt!==void 0?Mt:!0,messages:(mt=M.messages)!==null&&mt!==void 0?mt:!0,inlineRefs:(yt=M.inlineRefs)!==null&&yt!==void 0?yt:!0,schemaId:(gt=M.schemaId)!==null&&gt!==void 0?gt:"$id",addUsedSchema:(Ft=M.addUsedSchema)!==null&&Ft!==void 0?Ft:!0,validateSchema:(je=M.validateSchema)!==null&&je!==void 0?je:!0,validateFormats:(ve=M.validateFormats)!==null&&ve!==void 0?ve:!0,unicodeRegExp:($t=M.unicodeRegExp)!==null&&$t!==void 0?$t:!0,int32range:(qt=M.int32range)!==null&&qt!==void 0?qt:!0,uriResolver:tt}}class I{constructor($={}){this.schemas={},this.refs={},this.formats={},this._compilations=new Set,this._loading={},this._cache=new Map,$=this.opts={...$,...O($)};const{es5:A,lines:w}=this.opts.code;this.scope=new u.ValueScope({scope:{},prefixes:R,es5:A,lines:w}),this.logger=X($.logger);const i=$.validateFormats;$.validateFormats=!1,this.RULES=(0,a.getRules)(),j.call(this,v,$,"NOT SUPPORTED"),j.call(this,g,$,"DEPRECATED","warn"),this._metaOpts=B.call(this),$.formats&&D.call(this),this._addVocabularies(),this._addDefaultMetaSchema(),$.keywords&&z.call(this,$.keywords),typeof $.meta=="object"&&this.addMetaSchema($.meta),C.call(this),$.validateFormats=i}_addVocabularies(){this.addKeyword("$async")}_addDefaultMetaSchema(){const{$data:$,meta:A,schemaId:w}=this.opts;let i=y;w==="id"&&(i={...y},i.id=i.$id,delete i.$id),A&&$&&this.addMetaSchema(i,i[w],!1)}defaultMeta(){const{meta:$,schemaId:A}=this.opts;return this.opts.defaultMeta=typeof $=="object"?$[A]||$:void 0}validate($,A){let w;if(typeof $=="string"){if(w=this.getSchema($),!w)throw new Error(`no schema with key or ref "${$}"`)}else w=this.compile($);const i=w(A);return"$async"in w||(this.errors=w.errors),i}compile($,A){const w=this._addSchema($,A);return w.validate||this._compileSchemaEnv(w)}compileAsync($,A){if(typeof this.opts.loadSchema!="function")throw new Error("options.loadSchema should be a function");const{loadSchema:w}=this.opts;return i.call(this,$,A);async function i(Y,ie){await p.call(this,Y.$schema);const De=this._addSchema(Y,ie);return De.validate||k.call(this,De)}async function p(Y){Y&&!this.getSchema(Y)&&await i.call(this,{$ref:Y},!0)}async function k(Y){try{return this._compileSchemaEnv(Y)}catch(ie){if(!(ie instanceof s.default))throw ie;return F.call(this,ie),await q.call(this,ie.missingSchema),k.call(this,Y)}}function F({missingSchema:Y,missingRef:ie}){if(this.refs[Y])throw new Error(`AnySchema ${Y} is loaded but ${ie} cannot be resolved`)}async function q(Y){const ie=await J.call(this,Y);this.refs[Y]||await p.call(this,ie.$schema),this.refs[Y]||this.addSchema(ie,Y,A)}async function J(Y){const ie=this._loading[Y];if(ie)return ie;try{return await(this._loading[Y]=w(Y))}finally{delete this._loading[Y]}}}addSchema($,A,w,i=this.opts.validateSchema){if(Array.isArray($)){for(const k of $)this.addSchema(k,void 0,w,i);return this}let p;if(typeof $=="object"){const{schemaId:k}=this.opts;if(p=$[k],p!==void 0&&typeof p!="string")throw new Error(`schema ${k} must be string`)}return A=(0,d.normalizeId)(A||p),this._checkUnique(A),this.schemas[A]=this._addSchema($,w,A,i,!0),this}addMetaSchema($,A,w=this.opts.validateSchema){return this.addSchema($,A,!0,w),this}validateSchema($,A){if(typeof $=="boolean")return!0;let w;if(w=$.$schema,w!==void 0&&typeof w!="string")throw new Error("$schema must be a string");if(w=w||this.opts.defaultMeta||this.defaultMeta(),!w)return this.logger.warn("meta-schema not available"),this.errors=null,!0;const i=this.validate(w,$);if(!i&&A){const p="schema is invalid: "+this.errorsText();if(this.opts.validateSchema==="log")this.logger.error(p);else throw new Error(p)}return i}getSchema($){let A;for(;typeof(A=_.call(this,$))=="string";)$=A;if(A===void 0){const{schemaId:w}=this.opts,i=new o.SchemaEnv({schema:{},schemaId:w});if(A=o.resolveSchema.call(this,i,$),!A)return;this.refs[$]=A}return A.validate||this._compileSchemaEnv(A)}removeSchema($){if($ instanceof RegExp)return this._removeAllSchemas(this.schemas,$),this._removeAllSchemas(this.refs,$),this;switch(typeof $){case"undefined":return this._removeAllSchemas(this.schemas),this._removeAllSchemas(this.refs),this._cache.clear(),this;case"string":{const A=_.call(this,$);return typeof A=="object"&&this._cache.delete(A.schema),delete this.schemas[$],delete this.refs[$],this}case"object":{const A=$;this._cache.delete(A);let w=$[this.opts.schemaId];return w&&(w=(0,d.normalizeId)(w),delete this.schemas[w],delete this.refs[w]),this}default:throw new Error("ajv.removeSchema: invalid parameter")}}addVocabulary($){for(const A of $)this.addKeyword(A);return this}addKeyword($,A){let w;if(typeof $=="string")w=$,typeof A=="object"&&(this.logger.warn("these parameters are deprecated, see docs for addKeyword"),A.keyword=w);else if(typeof $=="object"&&A===void 0){if(A=$,w=A.keyword,Array.isArray(w)&&!w.length)throw new Error("addKeywords: keyword must be string or non-empty array")}else throw new Error("invalid addKeywords parameters");if(fe.call(this,w,A),!A)return(0,f.eachItem)(w,p=>Xe.call(this,p)),this;ft.call(this,A);const i={...A,type:(0,l.getJSONTypes)(A.type),schemaType:(0,l.getJSONTypes)(A.schemaType)};return(0,f.eachItem)(w,i.type.length===0?p=>Xe.call(this,p,i):p=>i.type.forEach(k=>Xe.call(this,p,i,k))),this}getKeyword($){const A=this.RULES.all[$];return typeof A=="object"?A.definition:!!A}removeKeyword($){const{RULES:A}=this;delete A.keywords[$],delete A.all[$];for(const w of A.rules){const i=w.rules.findIndex(p=>p.keyword===$);i>=0&&w.rules.splice(i,1)}return this}addFormat($,A){return typeof A=="string"&&(A=new RegExp(A)),this.formats[$]=A,this}errorsText($=this.errors,{separator:A=", ",dataVar:w="data"}={}){return!$||$.length===0?"No errors":$.map(i=>`${w}${i.instancePath} ${i.message}`).reduce((i,p)=>i+A+p)}$dataMetaSchema($,A){const w=this.RULES.all;$=JSON.parse(JSON.stringify($));for(const i of A){const p=i.split("/").slice(1);let k=$;for(const F of p)k=k[F];for(const F in w){const q=w[F];if(typeof q!="object")continue;const{$data:J}=q.definition,Y=k[F];J&&Y&&(k[F]=ht(Y))}}return $}_removeAllSchemas($,A){for(const w in $){const i=$[w];(!A||A.test(w))&&(typeof i=="string"?delete $[w]:i&&!i.meta&&(this._cache.delete(i.schema),delete $[w]))}}_addSchema($,A,w,i=this.opts.validateSchema,p=this.opts.addUsedSchema){let k;const{schemaId:F}=this.opts;if(typeof $=="object")k=$[F];else{if(this.opts.jtd)throw new Error("schema must be object");if(typeof $!="boolean")throw new Error("schema must be object or boolean")}let q=this._cache.get($);if(q!==void 0)return q;w=(0,d.normalizeId)(k||w);const J=d.getSchemaRefs.call(this,$,w);return q=new o.SchemaEnv({schema:$,schemaId:F,meta:A,baseId:w,localRefs:J}),this._cache.set(q.schema,q),p&&!w.startsWith("#")&&(w&&this._checkUnique(w),this.refs[w]=q),i&&this.validateSchema($,!0),q}_checkUnique($){if(this.schemas[$]||this.refs[$])throw new Error(`schema with key or id "${$}" already exists`)}_compileSchemaEnv($){if($.meta?this._compileMetaSchema($):o.compileSchema.call(this,$),!$.validate)throw new Error("ajv implementation error");return $.validate}_compileMetaSchema($){const A=this.opts;this.opts=this._metaOpts;try{o.compileSchema.call(this,$)}finally{this.opts=A}}}t.default=I,I.ValidationError=n.default,I.MissingRefError=s.default;function j(M,$,A,w="error"){for(const i in M){const p=i;p in $&&this.logger[w](`${A}: option ${i}. ${M[p]}`)}}function _(M){return M=(0,d.normalizeId)(M),this.schemas[M]||this.refs[M]}function C(){const M=this.opts.schemas;if(M)if(Array.isArray(M))this.addSchema(M);else for(const $ in M)this.addSchema(M[$],$)}function D(){for(const M in this.opts.formats){const $=this.opts.formats[M];$&&this.addFormat(M,$)}}function z(M){if(Array.isArray(M)){this.addVocabulary(M);return}this.logger.warn("keywords option as map is deprecated, pass array");for(const $ in M){const A=M[$];A.keyword||(A.keyword=$),this.addKeyword(A)}}function B(){const M={...this.opts};for(const $ of b)delete M[$];return M}const oe={log(){},warn(){},error(){}};function X(M){if(M===!1)return oe;if(M===void 0)return console;if(M.log&&M.warn&&M.error)return M;throw new Error("logger must implement log, warn and error methods")}const be=/^[a-z_$][a-z0-9_$:-]*$/i;function fe(M,$){const{RULES:A}=this;if((0,f.eachItem)(M,w=>{if(A.keywords[w])throw new Error(`Keyword ${w} is already defined`);if(!be.test(w))throw new Error(`Keyword ${w} has invalid name`)}),!!$&&$.$data&&!("code"in $||"validate"in $))throw new Error('$data keyword must have "code" or "validate" function')}function Xe(M,$,A){var w;const i=$?.post;if(A&&i)throw new Error('keyword with "post" flag cannot have "type"');const{RULES:p}=this;let k=i?p.post:p.rules.find(({type:q})=>q===A);if(k||(k={type:A,rules:[]},p.rules.push(k)),p.keywords[M]=!0,!$)return;const F={keyword:M,definition:{...$,type:(0,l.getJSONTypes)($.type),schemaType:(0,l.getJSONTypes)($.schemaType)}};$.before?Ze.call(this,k,F,$.before):k.rules.push(F),p.all[M]=F,(w=$.implements)===null||w===void 0||w.forEach(q=>this.addKeyword(q))}function Ze(M,$,A){const w=M.rules.findIndex(i=>i.keyword===A);w>=0?M.rules.splice(w,0,$):(M.rules.push($),this.logger.warn(`rule ${A} is not defined`))}function ft(M){let{metaSchema:$}=M;$!==void 0&&(M.$data&&this.opts.$data&&($=ht($)),M.validateSchema=this.compile($,!0))}const At={$ref:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#"};function ht(M){return{anyOf:[M,At]}}})(ia);var hn={},pn={},mn={};Object.defineProperty(mn,"__esModule",{value:!0});const Xc={keyword:"id",code(){throw new Error('NOT SUPPORTED: keyword "id", use "$id" for schema ID')}};mn.default=Xc;var dt={};Object.defineProperty(dt,"__esModule",{value:!0});dt.callRef=dt.getValidate=void 0;const Zc=nr,Cs=K,_e=G,bt=Le,ks=we,lr=ee,eu={keyword:"$ref",schemaType:"string",code(t){const{gen:e,schema:r,it:n}=t,{baseId:s,schemaEnv:a,validateName:o,opts:u,self:d}=n,{root:l}=a;if((r==="#"||r==="#/")&&s===l.baseId)return y();const f=ks.resolveRef.call(d,l,s,r);if(f===void 0)throw new Zc.default(n.opts.uriResolver,s,r);if(f instanceof ks.SchemaEnv)return S(f);return N(f);function y(){if(a===l)return gr(t,o,a,a.$async);const b=e.scopeValue("root",{ref:l});return gr(t,(0,_e._)`${b}.validate`,l,l.$async)}function S(b){const R=Aa(t,b);gr(t,R,b,b.$async)}function N(b){const R=e.scopeValue("schema",u.code.source===!0?{ref:b,code:(0,_e.stringify)(b)}:{ref:b}),v=e.name("valid"),g=t.subschema({schema:b,dataTypes:[],schemaPath:_e.nil,topSchemaRef:R,errSchemaPath:r},v);t.mergeEvaluated(g),t.ok(v)}}};function Aa(t,e){const{gen:r}=t;return e.validate?r.scopeValue("validate",{ref:e.validate}):(0,_e._)`${r.scopeValue("wrapper",{ref:e})}.validate`}dt.getValidate=Aa;function gr(t,e,r,n){const{gen:s,it:a}=t,{allErrors:o,schemaEnv:u,opts:d}=a,l=d.passContext?bt.default.this:_e.nil;n?f():y();function f(){if(!u.$async)throw new Error("async schema referenced by sync schema");const b=s.let("valid");s.try(()=>{s.code((0,_e._)`await ${(0,Cs.callValidateCode)(t,e,l)}`),N(e),o||s.assign(b,!0)},R=>{s.if((0,_e._)`!(${R} instanceof ${a.ValidationError})`,()=>s.throw(R)),S(R),o||s.assign(b,!1)}),t.ok(b)}function y(){t.result((0,Cs.callValidateCode)(t,e,l),()=>N(e),()=>S(e))}function S(b){const R=(0,_e._)`${b}.errors`;s.assign(bt.default.vErrors,(0,_e._)`${bt.default.vErrors} === null ? ${R} : ${bt.default.vErrors}.concat(${R})`),s.assign(bt.default.errors,(0,_e._)`${bt.default.vErrors}.length`)}function N(b){var R;if(!a.opts.unevaluated)return;const v=(R=r?.validate)===null||R===void 0?void 0:R.evaluated;if(a.props!==!0)if(v&&!v.dynamicProps)v.props!==void 0&&(a.props=lr.mergeEvaluated.props(s,v.props,a.props));else{const g=s.var("props",(0,_e._)`${b}.evaluated.props`);a.props=lr.mergeEvaluated.props(s,g,a.props,_e.Name)}if(a.items!==!0)if(v&&!v.dynamicItems)v.items!==void 0&&(a.items=lr.mergeEvaluated.items(s,v.items,a.items));else{const g=s.var("items",(0,_e._)`${b}.evaluated.items`);a.items=lr.mergeEvaluated.items(s,g,a.items,_e.Name)}}}dt.callRef=gr;dt.default=eu;Object.defineProperty(pn,"__esModule",{value:!0});const tu=mn,ru=dt,nu=["$schema","$id","$defs","$vocabulary",{keyword:"$comment"},"definitions",tu.default,ru.default];pn.default=nu;var yn={},gn={};Object.defineProperty(gn,"__esModule",{value:!0});const Rr=G,xe=Rr.operators,Tr={maximum:{okStr:"<=",ok:xe.LTE,fail:xe.GT},minimum:{okStr:">=",ok:xe.GTE,fail:xe.LT},exclusiveMaximum:{okStr:"<",ok:xe.LT,fail:xe.GTE},exclusiveMinimum:{okStr:">",ok:xe.GT,fail:xe.LTE}},su={message:({keyword:t,schemaCode:e})=>(0,Rr.str)`must be ${Tr[t].okStr} ${e}`,params:({keyword:t,schemaCode:e})=>(0,Rr._)`{comparison: ${Tr[t].okStr}, limit: ${e}}`},au={keyword:Object.keys(Tr),type:"number",schemaType:"number",$data:!0,error:su,code(t){const{keyword:e,data:r,schemaCode:n}=t;t.fail$data((0,Rr._)`${r} ${Tr[e].fail} ${n} || isNaN(${r})`)}};gn.default=au;var $n={};Object.defineProperty($n,"__esModule",{value:!0});const xt=G,ou={message:({schemaCode:t})=>(0,xt.str)`must be multiple of ${t}`,params:({schemaCode:t})=>(0,xt._)`{multipleOf: ${t}}`},iu={keyword:"multipleOf",type:"number",schemaType:"number",$data:!0,error:ou,code(t){const{gen:e,data:r,schemaCode:n,it:s}=t,a=s.opts.multipleOfPrecision,o=e.let("res"),u=a?(0,xt._)`Math.abs(Math.round(${o}) - ${o}) > 1e-${a}`:(0,xt._)`${o} !== parseInt(${o})`;t.fail$data((0,xt._)`(${n} === 0 || (${o} = ${r}/${n}, ${u}))`)}};$n.default=iu;var vn={},_n={};Object.defineProperty(_n,"__esModule",{value:!0});function Da(t){const e=t.length;let r=0,n=0,s;for(;n<e;)r++,s=t.charCodeAt(n++),s>=55296&&s<=56319&&n<e&&(s=t.charCodeAt(n),(s&64512)===56320&&n++);return r}_n.default=Da;Da.code='require("ajv/dist/runtime/ucs2length").default';Object.defineProperty(vn,"__esModule",{value:!0});const it=G,cu=ee,uu=_n,lu={message({keyword:t,schemaCode:e}){const r=t==="maxLength"?"more":"fewer";return(0,it.str)`must NOT have ${r} than ${e} characters`},params:({schemaCode:t})=>(0,it._)`{limit: ${t}}`},du={keyword:["maxLength","minLength"],type:"string",schemaType:"number",$data:!0,error:lu,code(t){const{keyword:e,data:r,schemaCode:n,it:s}=t,a=e==="maxLength"?it.operators.GT:it.operators.LT,o=s.opts.unicode===!1?(0,it._)`${r}.length`:(0,it._)`${(0,cu.useFunc)(t.gen,uu.default)}(${r})`;t.fail$data((0,it._)`${o} ${a} ${n}`)}};vn.default=du;var wn={};Object.defineProperty(wn,"__esModule",{value:!0});const fu=K,Or=G,hu={message:({schemaCode:t})=>(0,Or.str)`must match pattern "${t}"`,params:({schemaCode:t})=>(0,Or._)`{pattern: ${t}}`},pu={keyword:"pattern",type:"string",schemaType:"string",$data:!0,error:hu,code(t){const{data:e,$data:r,schema:n,schemaCode:s,it:a}=t,o=a.opts.unicodeRegExp?"u":"",u=r?(0,Or._)`(new RegExp(${s}, ${o}))`:(0,fu.usePattern)(t,n);t.fail$data((0,Or._)`!${u}.test(${e})`)}};wn.default=pu;var En={};Object.defineProperty(En,"__esModule",{value:!0});const Yt=G,mu={message({keyword:t,schemaCode:e}){const r=t==="maxProperties"?"more":"fewer";return(0,Yt.str)`must NOT have ${r} than ${e} properties`},params:({schemaCode:t})=>(0,Yt._)`{limit: ${t}}`},yu={keyword:["maxProperties","minProperties"],type:"object",schemaType:"number",$data:!0,error:mu,code(t){const{keyword:e,data:r,schemaCode:n}=t,s=e==="maxProperties"?Yt.operators.GT:Yt.operators.LT;t.fail$data((0,Yt._)`Object.keys(${r}).length ${s} ${n}`)}};En.default=yu;var bn={};Object.defineProperty(bn,"__esModule",{value:!0});const Wt=K,Qt=G,gu=ee,$u={message:({params:{missingProperty:t}})=>(0,Qt.str)`must have required property '${t}'`,params:({params:{missingProperty:t}})=>(0,Qt._)`{missingProperty: ${t}}`},vu={keyword:"required",type:"object",schemaType:"array",$data:!0,error:$u,code(t){const{gen:e,schema:r,schemaCode:n,data:s,$data:a,it:o}=t,{opts:u}=o;if(!a&&r.length===0)return;const d=r.length>=u.loopRequired;if(o.allErrors?l():f(),u.strictRequired){const N=t.parentSchema.properties,{definedProperties:b}=t.it;for(const R of r)if(N?.[R]===void 0&&!b.has(R)){const v=o.schemaEnv.baseId+o.errSchemaPath,g=`required property "${R}" is not defined at "${v}" (strictRequired)`;(0,gu.checkStrictMode)(o,g,o.opts.strictRequired)}}function l(){if(d||a)t.block$data(Qt.nil,y);else for(const N of r)(0,Wt.checkReportMissingProp)(t,N)}function f(){const N=e.let("missing");if(d||a){const b=e.let("valid",!0);t.block$data(b,()=>S(N,b)),t.ok(b)}else e.if((0,Wt.checkMissingProp)(t,r,N)),(0,Wt.reportMissingProp)(t,N),e.else()}function y(){e.forOf("prop",n,N=>{t.setParams({missingProperty:N}),e.if((0,Wt.noPropertyInData)(e,s,N,u.ownProperties),()=>t.error())})}function S(N,b){t.setParams({missingProperty:N}),e.forOf(N,n,()=>{e.assign(b,(0,Wt.propertyInData)(e,s,N,u.ownProperties)),e.if((0,Qt.not)(b),()=>{t.error(),e.break()})},Qt.nil)}}};bn.default=vu;var Pn={};Object.defineProperty(Pn,"__esModule",{value:!0});const Xt=G,_u={message({keyword:t,schemaCode:e}){const r=t==="maxItems"?"more":"fewer";return(0,Xt.str)`must NOT have ${r} than ${e} items`},params:({schemaCode:t})=>(0,Xt._)`{limit: ${t}}`},wu={keyword:["maxItems","minItems"],type:"array",schemaType:"number",$data:!0,error:_u,code(t){const{keyword:e,data:r,schemaCode:n}=t,s=e==="maxItems"?Xt.operators.GT:Xt.operators.LT;t.fail$data((0,Xt._)`${r}.length ${s} ${n}`)}};Pn.default=wu;var Sn={},sr={};Object.defineProperty(sr,"__esModule",{value:!0});const ja=ma;ja.code='require("ajv/dist/runtime/equal").default';sr.default=ja;Object.defineProperty(Sn,"__esModule",{value:!0});const zr=tr,pe=G,Eu=ee,bu=sr,Pu={message:({params:{i:t,j:e}})=>(0,pe.str)`must NOT have duplicate items (items ## ${e} and ${t} are identical)`,params:({params:{i:t,j:e}})=>(0,pe._)`{i: ${t}, j: ${e}}`},Su={keyword:"uniqueItems",type:"array",schemaType:"boolean",$data:!0,error:Pu,code(t){const{gen:e,data:r,$data:n,schema:s,parentSchema:a,schemaCode:o,it:u}=t;if(!n&&!s)return;const d=e.let("valid"),l=a.items?(0,zr.getSchemaTypes)(a.items):[];t.block$data(d,f,(0,pe._)`${o} === false`),t.ok(d);function f(){const b=e.let("i",(0,pe._)`${r}.length`),R=e.let("j");t.setParams({i:b,j:R}),e.assign(d,!0),e.if((0,pe._)`${b} > 1`,()=>(y()?S:N)(b,R))}function y(){return l.length>0&&!l.some(b=>b==="object"||b==="array")}function S(b,R){const v=e.name("item"),g=(0,zr.checkDataTypes)(l,v,u.opts.strictNumbers,zr.DataType.Wrong),T=e.const("indices",(0,pe._)`{}`);e.for((0,pe._)`;${b}--;`,()=>{e.let(v,(0,pe._)`${r}[${b}]`),e.if(g,(0,pe._)`continue`),l.length>1&&e.if((0,pe._)`typeof ${v} == "string"`,(0,pe._)`${v} += "_"`),e.if((0,pe._)`typeof ${T}[${v}] == "number"`,()=>{e.assign(R,(0,pe._)`${T}[${v}]`),t.error(),e.assign(d,!1).break()}).code((0,pe._)`${T}[${v}] = ${b}`)})}function N(b,R){const v=(0,Eu.useFunc)(e,bu.default),g=e.name("outer");e.label(g).for((0,pe._)`;${b}--;`,()=>e.for((0,pe._)`${R} = ${b}; ${R}--;`,()=>e.if((0,pe._)`${v}(${r}[${b}], ${r}[${R}])`,()=>{t.error(),e.assign(d,!1).break(g)})))}}};Sn.default=Su;var Rn={};Object.defineProperty(Rn,"__esModule",{value:!0});const Xr=G,Ru=ee,Tu=sr,Ou={message:"must be equal to constant",params:({schemaCode:t})=>(0,Xr._)`{allowedValue: ${t}}`},Nu={keyword:"const",$data:!0,error:Ou,code(t){const{gen:e,data:r,$data:n,schemaCode:s,schema:a}=t;n||a&&typeof a=="object"?t.fail$data((0,Xr._)`!${(0,Ru.useFunc)(e,Tu.default)}(${r}, ${s})`):t.fail((0,Xr._)`${a} !== ${r}`)}};Rn.default=Nu;var Tn={};Object.defineProperty(Tn,"__esModule",{value:!0});const Kt=G,Cu=ee,ku=sr,Iu={message:"must be equal to one of the allowed values",params:({schemaCode:t})=>(0,Kt._)`{allowedValues: ${t}}`},Au={keyword:"enum",schemaType:"array",$data:!0,error:Iu,code(t){const{gen:e,data:r,$data:n,schema:s,schemaCode:a,it:o}=t;if(!n&&s.length===0)throw new Error("enum must have non-empty array");const u=s.length>=o.opts.loopEnum;let d;const l=()=>d??(d=(0,Cu.useFunc)(e,ku.default));let f;if(u||n)f=e.let("valid"),t.block$data(f,y);else{if(!Array.isArray(s))throw new Error("ajv implementation error");const N=e.const("vSchema",a);f=(0,Kt.or)(...s.map((b,R)=>S(N,R)))}t.pass(f);function y(){e.assign(f,!1),e.forOf("v",a,N=>e.if((0,Kt._)`${l()}(${r}, ${N})`,()=>e.assign(f,!0).break()))}function S(N,b){const R=s[b];return typeof R=="object"&&R!==null?(0,Kt._)`${l()}(${r}, ${N}[${b}])`:(0,Kt._)`${r} === ${R}`}}};Tn.default=Au;Object.defineProperty(yn,"__esModule",{value:!0});const Du=gn,ju=$n,Mu=vn,Fu=wn,qu=En,Uu=bn,Vu=Pn,Hu=Sn,Lu=Rn,zu=Tn,Wu=[Du.default,ju.default,Mu.default,Fu.default,qu.default,Uu.default,Vu.default,Hu.default,{keyword:"type",schemaType:["string","array"]},{keyword:"nullable",schemaType:"boolean"},Lu.default,zu.default];yn.default=Wu;var On={},kt={};Object.defineProperty(kt,"__esModule",{value:!0});kt.validateAdditionalItems=void 0;const ct=G,Zr=ee,Ku={message:({params:{len:t}})=>(0,ct.str)`must NOT have more than ${t} items`,params:({params:{len:t}})=>(0,ct._)`{limit: ${t}}`},Gu={keyword:"additionalItems",type:"array",schemaType:["boolean","object"],before:"uniqueItems",error:Ku,code(t){const{parentSchema:e,it:r}=t,{items:n}=e;if(!Array.isArray(n)){(0,Zr.checkStrictMode)(r,'"additionalItems" is ignored when "items" is not an array of schemas');return}Ma(t,n)}};function Ma(t,e){const{gen:r,schema:n,data:s,keyword:a,it:o}=t;o.items=!0;const u=r.const("len",(0,ct._)`${s}.length`);if(n===!1)t.setParams({len:e.length}),t.pass((0,ct._)`${u} <= ${e.length}`);else if(typeof n=="object"&&!(0,Zr.alwaysValidSchema)(o,n)){const l=r.var("valid",(0,ct._)`${u} <= ${e.length}`);r.if((0,ct.not)(l),()=>d(l)),t.ok(l)}function d(l){r.forRange("i",e.length,u,f=>{t.subschema({keyword:a,dataProp:f,dataPropType:Zr.Type.Num},l),o.allErrors||r.if((0,ct.not)(l),()=>r.break())})}}kt.validateAdditionalItems=Ma;kt.default=Gu;var Nn={},It={};Object.defineProperty(It,"__esModule",{value:!0});It.validateTuple=void 0;const Is=G,$r=ee,Bu=K,Ju={keyword:"items",type:"array",schemaType:["object","array","boolean"],before:"uniqueItems",code(t){const{schema:e,it:r}=t;if(Array.isArray(e))return Fa(t,"additionalItems",e);r.items=!0,!(0,$r.alwaysValidSchema)(r,e)&&t.ok((0,Bu.validateArray)(t))}};function Fa(t,e,r=t.schema){const{gen:n,parentSchema:s,data:a,keyword:o,it:u}=t;f(s),u.opts.unevaluated&&r.length&&u.items!==!0&&(u.items=$r.mergeEvaluated.items(n,r.length,u.items));const d=n.name("valid"),l=n.const("len",(0,Is._)`${a}.length`);r.forEach((y,S)=>{(0,$r.alwaysValidSchema)(u,y)||(n.if((0,Is._)`${l} > ${S}`,()=>t.subschema({keyword:o,schemaProp:S,dataProp:S},d)),t.ok(d))});function f(y){const{opts:S,errSchemaPath:N}=u,b=r.length,R=b===y.minItems&&(b===y.maxItems||y[e]===!1);if(S.strictTuples&&!R){const v=`"${o}" is ${b}-tuple, but minItems or maxItems/${e} are not specified or different at path "${N}"`;(0,$r.checkStrictMode)(u,v,S.strictTuples)}}}It.validateTuple=Fa;It.default=Ju;Object.defineProperty(Nn,"__esModule",{value:!0});const xu=It,Yu={keyword:"prefixItems",type:"array",schemaType:["array"],before:"uniqueItems",code:t=>(0,xu.validateTuple)(t,"items")};Nn.default=Yu;var Cn={};Object.defineProperty(Cn,"__esModule",{value:!0});const As=G,Qu=ee,Xu=K,Zu=kt,el={message:({params:{len:t}})=>(0,As.str)`must NOT have more than ${t} items`,params:({params:{len:t}})=>(0,As._)`{limit: ${t}}`},tl={keyword:"items",type:"array",schemaType:["object","boolean"],before:"uniqueItems",error:el,code(t){const{schema:e,parentSchema:r,it:n}=t,{prefixItems:s}=r;n.items=!0,!(0,Qu.alwaysValidSchema)(n,e)&&(s?(0,Zu.validateAdditionalItems)(t,s):t.ok((0,Xu.validateArray)(t)))}};Cn.default=tl;var kn={};Object.defineProperty(kn,"__esModule",{value:!0});const Re=G,dr=ee,rl={message:({params:{min:t,max:e}})=>e===void 0?(0,Re.str)`must contain at least ${t} valid item(s)`:(0,Re.str)`must contain at least ${t} and no more than ${e} valid item(s)`,params:({params:{min:t,max:e}})=>e===void 0?(0,Re._)`{minContains: ${t}}`:(0,Re._)`{minContains: ${t}, maxContains: ${e}}`},nl={keyword:"contains",type:"array",schemaType:["object","boolean"],before:"uniqueItems",trackErrors:!0,error:rl,code(t){const{gen:e,schema:r,parentSchema:n,data:s,it:a}=t;let o,u;const{minContains:d,maxContains:l}=n;a.opts.next?(o=d===void 0?1:d,u=l):o=1;const f=e.const("len",(0,Re._)`${s}.length`);if(t.setParams({min:o,max:u}),u===void 0&&o===0){(0,dr.checkStrictMode)(a,'"minContains" == 0 without "maxContains": "contains" keyword ignored');return}if(u!==void 0&&o>u){(0,dr.checkStrictMode)(a,'"minContains" > "maxContains" is always invalid'),t.fail();return}if((0,dr.alwaysValidSchema)(a,r)){let R=(0,Re._)`${f} >= ${o}`;u!==void 0&&(R=(0,Re._)`${R} && ${f} <= ${u}`),t.pass(R);return}a.items=!0;const y=e.name("valid");u===void 0&&o===1?N(y,()=>e.if(y,()=>e.break())):o===0?(e.let(y,!0),u!==void 0&&e.if((0,Re._)`${s}.length > 0`,S)):(e.let(y,!1),S()),t.result(y,()=>t.reset());function S(){const R=e.name("_valid"),v=e.let("count",0);N(R,()=>e.if(R,()=>b(v)))}function N(R,v){e.forRange("i",0,f,g=>{t.subschema({keyword:"contains",dataProp:g,dataPropType:dr.Type.Num,compositeRule:!0},R),v()})}function b(R){e.code((0,Re._)`${R}++`),u===void 0?e.if((0,Re._)`${R} >= ${o}`,()=>e.assign(y,!0).break()):(e.if((0,Re._)`${R} > ${u}`,()=>e.assign(y,!1).break()),o===1?e.assign(y,!0):e.if((0,Re._)`${R} >= ${o}`,()=>e.assign(y,!0)))}}};kn.default=nl;var qa={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.validateSchemaDeps=t.validatePropertyDeps=t.error=void 0;const e=G,r=ee,n=K;t.error={message:({params:{property:d,depsCount:l,deps:f}})=>{const y=l===1?"property":"properties";return(0,e.str)`must have ${y} ${f} when property ${d} is present`},params:({params:{property:d,depsCount:l,deps:f,missingProperty:y}})=>(0,e._)`{property: ${d},
    missingProperty: ${y},
    depsCount: ${l},
    deps: ${f}}`};const s={keyword:"dependencies",type:"object",schemaType:"object",error:t.error,code(d){const[l,f]=a(d);o(d,l),u(d,f)}};function a({schema:d}){const l={},f={};for(const y in d){if(y==="__proto__")continue;const S=Array.isArray(d[y])?l:f;S[y]=d[y]}return[l,f]}function o(d,l=d.schema){const{gen:f,data:y,it:S}=d;if(Object.keys(l).length===0)return;const N=f.let("missing");for(const b in l){const R=l[b];if(R.length===0)continue;const v=(0,n.propertyInData)(f,y,b,S.opts.ownProperties);d.setParams({property:b,depsCount:R.length,deps:R.join(", ")}),S.allErrors?f.if(v,()=>{for(const g of R)(0,n.checkReportMissingProp)(d,g)}):(f.if((0,e._)`${v} && (${(0,n.checkMissingProp)(d,R,N)})`),(0,n.reportMissingProp)(d,N),f.else())}}t.validatePropertyDeps=o;function u(d,l=d.schema){const{gen:f,data:y,keyword:S,it:N}=d,b=f.name("valid");for(const R in l)(0,r.alwaysValidSchema)(N,l[R])||(f.if((0,n.propertyInData)(f,y,R,N.opts.ownProperties),()=>{const v=d.subschema({keyword:S,schemaProp:R},b);d.mergeValidEvaluated(v,b)},()=>f.var(b,!0)),d.ok(b))}t.validateSchemaDeps=u,t.default=s})(qa);var In={};Object.defineProperty(In,"__esModule",{value:!0});const Ua=G,sl=ee,al={message:"property name must be valid",params:({params:t})=>(0,Ua._)`{propertyName: ${t.propertyName}}`},ol={keyword:"propertyNames",type:"object",schemaType:["object","boolean"],error:al,code(t){const{gen:e,schema:r,data:n,it:s}=t;if((0,sl.alwaysValidSchema)(s,r))return;const a=e.name("valid");e.forIn("key",n,o=>{t.setParams({propertyName:o}),t.subschema({keyword:"propertyNames",data:o,dataTypes:["string"],propertyName:o,compositeRule:!0},a),e.if((0,Ua.not)(a),()=>{t.error(!0),s.allErrors||e.break()})}),t.ok(a)}};In.default=ol;var Mr={};Object.defineProperty(Mr,"__esModule",{value:!0});const fr=K,Ne=G,il=Le,hr=ee,cl={message:"must NOT have additional properties",params:({params:t})=>(0,Ne._)`{additionalProperty: ${t.additionalProperty}}`},ul={keyword:"additionalProperties",type:["object"],schemaType:["boolean","object"],allowUndefined:!0,trackErrors:!0,error:cl,code(t){const{gen:e,schema:r,parentSchema:n,data:s,errsCount:a,it:o}=t;if(!a)throw new Error("ajv implementation error");const{allErrors:u,opts:d}=o;if(o.props=!0,d.removeAdditional!=="all"&&(0,hr.alwaysValidSchema)(o,r))return;const l=(0,fr.allSchemaProperties)(n.properties),f=(0,fr.allSchemaProperties)(n.patternProperties);y(),t.ok((0,Ne._)`${a} === ${il.default.errors}`);function y(){e.forIn("key",s,v=>{!l.length&&!f.length?b(v):e.if(S(v),()=>b(v))})}function S(v){let g;if(l.length>8){const T=(0,hr.schemaRefOrVal)(o,n.properties,"properties");g=(0,fr.isOwnProperty)(e,T,v)}else l.length?g=(0,Ne.or)(...l.map(T=>(0,Ne._)`${v} === ${T}`)):g=Ne.nil;return f.length&&(g=(0,Ne.or)(g,...f.map(T=>(0,Ne._)`${(0,fr.usePattern)(t,T)}.test(${v})`))),(0,Ne.not)(g)}function N(v){e.code((0,Ne._)`delete ${s}[${v}]`)}function b(v){if(d.removeAdditional==="all"||d.removeAdditional&&r===!1){N(v);return}if(r===!1){t.setParams({additionalProperty:v}),t.error(),u||e.break();return}if(typeof r=="object"&&!(0,hr.alwaysValidSchema)(o,r)){const g=e.name("valid");d.removeAdditional==="failing"?(R(v,g,!1),e.if((0,Ne.not)(g),()=>{t.reset(),N(v)})):(R(v,g),u||e.if((0,Ne.not)(g),()=>e.break()))}}function R(v,g,T){const O={keyword:"additionalProperties",dataProp:v,dataPropType:hr.Type.Str};T===!1&&Object.assign(O,{compositeRule:!0,createErrors:!1,allErrors:!1}),t.subschema(O,g)}}};Mr.default=ul;var An={};Object.defineProperty(An,"__esModule",{value:!0});const ll=ke,Ds=K,Wr=ee,js=Mr,dl={keyword:"properties",type:"object",schemaType:"object",code(t){const{gen:e,schema:r,parentSchema:n,data:s,it:a}=t;a.opts.removeAdditional==="all"&&n.additionalProperties===void 0&&js.default.code(new ll.KeywordCxt(a,js.default,"additionalProperties"));const o=(0,Ds.allSchemaProperties)(r);for(const y of o)a.definedProperties.add(y);a.opts.unevaluated&&o.length&&a.props!==!0&&(a.props=Wr.mergeEvaluated.props(e,(0,Wr.toHash)(o),a.props));const u=o.filter(y=>!(0,Wr.alwaysValidSchema)(a,r[y]));if(u.length===0)return;const d=e.name("valid");for(const y of u)l(y)?f(y):(e.if((0,Ds.propertyInData)(e,s,y,a.opts.ownProperties)),f(y),a.allErrors||e.else().var(d,!0),e.endIf()),t.it.definedProperties.add(y),t.ok(d);function l(y){return a.opts.useDefaults&&!a.compositeRule&&r[y].default!==void 0}function f(y){t.subschema({keyword:"properties",schemaProp:y,dataProp:y},d)}}};An.default=dl;var Dn={};Object.defineProperty(Dn,"__esModule",{value:!0});const Ms=K,pr=G,Fs=ee,qs=ee,fl={keyword:"patternProperties",type:"object",schemaType:"object",code(t){const{gen:e,schema:r,data:n,parentSchema:s,it:a}=t,{opts:o}=a,u=(0,Ms.allSchemaProperties)(r),d=u.filter(R=>(0,Fs.alwaysValidSchema)(a,r[R]));if(u.length===0||d.length===u.length&&(!a.opts.unevaluated||a.props===!0))return;const l=o.strictSchema&&!o.allowMatchingProperties&&s.properties,f=e.name("valid");a.props!==!0&&!(a.props instanceof pr.Name)&&(a.props=(0,qs.evaluatedPropsToName)(e,a.props));const{props:y}=a;S();function S(){for(const R of u)l&&N(R),a.allErrors?b(R):(e.var(f,!0),b(R),e.if(f))}function N(R){for(const v in l)new RegExp(R).test(v)&&(0,Fs.checkStrictMode)(a,`property ${v} matches pattern ${R} (use allowMatchingProperties)`)}function b(R){e.forIn("key",n,v=>{e.if((0,pr._)`${(0,Ms.usePattern)(t,R)}.test(${v})`,()=>{const g=d.includes(R);g||t.subschema({keyword:"patternProperties",schemaProp:R,dataProp:v,dataPropType:qs.Type.Str},f),a.opts.unevaluated&&y!==!0?e.assign((0,pr._)`${y}[${v}]`,!0):!g&&!a.allErrors&&e.if((0,pr.not)(f),()=>e.break())})})}}};Dn.default=fl;var jn={};Object.defineProperty(jn,"__esModule",{value:!0});const hl=ee,pl={keyword:"not",schemaType:["object","boolean"],trackErrors:!0,code(t){const{gen:e,schema:r,it:n}=t;if((0,hl.alwaysValidSchema)(n,r)){t.fail();return}const s=e.name("valid");t.subschema({keyword:"not",compositeRule:!0,createErrors:!1,allErrors:!1},s),t.failResult(s,()=>t.reset(),()=>t.error())},error:{message:"must NOT be valid"}};jn.default=pl;var Mn={};Object.defineProperty(Mn,"__esModule",{value:!0});const ml=K,yl={keyword:"anyOf",schemaType:"array",trackErrors:!0,code:ml.validateUnion,error:{message:"must match a schema in anyOf"}};Mn.default=yl;var Fn={};Object.defineProperty(Fn,"__esModule",{value:!0});const vr=G,gl=ee,$l={message:"must match exactly one schema in oneOf",params:({params:t})=>(0,vr._)`{passingSchemas: ${t.passing}}`},vl={keyword:"oneOf",schemaType:"array",trackErrors:!0,error:$l,code(t){const{gen:e,schema:r,parentSchema:n,it:s}=t;if(!Array.isArray(r))throw new Error("ajv implementation error");if(s.opts.discriminator&&n.discriminator)return;const a=r,o=e.let("valid",!1),u=e.let("passing",null),d=e.name("_valid");t.setParams({passing:u}),e.block(l),t.result(o,()=>t.reset(),()=>t.error(!0));function l(){a.forEach((f,y)=>{let S;(0,gl.alwaysValidSchema)(s,f)?e.var(d,!0):S=t.subschema({keyword:"oneOf",schemaProp:y,compositeRule:!0},d),y>0&&e.if((0,vr._)`${d} && ${o}`).assign(o,!1).assign(u,(0,vr._)`[${u}, ${y}]`).else(),e.if(d,()=>{e.assign(o,!0),e.assign(u,y),S&&t.mergeEvaluated(S,vr.Name)})})}}};Fn.default=vl;var qn={};Object.defineProperty(qn,"__esModule",{value:!0});const _l=ee,wl={keyword:"allOf",schemaType:"array",code(t){const{gen:e,schema:r,it:n}=t;if(!Array.isArray(r))throw new Error("ajv implementation error");const s=e.name("valid");r.forEach((a,o)=>{if((0,_l.alwaysValidSchema)(n,a))return;const u=t.subschema({keyword:"allOf",schemaProp:o},s);t.ok(s),t.mergeEvaluated(u)})}};qn.default=wl;var Un={};Object.defineProperty(Un,"__esModule",{value:!0});const Nr=G,Va=ee,El={message:({params:t})=>(0,Nr.str)`must match "${t.ifClause}" schema`,params:({params:t})=>(0,Nr._)`{failingKeyword: ${t.ifClause}}`},bl={keyword:"if",schemaType:["object","boolean"],trackErrors:!0,error:El,code(t){const{gen:e,parentSchema:r,it:n}=t;r.then===void 0&&r.else===void 0&&(0,Va.checkStrictMode)(n,'"if" without "then" and "else" is ignored');const s=Us(n,"then"),a=Us(n,"else");if(!s&&!a)return;const o=e.let("valid",!0),u=e.name("_valid");if(d(),t.reset(),s&&a){const f=e.let("ifClause");t.setParams({ifClause:f}),e.if(u,l("then",f),l("else",f))}else s?e.if(u,l("then")):e.if((0,Nr.not)(u),l("else"));t.pass(o,()=>t.error(!0));function d(){const f=t.subschema({keyword:"if",compositeRule:!0,createErrors:!1,allErrors:!1},u);t.mergeEvaluated(f)}function l(f,y){return()=>{const S=t.subschema({keyword:f},u);e.assign(o,u),t.mergeValidEvaluated(S,o),y?e.assign(y,(0,Nr._)`${f}`):t.setParams({ifClause:f})}}}};function Us(t,e){const r=t.schema[e];return r!==void 0&&!(0,Va.alwaysValidSchema)(t,r)}Un.default=bl;var Vn={};Object.defineProperty(Vn,"__esModule",{value:!0});const Pl=ee,Sl={keyword:["then","else"],schemaType:["object","boolean"],code({keyword:t,parentSchema:e,it:r}){e.if===void 0&&(0,Pl.checkStrictMode)(r,`"${t}" without "if" is ignored`)}};Vn.default=Sl;Object.defineProperty(On,"__esModule",{value:!0});const Rl=kt,Tl=Nn,Ol=It,Nl=Cn,Cl=kn,kl=qa,Il=In,Al=Mr,Dl=An,jl=Dn,Ml=jn,Fl=Mn,ql=Fn,Ul=qn,Vl=Un,Hl=Vn;function Ll(t=!1){const e=[Ml.default,Fl.default,ql.default,Ul.default,Vl.default,Hl.default,Il.default,Al.default,kl.default,Dl.default,jl.default];return t?e.push(Tl.default,Nl.default):e.push(Rl.default,Ol.default),e.push(Cl.default),e}On.default=Ll;var Hn={},Ln={};Object.defineProperty(Ln,"__esModule",{value:!0});const de=G,zl={message:({schemaCode:t})=>(0,de.str)`must match format "${t}"`,params:({schemaCode:t})=>(0,de._)`{format: ${t}}`},Wl={keyword:"format",type:["number","string"],schemaType:"string",$data:!0,error:zl,code(t,e){const{gen:r,data:n,$data:s,schema:a,schemaCode:o,it:u}=t,{opts:d,errSchemaPath:l,schemaEnv:f,self:y}=u;if(!d.validateFormats)return;s?S():N();function S(){const b=r.scopeValue("formats",{ref:y.formats,code:d.code.formats}),R=r.const("fDef",(0,de._)`${b}[${o}]`),v=r.let("fType"),g=r.let("format");r.if((0,de._)`typeof ${R} == "object" && !(${R} instanceof RegExp)`,()=>r.assign(v,(0,de._)`${R}.type || "string"`).assign(g,(0,de._)`${R}.validate`),()=>r.assign(v,(0,de._)`"string"`).assign(g,R)),t.fail$data((0,de.or)(T(),O()));function T(){return d.strictSchema===!1?de.nil:(0,de._)`${o} && !${g}`}function O(){const I=f.$async?(0,de._)`(${R}.async ? await ${g}(${n}) : ${g}(${n}))`:(0,de._)`${g}(${n})`,j=(0,de._)`(typeof ${g} == "function" ? ${I} : ${g}.test(${n}))`;return(0,de._)`${g} && ${g} !== true && ${v} === ${e} && !${j}`}}function N(){const b=y.formats[a];if(!b){T();return}if(b===!0)return;const[R,v,g]=O(b);R===e&&t.pass(I());function T(){if(d.strictSchema===!1){y.logger.warn(j());return}throw new Error(j());function j(){return`unknown format "${a}" ignored in schema at path "${l}"`}}function O(j){const _=j instanceof RegExp?(0,de.regexpCode)(j):d.code.formats?(0,de._)`${d.code.formats}${(0,de.getProperty)(a)}`:void 0,C=r.scopeValue("formats",{key:a,ref:j,code:_});return typeof j=="object"&&!(j instanceof RegExp)?[j.type||"string",j.validate,(0,de._)`${C}.validate`]:["string",j,C]}function I(){if(typeof b=="object"&&!(b instanceof RegExp)&&b.async){if(!f.$async)throw new Error("async format in sync schema");return(0,de._)`await ${g}(${n})`}return typeof v=="function"?(0,de._)`${g}(${n})`:(0,de._)`${g}.test(${n})`}}}};Ln.default=Wl;Object.defineProperty(Hn,"__esModule",{value:!0});const Kl=Ln,Gl=[Kl.default];Hn.default=Gl;var Ct={};Object.defineProperty(Ct,"__esModule",{value:!0});Ct.contentVocabulary=Ct.metadataVocabulary=void 0;Ct.metadataVocabulary=["title","description","default","deprecated","readOnly","writeOnly","examples"];Ct.contentVocabulary=["contentMediaType","contentEncoding","contentSchema"];Object.defineProperty(hn,"__esModule",{value:!0});const Bl=pn,Jl=yn,xl=On,Yl=Hn,Vs=Ct,Ql=[Bl.default,Jl.default,(0,xl.default)(),Yl.default,Vs.metadataVocabulary,Vs.contentVocabulary];hn.default=Ql;var zn={},Ha={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.DiscrError=void 0,function(e){e.Tag="tag",e.Mapping="mapping"}(t.DiscrError||(t.DiscrError={}))})(Ha);Object.defineProperty(zn,"__esModule",{value:!0});const St=G,en=Ha,Hs=we,Xl=ee,Zl={message:({params:{discrError:t,tagName:e}})=>t===en.DiscrError.Tag?`tag "${e}" must be string`:`value of tag "${e}" must be in oneOf`,params:({params:{discrError:t,tag:e,tagName:r}})=>(0,St._)`{error: ${t}, tag: ${r}, tagValue: ${e}}`},ed={keyword:"discriminator",type:"object",schemaType:"object",error:Zl,code(t){const{gen:e,data:r,schema:n,parentSchema:s,it:a}=t,{oneOf:o}=s;if(!a.opts.discriminator)throw new Error("discriminator: requires discriminator option");const u=n.propertyName;if(typeof u!="string")throw new Error("discriminator: requires propertyName");if(n.mapping)throw new Error("discriminator: mapping is not supported");if(!o)throw new Error("discriminator: requires oneOf keyword");const d=e.let("valid",!1),l=e.const("tag",(0,St._)`${r}${(0,St.getProperty)(u)}`);e.if((0,St._)`typeof ${l} == "string"`,()=>f(),()=>t.error(!1,{discrError:en.DiscrError.Tag,tag:l,tagName:u})),t.ok(d);function f(){const N=S();e.if(!1);for(const b in N)e.elseIf((0,St._)`${l} === ${b}`),e.assign(d,y(N[b]));e.else(),t.error(!1,{discrError:en.DiscrError.Mapping,tag:l,tagName:u}),e.endIf()}function y(N){const b=e.name("valid"),R=t.subschema({keyword:"oneOf",schemaProp:N},b);return t.mergeEvaluated(R,St.Name),b}function S(){var N;const b={},R=g(s);let v=!0;for(let I=0;I<o.length;I++){let j=o[I];j?.$ref&&!(0,Xl.schemaHasRulesButRef)(j,a.self.RULES)&&(j=Hs.resolveRef.call(a.self,a.schemaEnv.root,a.baseId,j?.$ref),j instanceof Hs.SchemaEnv&&(j=j.schema));const _=(N=j?.properties)===null||N===void 0?void 0:N[u];if(typeof _!="object")throw new Error(`discriminator: oneOf subschemas (or referenced schemas) must have "properties/${u}"`);v=v&&(R||g(j)),T(_,I)}if(!v)throw new Error(`discriminator: "${u}" must be required`);return b;function g({required:I}){return Array.isArray(I)&&I.includes(u)}function T(I,j){if(I.const)O(I.const,j);else if(I.enum)for(const _ of I.enum)O(_,j);else throw new Error(`discriminator: "properties/${u}" must have "const" or "enum"`)}function O(I,j){if(typeof I!="string"||I in b)throw new Error(`discriminator: "${u}" values must be unique strings`);b[I]=j}}}};zn.default=ed;const td="http://json-schema.org/draft-07/schema#",rd="http://json-schema.org/draft-07/schema#",nd="Core schema meta-schema",sd={schemaArray:{type:"array",minItems:1,items:{$ref:"#"}},nonNegativeInteger:{type:"integer",minimum:0},nonNegativeIntegerDefault0:{allOf:[{$ref:"#/definitions/nonNegativeInteger"},{default:0}]},simpleTypes:{enum:["array","boolean","integer","null","number","object","string"]},stringArray:{type:"array",items:{type:"string"},uniqueItems:!0,default:[]}},ad=["object","boolean"],od={$id:{type:"string",format:"uri-reference"},$schema:{type:"string",format:"uri"},$ref:{type:"string",format:"uri-reference"},$comment:{type:"string"},title:{type:"string"},description:{type:"string"},default:!0,readOnly:{type:"boolean",default:!1},examples:{type:"array",items:!0},multipleOf:{type:"number",exclusiveMinimum:0},maximum:{type:"number"},exclusiveMaximum:{type:"number"},minimum:{type:"number"},exclusiveMinimum:{type:"number"},maxLength:{$ref:"#/definitions/nonNegativeInteger"},minLength:{$ref:"#/definitions/nonNegativeIntegerDefault0"},pattern:{type:"string",format:"regex"},additionalItems:{$ref:"#"},items:{anyOf:[{$ref:"#"},{$ref:"#/definitions/schemaArray"}],default:!0},maxItems:{$ref:"#/definitions/nonNegativeInteger"},minItems:{$ref:"#/definitions/nonNegativeIntegerDefault0"},uniqueItems:{type:"boolean",default:!1},contains:{$ref:"#"},maxProperties:{$ref:"#/definitions/nonNegativeInteger"},minProperties:{$ref:"#/definitions/nonNegativeIntegerDefault0"},required:{$ref:"#/definitions/stringArray"},additionalProperties:{$ref:"#"},definitions:{type:"object",additionalProperties:{$ref:"#"},default:{}},properties:{type:"object",additionalProperties:{$ref:"#"},default:{}},patternProperties:{type:"object",additionalProperties:{$ref:"#"},propertyNames:{format:"regex"},default:{}},dependencies:{type:"object",additionalProperties:{anyOf:[{$ref:"#"},{$ref:"#/definitions/stringArray"}]}},propertyNames:{$ref:"#"},const:!0,enum:{type:"array",items:!0,minItems:1,uniqueItems:!0},type:{anyOf:[{$ref:"#/definitions/simpleTypes"},{type:"array",items:{$ref:"#/definitions/simpleTypes"},minItems:1,uniqueItems:!0}]},format:{type:"string"},contentMediaType:{type:"string"},contentEncoding:{type:"string"},if:{$ref:"#"},then:{$ref:"#"},else:{$ref:"#"},allOf:{$ref:"#/definitions/schemaArray"},anyOf:{$ref:"#/definitions/schemaArray"},oneOf:{$ref:"#/definitions/schemaArray"},not:{$ref:"#"}};var id={$schema:td,$id:rd,title:nd,definitions:sd,type:ad,properties:od,default:!0};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.MissingRefError=e.ValidationError=e.CodeGen=e.Name=e.nil=e.stringify=e.str=e._=e.KeywordCxt=void 0;const r=ia,n=hn,s=zn,a=id,o=["/properties"],u="http://json-schema.org/draft-07/schema";class d extends r.default{_addVocabularies(){super._addVocabularies(),n.default.forEach(b=>this.addVocabulary(b)),this.opts.discriminator&&this.addKeyword(s.default)}_addDefaultMetaSchema(){if(super._addDefaultMetaSchema(),!this.opts.meta)return;const b=this.opts.$data?this.$dataMetaSchema(a,o):a;this.addMetaSchema(b,u,!1),this.refs["http://json-schema.org/schema"]=u}defaultMeta(){return this.opts.defaultMeta=super.defaultMeta()||(this.getSchema(u)?u:void 0)}}t.exports=e=d,Object.defineProperty(e,"__esModule",{value:!0}),e.default=d;var l=ke;Object.defineProperty(e,"KeywordCxt",{enumerable:!0,get:function(){return l.KeywordCxt}});var f=G;Object.defineProperty(e,"_",{enumerable:!0,get:function(){return f._}}),Object.defineProperty(e,"str",{enumerable:!0,get:function(){return f.str}}),Object.defineProperty(e,"stringify",{enumerable:!0,get:function(){return f.stringify}}),Object.defineProperty(e,"nil",{enumerable:!0,get:function(){return f.nil}}),Object.defineProperty(e,"Name",{enumerable:!0,get:function(){return f.Name}}),Object.defineProperty(e,"CodeGen",{enumerable:!0,get:function(){return f.CodeGen}});var y=rr;Object.defineProperty(e,"ValidationError",{enumerable:!0,get:function(){return y.default}});var S=nr;Object.defineProperty(e,"MissingRefError",{enumerable:!0,get:function(){return S.default}})})(Jr,Jr.exports);var cd=Jr.exports,ud=gi(cd);new ud({discriminator:!0});self.postMessage("worker-script-started");const Wn=Jo(),Ls=(Wn.wpVersion||"").replace("_","."),La=ti.includes(Ls)?Ls:ei,zs=(Wn.phpVersion||"").replace("_","."),za=yo.includes(zs)?zs:"8.0";let Cr,Ot,tn,kr=!1;Wn.storage==="opfs-browser"&&typeof navigator?.storage?.getDirectory<"u"&&(Cr=await navigator.storage.getDirectory(),Ot=await Cr.getDirectoryHandle("wordpress",{create:!0}),tn=Ot,kr=await oa(Ot));const Wa=Math.random().toFixed(16),Ka=Go(Xo,Wa).toString(),Ga=new Yo,Kn=ri(La),{php:Rt,phpReady:ld}=br.loadSync(za,{downloadMonitor:Ga,requestHandler:{documentRoot:Pr,absoluteUrl:Ka,isStaticFilePath:Zo},dataModules:kr?[]:[Kn]});class dd extends Ko{constructor(e,r,n,s,a){super(e,r),this.scope=n,this.wordPressVersion=s,this.phpVersion=a}async getWordPressModuleDetails(){return{majorVersion:this.wordPressVersion,staticAssetsDirectory:`wp-${this.wordPressVersion.replace("_",".")}`,defaultTheme:(await Kn)?.defaultThemeName}}async resetVirtualOpfs(){if(!Cr)throw new Error("No virtual OPFS available.");await Cr.removeEntry(Ot.name,{recursive:!0})}async reloadFilesFromOpfs(){await this.bindOpfs(tn)}async bindOpfs(e,r){tn=e,await na({php:Rt,opfs:e,onProgress:r})}}const[fd,hd]=Ho(new dd(Rt,Ga,Wa,La,za));try{await ld,kr||(await Kn,ci(Rt),await Es(Rt,{wordpressPath:Pr,patchSecrets:!0,disableWpNewBlogNotification:!0,addPhpInfo:!0,disableSiteHealth:!0})),Ot&&await na({php:Rt,opfs:Ot,wordPressAvailableInOPFS:kr}),await Es(Rt,{wordpressPath:Pr,siteUrl:Ka}),fd()}catch(t){throw hd(t),t}
